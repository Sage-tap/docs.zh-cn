---
title: CA1502：避免过度复杂（代码分析）
description: 了解代码分析规则 CA1502：避免过度复杂
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- AvoidExcessiveComplexity
- CA1502
helpviewer_keywords:
- CA1502
- AvoidExcessiveComplexity
author: gewarren
ms.author: gewarren
dev_langs:
- CSharp
- VB
ms.openlocfilehash: 86dfcf73070cefc71b7a94ea5f0de385f41d4834
ms.sourcegitcommit: 05d0087dfca85aac9ca2960f86c5efd218bf833f
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/30/2021
ms.locfileid: "99777354"
---
# <a name="ca1502-avoid-excessive-complexity"></a><span data-ttu-id="8adf0-103">CA1502:避免过度复杂</span><span class="sxs-lookup"><span data-stu-id="8adf0-103">CA1502: Avoid excessive complexity</span></span>

| | <span data-ttu-id="8adf0-104">值</span><span class="sxs-lookup"><span data-stu-id="8adf0-104">Value</span></span> |
|-|-|
| <span data-ttu-id="8adf0-105">**规则 ID**</span><span class="sxs-lookup"><span data-stu-id="8adf0-105">**Rule ID**</span></span> |<span data-ttu-id="8adf0-106">CA1502</span><span class="sxs-lookup"><span data-stu-id="8adf0-106">CA1502</span></span>|
| <span data-ttu-id="8adf0-107">**类别**</span><span class="sxs-lookup"><span data-stu-id="8adf0-107">**Category**</span></span> |[<span data-ttu-id="8adf0-108">可维护性</span><span class="sxs-lookup"><span data-stu-id="8adf0-108">Maintainability</span></span>](maintainability-warnings.md)|
| <span data-ttu-id="8adf0-109">修复是中断修复还是非中断修复</span><span class="sxs-lookup"><span data-stu-id="8adf0-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="8adf0-110">非中断</span><span class="sxs-lookup"><span data-stu-id="8adf0-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="8adf0-111">原因</span><span class="sxs-lookup"><span data-stu-id="8adf0-111">Cause</span></span>

<span data-ttu-id="8adf0-112">某方法具有过度的圈复杂度。</span><span class="sxs-lookup"><span data-stu-id="8adf0-112">A method has an excessive cyclomatic complexity.</span></span>

## <a name="rule-description"></a><span data-ttu-id="8adf0-113">规则说明</span><span class="sxs-lookup"><span data-stu-id="8adf0-113">Rule description</span></span>

<span data-ttu-id="8adf0-114">圈复杂度衡量经过该方法的线性独立路径的数量，由条件分支的数量和复杂度决定。</span><span class="sxs-lookup"><span data-stu-id="8adf0-114">*Cyclomatic complexity* measures the number of linearly independent paths through the method, which is determined by the number and complexity of conditional branches.</span></span> <span data-ttu-id="8adf0-115">圈复杂度较低通常表示方法易于理解、测试和维护。</span><span class="sxs-lookup"><span data-stu-id="8adf0-115">A low cyclomatic complexity generally indicates a method that is easy to understand, test, and maintain.</span></span> <span data-ttu-id="8adf0-116">圈复杂度通过方法的控制流图计算得出，公式如下：</span><span class="sxs-lookup"><span data-stu-id="8adf0-116">The cyclomatic complexity is calculated from a control flow graph of the method and is given as follows:</span></span>

<span data-ttu-id="8adf0-117">圈复杂度 = 边缘数 - 节点数 + 1</span><span class="sxs-lookup"><span data-stu-id="8adf0-117">cyclomatic complexity = the number of edges - the number of nodes + 1</span></span>

<span data-ttu-id="8adf0-118">节点表示逻辑分支点，边缘表示节点之间的线 。</span><span class="sxs-lookup"><span data-stu-id="8adf0-118">A *node* represents a logic branch point and an *edge* represents a line between nodes.</span></span>

<span data-ttu-id="8adf0-119">当圈复杂度大于 25 时，规则会报告冲突。</span><span class="sxs-lookup"><span data-stu-id="8adf0-119">The rule reports a violation when the cyclomatic complexity is more than 25.</span></span>

<span data-ttu-id="8adf0-120">可以在[衡量托管代码的复杂性](/visualstudio/code-quality/code-metrics-values)中了解有关代码度量的详细信息。</span><span class="sxs-lookup"><span data-stu-id="8adf0-120">You can learn more about code metrics at [Measure complexity of managed code](/visualstudio/code-quality/code-metrics-values).</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="8adf0-121">如何解决冲突</span><span class="sxs-lookup"><span data-stu-id="8adf0-121">How to fix violations</span></span>

<span data-ttu-id="8adf0-122">若要解决此规则的冲突，请重构方法以降低其圈复杂度。</span><span class="sxs-lookup"><span data-stu-id="8adf0-122">To fix a violation of this rule, refactor the method to reduce its cyclomatic complexity.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="8adf0-123">何时禁止显示警告</span><span class="sxs-lookup"><span data-stu-id="8adf0-123">When to suppress warnings</span></span>

<span data-ttu-id="8adf0-124">如果无法轻松降低复杂度，并且该方法易于理解、测试和维护，则可禁止显示此规则的警告。</span><span class="sxs-lookup"><span data-stu-id="8adf0-124">It is safe to suppress a warning from this rule if the complexity cannot easily be reduced and the method is easy to understand, test, and maintain.</span></span> <span data-ttu-id="8adf0-125">具体而言，包含较大 `switch`（在 Visual Basic 中为 `Select`）语句的方法就是可排除的候选方法。</span><span class="sxs-lookup"><span data-stu-id="8adf0-125">In particular, a method that contains a large `switch` (`Select` in Visual Basic) statement is a candidate for exclusion.</span></span> <span data-ttu-id="8adf0-126">在开发周期后期破坏代码库稳定性或在先前发布的代码中引入意外的运行时行为更改的风险可能超过重构代码的可维护性优势。</span><span class="sxs-lookup"><span data-stu-id="8adf0-126">The risk of destabilizing the code base late in the development cycle or introducing an unexpected change in run-time behavior in previously shipped code might outweigh the maintainability benefits of refactoring the code.</span></span>

## <a name="how-cyclomatic-complexity-is-calculated"></a><span data-ttu-id="8adf0-127">如何计算圈复杂度</span><span class="sxs-lookup"><span data-stu-id="8adf0-127">How cyclomatic complexity is calculated</span></span>

<span data-ttu-id="8adf0-128">圈复杂度的计算方法是，将以下各项加 1：</span><span class="sxs-lookup"><span data-stu-id="8adf0-128">The cyclomatic complexity is calculated by adding 1 to the following:</span></span>

- <span data-ttu-id="8adf0-129">分支数（例如 `if`、`while` 和 `do`）</span><span class="sxs-lookup"><span data-stu-id="8adf0-129">Number of branches (such as `if`, `while`, and `do`)</span></span>

- <span data-ttu-id="8adf0-130">`switch` 中的 `case` 语句数</span><span class="sxs-lookup"><span data-stu-id="8adf0-130">Number of `case` statements in a `switch`</span></span>

## <a name="examples"></a><span data-ttu-id="8adf0-131">示例</span><span class="sxs-lookup"><span data-stu-id="8adf0-131">Examples</span></span>

<span data-ttu-id="8adf0-132">下面的示例演示具有不同圈复杂度的方法。</span><span class="sxs-lookup"><span data-stu-id="8adf0-132">The following examples show methods that have varying cyclomatic complexities.</span></span>

### <a name="cyclomatic-complexity-of-1"></a><span data-ttu-id="8adf0-133">圈复杂度为 1</span><span class="sxs-lookup"><span data-stu-id="8adf0-133">Cyclomatic complexity of 1</span></span>

```csharp
public void Method()
{
    Console.WriteLine("Hello World!");
}
```

```vb
Public Sub Method()
    Console.WriteLine("Hello World!")
End Sub
```

### <a name="cyclomatic-complexity-of-2"></a><span data-ttu-id="8adf0-134">圈复杂度为 2</span><span class="sxs-lookup"><span data-stu-id="8adf0-134">Cyclomatic complexity of 2</span></span>

```csharp
void Method(bool condition)
{
    if (condition)
    {
        Console.WriteLine("Hello World!");
    }
}
```

```vb
Public Sub Method(ByVal condition As Boolean)
    If (condition) Then
        Console.WriteLine("Hello World!")
    End If
End Sub
```

### <a name="cyclomatic-complexity-of-3"></a><span data-ttu-id="8adf0-135">圈复杂度为 3</span><span class="sxs-lookup"><span data-stu-id="8adf0-135">Cyclomatic complexity of 3</span></span>

```csharp
public void Method(bool condition1, bool condition2)
{
    if (condition1 || condition2)
    {
        Console.WriteLine("Hello World!");
    }
}
```

```vb
Public Sub Method(ByVal condition1 As Boolean, ByVal condition2 As Boolean)
    If (condition1 OrElse condition2) Then
        Console.WriteLine("Hello World!")
    End If
End Sub
```

### <a name="cyclomatic-complexity-of-8"></a><span data-ttu-id="8adf0-136">圈复杂度为 8</span><span class="sxs-lookup"><span data-stu-id="8adf0-136">Cyclomatic complexity of 8</span></span>

```csharp
public void Method(DayOfWeek day)
{
    switch (day)
    {
        case DayOfWeek.Monday:
            Console.WriteLine("Today is Monday!");
            break;
        case DayOfWeek.Tuesday:
            Console.WriteLine("Today is Tuesday!");
            break;
        case DayOfWeek.Wednesday:
            Console.WriteLine("Today is Wednesday!");
            break;
        case DayOfWeek.Thursday:
            Console.WriteLine("Today is Thursday!");
            break;
        case DayOfWeek.Friday:
            Console.WriteLine("Today is Friday!");
            break;
        case DayOfWeek.Saturday:
            Console.WriteLine("Today is Saturday!");
            break;
        case DayOfWeek.Sunday:
            Console.WriteLine("Today is Sunday!");
            break;
    }
}
```

```vb
Public Sub Method(ByVal day As DayOfWeek)
    Select Case day
        Case DayOfWeek.Monday
            Console.WriteLine("Today is Monday!")
        Case DayOfWeek.Tuesday
            Console.WriteLine("Today is Tuesday!")
        Case DayOfWeek.Wednesday
            Console.WriteLine("Today is Wednesday!")
        Case DayOfWeek.Thursday
            Console.WriteLine("Today is Thursday!")
        Case DayOfWeek.Friday
            Console.WriteLine("Today is Friday!")
        Case DayOfWeek.Saturday
            Console.WriteLine("Today is Saturday!")
        Case DayOfWeek.Sunday
            Console.WriteLine("Today is Sunday!")
    End Select
End Sub
```

## <a name="related-rules"></a><span data-ttu-id="8adf0-137">相关规则</span><span class="sxs-lookup"><span data-stu-id="8adf0-137">Related rules</span></span>

[<span data-ttu-id="8adf0-138">CA1501:避免过度继承</span><span class="sxs-lookup"><span data-stu-id="8adf0-138">CA1501: Avoid excessive inheritance</span></span>](ca1501.md)

## <a name="see-also"></a><span data-ttu-id="8adf0-139">另请参阅</span><span class="sxs-lookup"><span data-stu-id="8adf0-139">See also</span></span>

- [<span data-ttu-id="8adf0-140">测量托管代码的复杂性和可维护性</span><span class="sxs-lookup"><span data-stu-id="8adf0-140">Measuring Complexity and Maintainability of Managed Code</span></span>](/visualstudio/code-quality/code-metrics-values)

---
title: 64 位应用程序
description: 获取有关在 64 位 Windows OS 上配置应用程序的信息，可以是本机 64 位应用程序，也可以是 WOW64 下（64 位 Windows 上的 32 位 Windows）的应用程序。
ms.date: 03/30/2017
helpviewer_keywords:
- applications [C++], 64-bit
- 64-bit applications [C++]
- 64-bit programming [C++]
ms.assetid: fd4026bc-2c3d-4b27-86dc-ec5e96018181
ms.openlocfilehash: 8274fe8f5d32b0f6258e450cc7d649fe3e184d78
ms.sourcegitcommit: 0bb8074d524e0dcf165430b744bb143461f17026
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/15/2021
ms.locfileid: "103477211"
---
# <a name="64-bit-applications"></a><span data-ttu-id="6c37a-103">64 位应用程序</span><span class="sxs-lookup"><span data-stu-id="6c37a-103">64-bit Applications</span></span>

<span data-ttu-id="6c37a-104">编译应用程序时，您可以将其指定为在 Windows 64 位操作系统上作为本机应用程序或在 WOW64（Windows 64 位下的 Windows 32 位）下运行。</span><span class="sxs-lookup"><span data-stu-id="6c37a-104">When you compile an application, you can specify that it should run on a Windows 64-bit operating system either as a native application or under WOW64 (Windows 32-bit on Windows 64-bit).</span></span> <span data-ttu-id="6c37a-105">WOW64 是一种兼容性环境，它使 32 位应用能够在 64 位系统上运行。</span><span class="sxs-lookup"><span data-stu-id="6c37a-105">WOW64 is a compatibility environment that enables a 32-bit application to run on a 64-bit system.</span></span> <span data-ttu-id="6c37a-106">WOW64 包括在所有 64 位版本的 Windows 操作系统中。</span><span class="sxs-lookup"><span data-stu-id="6c37a-106">WOW64 is included in all 64-bit versions of the Windows operating system.</span></span>  
  
## <a name="running-32-bit-vs-64-bit-applications-on-windows"></a><span data-ttu-id="6c37a-107">在 Windows 上运行 32 位与64 位应用程序</span><span class="sxs-lookup"><span data-stu-id="6c37a-107">Running 32-bit vs. 64-bit Applications on Windows</span></span>  

 <span data-ttu-id="6c37a-108">在 64 位操作系统上，所有基于 .NET Framework 1.0 或 1.1 生成的应用程序都会被视为 32 位应用程序，并始终在 WOW64 和 32 位公共语言运行时 (CLR) 下执行。</span><span class="sxs-lookup"><span data-stu-id="6c37a-108">All applications that are built on the .NET Framework 1.0 or 1.1 are treated as 32-bit applications on a 64-bit operating system and are always executed under WOW64 and the 32-bit common language runtime (CLR).</span></span> <span data-ttu-id="6c37a-109">基于 .NET Framework 4 或更高版本生成的 32 位应用程序也可以在 64 位系统上的 WOW64 下运行。</span><span class="sxs-lookup"><span data-stu-id="6c37a-109">32-bit applications that are built on the .NET Framework 4 or later versions also run under WOW64 on 64-bit systems.</span></span>  
  
 <span data-ttu-id="6c37a-110">在 x86 计算机上，Visual Studio 会安装 32 位版本的 CLR，而在 64 位 Windows 计算机上会同时安装 32 位版本和适当的 64 位版本的 CLR。</span><span class="sxs-lookup"><span data-stu-id="6c37a-110">Visual Studio installs the 32-bit version of the CLR on an x86 computer, and both the 32-bit version and the appropriate 64-bit version of the CLR on a 64-bit Windows computer.</span></span> <span data-ttu-id="6c37a-111">（因为 Visual Studio 是一个 32 位应用程序，所以当安装到 64 位系统上时，它会在 WOW64 下运行。）</span><span class="sxs-lookup"><span data-stu-id="6c37a-111">(Because Visual Studio is a 32-bit application, when it is installed on a 64-bit system, it runs under WOW64.)</span></span>  
  
> [!NOTE]
> <span data-ttu-id="6c37a-112">由于 Itanium 处理器系列的 x86 仿真和 WOW64 子系统设计，仅限在一个处理器上执行应用程序。</span><span class="sxs-lookup"><span data-stu-id="6c37a-112">Because of the design of x86 emulation and the WOW64 subsystem for the Itanium processor family, applications are restricted to execution on one processor.</span></span> <span data-ttu-id="6c37a-113">这些因素会降低在基于 Itanium 的系统上运行的 32 位 .NET Framework 应用程序的性能和可伸缩性。</span><span class="sxs-lookup"><span data-stu-id="6c37a-113">These factors reduce the performance and scalability of 32-bit .NET Framework applications that run on Itanium-based systems.</span></span> <span data-ttu-id="6c37a-114">我们建议你使用 .NET Framework 4，它包括对基于 Itanium 的系统的本机 64 位支持，以提升性能和可伸缩性。</span><span class="sxs-lookup"><span data-stu-id="6c37a-114">We recommend that you use the .NET Framework 4, which includes native 64-bit support for Itanium-based systems, for increased performance and scalability.</span></span>  
  
 <span data-ttu-id="6c37a-115">默认情况下，在 64 位 Windows 操作系统上运行 64 位托管应用程序时，您可以创建一个不超过 2 GB 的对象。</span><span class="sxs-lookup"><span data-stu-id="6c37a-115">By default, when you run a 64-bit managed application on a 64-bit Windows operating system, you can create an object of no more than 2 gigabytes (GB).</span></span> <span data-ttu-id="6c37a-116">然而，在 .NET Framework 4.5 中，你可以增加该限制。</span><span class="sxs-lookup"><span data-stu-id="6c37a-116">However, in the .NET Framework 4.5, you can increase this limit.</span></span>  <span data-ttu-id="6c37a-117">有关更多信息，请参见 [\<gcAllowVeryLargeObjects> 元素](./configure-apps/file-schema/runtime/gcallowverylargeobjects-element.md)。</span><span class="sxs-lookup"><span data-stu-id="6c37a-117">For more information, see the [\<gcAllowVeryLargeObjects> element](./configure-apps/file-schema/runtime/gcallowverylargeobjects-element.md).</span></span>  
  
 <span data-ttu-id="6c37a-118">很多程序集可在 32 位 CLR 和 64 位 CLR 上同样运行。</span><span class="sxs-lookup"><span data-stu-id="6c37a-118">Many assemblies run identically on both the 32-bit CLR and the 64-bit CLR.</span></span> <span data-ttu-id="6c37a-119">然而，因为包含下列一个或多个原因，对于不同的 CLR，有些程序可能会有不同表现：</span><span class="sxs-lookup"><span data-stu-id="6c37a-119">However, some programs may behave differently, depending on the CLR, if they contain one or more of the following:</span></span>  
  
- <span data-ttu-id="6c37a-120">结构中包含大小随平台而改变的成员，例如任何指针类型。</span><span class="sxs-lookup"><span data-stu-id="6c37a-120">Structures that contain members that change size depending on the platform (for example, any pointer type).</span></span>  
  
- <span data-ttu-id="6c37a-121">指针算术包含固定大小。</span><span class="sxs-lookup"><span data-stu-id="6c37a-121">Pointer arithmetic that includes constant sizes.</span></span>  
  
- <span data-ttu-id="6c37a-122">平台调用错误，或使用句柄的 `Int32` 而非 `IntPtr` 的 COM 声明不正确。</span><span class="sxs-lookup"><span data-stu-id="6c37a-122">Incorrect platform invoke or COM declarations that use `Int32` for handles instead of `IntPtr`.</span></span>  
  
- <span data-ttu-id="6c37a-123">将 `IntPtr` 转换到 `Int32` 的代码。</span><span class="sxs-lookup"><span data-stu-id="6c37a-123">Code that casts `IntPtr` to `Int32`.</span></span>  
  
 <span data-ttu-id="6c37a-124">有关如何移植 32 位应用程序以使其在 64 位 CLR 上运行的详细信息，请参阅[将 32 位托管代码迁移至 64 位](/previous-versions/dotnet/articles/ms973190(v=msdn.10))。</span><span class="sxs-lookup"><span data-stu-id="6c37a-124">For more information about how to port a 32-bit application to run on the 64-bit CLR, see [Migrating 32-bit Managed Code to 64-bit](/previous-versions/dotnet/articles/ms973190(v=msdn.10)).</span></span>  
  
## <a name="general-64-bit-programming-information"></a><span data-ttu-id="6c37a-125">常规 64 位编程信息</span><span class="sxs-lookup"><span data-stu-id="6c37a-125">General 64-Bit Programming Information</span></span>  

 <span data-ttu-id="6c37a-126">有关 64 位编程的常规信息，请参阅以下文档：</span><span class="sxs-lookup"><span data-stu-id="6c37a-126">For general information about 64-bit programming, see the following documents:</span></span>  
  
- <span data-ttu-id="6c37a-127">在 Windows SDK 文档中，请参阅 [64 位 Windows 编程指南](/windows/win32/winprog64/programming-guide-for-64-bit-windows)。</span><span class="sxs-lookup"><span data-stu-id="6c37a-127">In the Windows SDK documentation, see [Programming Guide for 64-bit Windows](/windows/win32/winprog64/programming-guide-for-64-bit-windows).</span></span>  
  
- <span data-ttu-id="6c37a-128">有关 Visual Studio 对创建 64 位应用程序提供的支持的信息，请参阅 [Visual Studio IDE 64 位支持](/visualstudio/ide/visual-studio-ide-64-bit-support)。</span><span class="sxs-lookup"><span data-stu-id="6c37a-128">For information about Visual Studio support for creating 64-bit applications, see [Visual Studio IDE 64-Bit Support](/visualstudio/ide/visual-studio-ide-64-bit-support).</span></span>  
  
## <a name="compiler-support-for-creating-64-bit-applications"></a><span data-ttu-id="6c37a-129">创建 64 位应用程序的编译器支持</span><span class="sxs-lookup"><span data-stu-id="6c37a-129">Compiler Support for Creating 64-Bit Applications</span></span>  

 <span data-ttu-id="6c37a-130">默认情况下，如果您使用 .NET Framework 在 32 位或 64 位计算机中生成一个应用程序，该应用程序将会在 64 位计算机中作为本机应用程序运行（即不是在 WOW64 下运行）。</span><span class="sxs-lookup"><span data-stu-id="6c37a-130">By default, when you use the .NET Framework to build an application on either a 32-bit or a 64-bit computer, the application will run on a 64-bit computer as a native application (that is, not under WOW64).</span></span> <span data-ttu-id="6c37a-131">有关如何使用 Visual Studio 编译器创建 64 位应用程序，并且应用程序会作为本机应用程序运行和/或在 WOW64 下运行的信息，请参阅下表中的文档。</span><span class="sxs-lookup"><span data-stu-id="6c37a-131">The following table lists documents that explain how to use Visual Studio compilers to create 64-bit applications that will run as native, under WOW64, or both.</span></span>  
  
|<span data-ttu-id="6c37a-132">编译器</span><span class="sxs-lookup"><span data-stu-id="6c37a-132">Compiler</span></span>|<span data-ttu-id="6c37a-133">编译器选项</span><span class="sxs-lookup"><span data-stu-id="6c37a-133">Compiler option</span></span>|  
|--------------|---------------------|  
|<span data-ttu-id="6c37a-134">Visual Basic</span><span class="sxs-lookup"><span data-stu-id="6c37a-134">Visual Basic</span></span>|[<span data-ttu-id="6c37a-135">-platform (Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="6c37a-135">-platform (Visual Basic)</span></span>](../visual-basic/reference/command-line-compiler/platform.md)|  
|<span data-ttu-id="6c37a-136">Visual C#</span><span class="sxs-lookup"><span data-stu-id="6c37a-136">Visual C#</span></span>|[<span data-ttu-id="6c37a-137">-platform（C# 编译器选项）</span><span class="sxs-lookup"><span data-stu-id="6c37a-137">-platform (C# Compiler Options)</span></span>](../csharp/language-reference/compiler-options/output.md#platformtarget)|  
|<span data-ttu-id="6c37a-138">Visual C++</span><span class="sxs-lookup"><span data-stu-id="6c37a-138">Visual C++</span></span>|<span data-ttu-id="6c37a-139">可以通过使用 **/clr:safe** 创建与平台无关的 Microsoft 中间语言 (MSIL) 应用程序。</span><span class="sxs-lookup"><span data-stu-id="6c37a-139">You can create platform-agnostic, Microsoft intermediate language (MSIL) applications by using **/clr:safe**.</span></span> <span data-ttu-id="6c37a-140">有关详细信息，请参阅 [-clr（公共语言运行时编译）](/cpp/build/reference/clr-common-language-runtime-compilation)。</span><span class="sxs-lookup"><span data-stu-id="6c37a-140">For more information, see [-clr (Common Language Runtime Compilation)](/cpp/build/reference/clr-common-language-runtime-compilation).</span></span><br /><br /> <span data-ttu-id="6c37a-141">Visual c++ 为每个 64 位操作系统均包括一个单独的编译器。</span><span class="sxs-lookup"><span data-stu-id="6c37a-141">Visual C++ includes a separate compiler for each 64-bit operating system.</span></span> <span data-ttu-id="6c37a-142">有关如何使用 Visual C++ 创建可在 64 位 Windows 操作系统上运行的本机应用程序的详细信息，请参阅 [64 位编程](/cpp/build/configuring-programs-for-64-bit-visual-cpp)。</span><span class="sxs-lookup"><span data-stu-id="6c37a-142">For more information about how to use Visual C++ to create native applications that run on a 64-bit Windows operating system, see [64-bit Programming](/cpp/build/configuring-programs-for-64-bit-visual-cpp).</span></span>|  
  
## <a name="determining-the-status-of-an-exe-file-or-dll-file"></a><span data-ttu-id="6c37a-143">确定 .exe 文件或 .dll 文件的状态</span><span class="sxs-lookup"><span data-stu-id="6c37a-143">Determining the Status of an .exe File or .dll File</span></span>  

 <span data-ttu-id="6c37a-144">若要确定 .exe 文件或 .dll 文件是只能在特定平台上运行还是可在 WOW64 下运行，请使用不带任何选项的 [CorFlags.exe（CorFlags 转换工具）](./tools/corflags-exe-corflags-conversion-tool.md)。</span><span class="sxs-lookup"><span data-stu-id="6c37a-144">To determine whether an .exe file or .dll file is meant to run only on a specific platform or under WOW64, use [CorFlags.exe (CorFlags Conversion Tool)](./tools/corflags-exe-corflags-conversion-tool.md) with no options.</span></span> <span data-ttu-id="6c37a-145">您也可以使用 CorFlags.exe 更改 .exe 文件或 .dll 文件的平台状态。</span><span class="sxs-lookup"><span data-stu-id="6c37a-145">You can also use CorFlags.exe to change the platform status of an .exe file or .dll file.</span></span> <span data-ttu-id="6c37a-146">Visual Studio 程序集的 CLR 头的主运行时版本号设置为 2，次运行时版本号设置为 5。</span><span class="sxs-lookup"><span data-stu-id="6c37a-146">The CLR header of a Visual Studio assembly has the major runtime version number set to 2 and the minor runtime version number set to 5.</span></span> <span data-ttu-id="6c37a-147">将次运行时版本设置为 0 的应用程序会被视为旧版应用程序，且始终在 WOW64 下执行。</span><span class="sxs-lookup"><span data-stu-id="6c37a-147">Applications that have the minor runtime version set to 0 are treated as legacy applications and are always executed under WOW64.</span></span>  
  
 <span data-ttu-id="6c37a-148">若要以编程方式查询 .exe 或 .dll，以查看其是只能在特定平台上运行还是在 WOW64 下运行，请使用 <xref:System.Reflection.Module.GetPEKind%2A?displayProperty=nameWithType> 方法。</span><span class="sxs-lookup"><span data-stu-id="6c37a-148">To programmatically query an .exe or .dll to see whether it is meant to run only on a specific platform or under WOW64, use the <xref:System.Reflection.Module.GetPEKind%2A?displayProperty=nameWithType> method.</span></span>

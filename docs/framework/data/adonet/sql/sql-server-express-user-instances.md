---
description: 了解详细信息： SQL Server Express 用户实例
title: SQL Server Express 用户实例
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 00c12376-cb26-4317-86ad-e6e9c089be57
ms.openlocfilehash: 8579dee5c31a2b63156db72df6cc109beb843f08
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/06/2021
ms.locfileid: "99767266"
---
# <a name="sql-server-express-user-instances"></a><span data-ttu-id="d3392-103">SQL Server Express 用户实例</span><span class="sxs-lookup"><span data-stu-id="d3392-103">SQL Server Express User Instances</span></span>

<span data-ttu-id="d3392-104">Microsoft SQL Server 学习版 (SQL Server Express) 支持用户实例功能，只有在使用用于 SQL Server 的 .NET Framework 数据提供程序 (`SqlClient`) 时该功能才可用。</span><span class="sxs-lookup"><span data-stu-id="d3392-104">Microsoft SQL Server Express Edition (SQL Server Express) supports the user instance feature, which is only available when using the .NET Framework Data Provider for SQL Server (`SqlClient`).</span></span> <span data-ttu-id="d3392-105">用户实例是由父实例生成的 SQL Server Express 数据库引擎的单独实例。</span><span class="sxs-lookup"><span data-stu-id="d3392-105">A user instance is a separate instance of the SQL Server Express Database Engine that is generated by a parent instance.</span></span> <span data-ttu-id="d3392-106">用户实例允许非本地计算机管理员的用户附加并连接到 SQL Server Express 数据库。</span><span class="sxs-lookup"><span data-stu-id="d3392-106">User instances allow users who are not administrators on their local computers to attach and connect to SQL Server Express databases.</span></span> <span data-ttu-id="d3392-107">每个实例在单个用户的安全上下文下运行，每个用户一个实例。</span><span class="sxs-lookup"><span data-stu-id="d3392-107">Each instance runs under the security context of the individual user, on a one-instance-per-user basis.</span></span>  
  
## <a name="user-instance-capabilities"></a><span data-ttu-id="d3392-108">用户实例功能</span><span class="sxs-lookup"><span data-stu-id="d3392-108">User Instance Capabilities</span></span>  

 <span data-ttu-id="d3392-109">用户实例适用于在最低特权用户帐户下运行 Windows (LUA) 的用户。</span><span class="sxs-lookup"><span data-stu-id="d3392-109">User instances are useful for users who are running Windows under a least-privilege user account (LUA).</span></span> <span data-ttu-id="d3392-110">每个用户都有 SQL Server 系统管理员 (在 `sysadmin` 其计算机上运行的实例) 权限，而无需以 Windows 管理员身份运行。</span><span class="sxs-lookup"><span data-stu-id="d3392-110">Each user has SQL Server system administrator (`sysadmin`) privileges over the instance running on their computer without needing to run as a Windows administrator as well.</span></span> <span data-ttu-id="d3392-111">以有限权限执行用户实例的软件无法进行系统范围的更改，因为 SQL Server Express 实例是在用户的非管理员 Windows 帐户下运行的，而不是以服务形式运行。</span><span class="sxs-lookup"><span data-stu-id="d3392-111">Software executing on a user instance with limited permissions cannot make system-wide changes because the instance of SQL Server Express is running under the non-administrator Windows account of the user, not as a service.</span></span> <span data-ttu-id="d3392-112">用户实例独立于父实例和该计算机上运行的任何其他用户实例。</span><span class="sxs-lookup"><span data-stu-id="d3392-112">Each user instance is isolated from its parent instance and from any other user instances running on the same computer.</span></span> <span data-ttu-id="d3392-113">在用户实例上运行的数据库仅以单用户模式打开，多个用户无法连接到在用户实例上运行的数据库。</span><span class="sxs-lookup"><span data-stu-id="d3392-113">Databases running on a user instance are opened in single-user mode only, and it is not possible for multiple users to connect to databases running on a user instance.</span></span> <span data-ttu-id="d3392-114">还会为用户实例禁用复制和分布式查询。</span><span class="sxs-lookup"><span data-stu-id="d3392-114">Replication and distributed queries are also disabled for user instances.</span></span>
  
> [!NOTE]
> <span data-ttu-id="d3392-115">对于已经在自己的计算机上具有管理员权限的用户，或在涉及多个数据库用户的场景中，不需要用户实例。</span><span class="sxs-lookup"><span data-stu-id="d3392-115">User instances are not needed for users who are already administrators on their own computers, or for scenarios involving multiple database users.</span></span>  
  
## <a name="enabling-user-instances"></a><span data-ttu-id="d3392-116">启用用户实例</span><span class="sxs-lookup"><span data-stu-id="d3392-116">Enabling User Instances</span></span>  

 <span data-ttu-id="d3392-117">若要生成用户实例，必须运行 SQL Server Express 父实例。</span><span class="sxs-lookup"><span data-stu-id="d3392-117">To generate user instances, a parent instance of SQL Server Express must be running.</span></span> <span data-ttu-id="d3392-118">安装 SQL Server Express 后，默认情况下将启用用户实例，且对父实例执行 sp_configure 系统存储过程的系统管理员可以显式启用或禁用用户实例  。</span><span class="sxs-lookup"><span data-stu-id="d3392-118">User instances are enabled by default when SQL Server Express is installed, and they can be explicitly enabled or disabled by a system administrator executing the **sp_configure** system stored procedure on the parent instance.</span></span>  
  
```sql  
-- Enable user instances.  
sp_configure 'user instances enabled','1'
  
-- Disable user instances.  
sp_configure 'user instances enabled','0'  
```  
  
 <span data-ttu-id="d3392-119">用于用户实例的网络协议必须为本地命名管道。</span><span class="sxs-lookup"><span data-stu-id="d3392-119">The network protocol for user instances must be local Named Pipes.</span></span> <span data-ttu-id="d3392-120">用户实例无法在 SQL Server 的远程实例上启动，并且不允许 SQL Server 登录名。</span><span class="sxs-lookup"><span data-stu-id="d3392-120">A user instance cannot be started on a remote instance of SQL Server, and SQL Server logins are not allowed.</span></span>  
  
## <a name="connecting-to-a-user-instance"></a><span data-ttu-id="d3392-121">连接到用户实例</span><span class="sxs-lookup"><span data-stu-id="d3392-121">Connecting to a User Instance</span></span>  

 <span data-ttu-id="d3392-122">`User Instance` 和 `AttachDBFilename`<xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A> 关键字允许 <xref:System.Data.SqlClient.SqlConnection> 连接到用户实例。</span><span class="sxs-lookup"><span data-stu-id="d3392-122">The `User Instance` and `AttachDBFilename`<xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A> keywords allow a <xref:System.Data.SqlClient.SqlConnection> to connect to a user instance.</span></span> <span data-ttu-id="d3392-123"><xref:System.Data.SqlClient.SqlConnectionStringBuilder>`UserInstance` 和 `AttachDBFilename` 属性还支持用户实例。</span><span class="sxs-lookup"><span data-stu-id="d3392-123">User instances are also supported by the <xref:System.Data.SqlClient.SqlConnectionStringBuilder>`UserInstance` and `AttachDBFilename` properties.</span></span>  
  
 <span data-ttu-id="d3392-124">请注意下面所示的示例连接字符串：</span><span class="sxs-lookup"><span data-stu-id="d3392-124">Note the following about the sample connection string shown below:</span></span>  
  
- <span data-ttu-id="d3392-125">`Data Source` 关键字引用生成用户实例的 SQL Server Express 的父实例。</span><span class="sxs-lookup"><span data-stu-id="d3392-125">The `Data Source` keyword refers to the parent instance of SQL Server Express that is generating the user instance.</span></span> <span data-ttu-id="d3392-126">默认实例为 .\sqlexpress。</span><span class="sxs-lookup"><span data-stu-id="d3392-126">The default instance is .\sqlexpress.</span></span>  
  
- <span data-ttu-id="d3392-127">`Integrated Security` 设置为 `true`。</span><span class="sxs-lookup"><span data-stu-id="d3392-127">`Integrated Security` is set to `true`.</span></span> <span data-ttu-id="d3392-128">若要连接到用户实例，需要 Windows 身份验证；不支持 SQL Server 登录名。</span><span class="sxs-lookup"><span data-stu-id="d3392-128">To connect to a user instance, Windows Authentication is required; SQL Server logins are not supported.</span></span>  
  
- <span data-ttu-id="d3392-129">`User Instance` 设置为 `true`，这将调用一个用户实例。</span><span class="sxs-lookup"><span data-stu-id="d3392-129">The `User Instance` is set to `true`, which invokes a user instance.</span></span> <span data-ttu-id="d3392-130">（默认值为 `false`。）</span><span class="sxs-lookup"><span data-stu-id="d3392-130">(The default is `false`.)</span></span>  
  
- <span data-ttu-id="d3392-131">`AttachDbFileName` 连接字符串关键字用于附加主数据库文件 (.mdf)，该文件必须包含完整路径名。</span><span class="sxs-lookup"><span data-stu-id="d3392-131">The `AttachDbFileName` connection string keyword is used to attach the primary database file (.mdf), which must include the full path name.</span></span> <span data-ttu-id="d3392-132">`AttachDbFileName` 还与 <xref:System.Data.SqlClient.SqlConnection> 连接字符串内的“extended properties”和“initial file name”键相对应。</span><span class="sxs-lookup"><span data-stu-id="d3392-132">`AttachDbFileName` also corresponds to the "extended properties" and "initial file name" keys within a <xref:System.Data.SqlClient.SqlConnection> connection string.</span></span>  
  
- <span data-ttu-id="d3392-133">管道符号中包含的 `|DataDirectory|` 替换字符串是指打开连接的应用程序的数据目录，并提供指示 .mdf 和 .ldf 数据库和日志文件位置的相对路径。</span><span class="sxs-lookup"><span data-stu-id="d3392-133">The `|DataDirectory|` substitution string enclosed in the pipe symbols refers to the data directory of the application opening the connection and provides a relative path indicating the location of the .mdf and .ldf database and log files.</span></span> <span data-ttu-id="d3392-134">如果要在其他位置查找这些文件，必须提供文件的完整路径。</span><span class="sxs-lookup"><span data-stu-id="d3392-134">If you want to locate these files elsewhere, you must provide the full path to the files.</span></span>  
  
```text
Data Source=.\\SQLExpress;Integrated Security=true;  
User Instance=true;AttachDBFilename=|DataDirectory|\InstanceDB.mdf;  
Initial Catalog=InstanceDB;  
```  
  
> [!NOTE]
> <span data-ttu-id="d3392-135">还可以使用 <xref:System.Data.SqlClient.SqlConnectionStringBuilder><xref:System.Data.SqlClient.SqlConnectionStringBuilder.UserInstance%2A> 和 <xref:System.Data.SqlClient.SqlConnectionStringBuilder.AttachDBFilename%2A> 属性在运行时生成连接字符串。</span><span class="sxs-lookup"><span data-stu-id="d3392-135">You can also use the <xref:System.Data.SqlClient.SqlConnectionStringBuilder><xref:System.Data.SqlClient.SqlConnectionStringBuilder.UserInstance%2A> and <xref:System.Data.SqlClient.SqlConnectionStringBuilder.AttachDBFilename%2A> properties to build a connection string at run time.</span></span>  
  
### <a name="using-the-124datadirectory124-substitution-string"></a><span data-ttu-id="d3392-136">使用 &#124;DataDirectory&#124; 替换字符串</span><span class="sxs-lookup"><span data-stu-id="d3392-136">Using the &#124;DataDirectory&#124; Substitution String</span></span>  

 <span data-ttu-id="d3392-137">在 ADO.NET 2.0 中，随着 `AttachDbFileName`（包含在管道符号中）替代字符串的引入，对 `|DataDirectory|` 进行了扩展。</span><span class="sxs-lookup"><span data-stu-id="d3392-137">`AttachDbFileName` was extended in ADO.NET 2.0 with the introduction of the `|DataDirectory|` (enclosed in pipe symbols) substitution string.</span></span> <span data-ttu-id="d3392-138">`DataDirectory` 与 `AttachDbFileName` 结合使用可指示数据文件的相对路径，从而允许开发人员创建基于数据源的相对路径（而无需指定完整路径）的连接字符串。</span><span class="sxs-lookup"><span data-stu-id="d3392-138">`DataDirectory` is used in conjunction with `AttachDbFileName` to indicate a relative path to a data file, allowing developers to create connection strings that are based on a relative path to the data source instead of being required to specify a full path.</span></span>  
  
 <span data-ttu-id="d3392-139">`DataDirectory` 指向的物理位置取决于应用程序的类型。</span><span class="sxs-lookup"><span data-stu-id="d3392-139">The physical location that `DataDirectory` points to depends on the type of application.</span></span> <span data-ttu-id="d3392-140">在此示例中，要附加的 Northwind.mdf 文件位于应用程序的 \app_data 文件夹中。</span><span class="sxs-lookup"><span data-stu-id="d3392-140">In this example, the Northwind.mdf file to be attached is located in the application's \app_data folder.</span></span>  
  
```text
Data Source=.\\SQLExpress;Integrated Security=true;  
User Instance=true;  
AttachDBFilename=|DataDirectory|\app_data\Northwind.mdf;  
Initial Catalog=Northwind;  
```  
  
 <span data-ttu-id="d3392-141">使用 `DataDirectory` 时，生成的文件路径在目录结构中不能比替换字符串指向的目录更高。</span><span class="sxs-lookup"><span data-stu-id="d3392-141">When `DataDirectory` is used, the resulting file path cannot be higher in the directory structure than the directory pointed to by the substitution string.</span></span> <span data-ttu-id="d3392-142">例如，如果完全展开的 `DataDirectory` 是 C:\AppDirectory\app_data，则上面显示的示例连接字符串将有效，因为它位于 c:\AppDirectory 之下。</span><span class="sxs-lookup"><span data-stu-id="d3392-142">For example, if the fully expanded `DataDirectory` is C:\AppDirectory\app_data, then the sample connection string shown above works because it is below c:\AppDirectory.</span></span> <span data-ttu-id="d3392-143">但是，如果尝试将 `DataDirectory` 指定为 `|DataDirectory|\..\data`，将会产生一个错误，因为 \data 不是 \AppDirectory 的子目录。</span><span class="sxs-lookup"><span data-stu-id="d3392-143">However, attempting to specify `DataDirectory` as `|DataDirectory|\..\data` will result in an error because \data is not a subdirectory of \AppDirectory.</span></span>  
  
 <span data-ttu-id="d3392-144">如果连接字符串的替换字符串格式不正确，则会引发 <xref:System.ArgumentException>。</span><span class="sxs-lookup"><span data-stu-id="d3392-144">If the connection string has an improperly formatted substitution string, an <xref:System.ArgumentException> will be thrown.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d3392-145"><xref:System.Data.SqlClient> 将替换字符串解析为本地计算机文件系统的完整路径。</span><span class="sxs-lookup"><span data-stu-id="d3392-145"><xref:System.Data.SqlClient> resolves the substitution strings into full paths against the local computer file system.</span></span> <span data-ttu-id="d3392-146">因此，不支持远程服务器、HTTP 和 UNC 路径名称。</span><span class="sxs-lookup"><span data-stu-id="d3392-146">Therefore, remote server, HTTP, and UNC path names are not supported.</span></span> <span data-ttu-id="d3392-147">如果服务器不在本地计算机上，则在打开连接时将引发异常。</span><span class="sxs-lookup"><span data-stu-id="d3392-147">An exception is thrown when the connection is opened if the server is not located on the local computer.</span></span>  
  
 <span data-ttu-id="d3392-148">打开 <xref:System.Data.SqlClient.SqlConnection> 时，它将从默认的 SQL Server Express 实例重定向到在调用方帐户下运行的运行时启动实例。</span><span class="sxs-lookup"><span data-stu-id="d3392-148">When the <xref:System.Data.SqlClient.SqlConnection> is opened, it is redirected from the default SQL Server Express instance to a run-time initiated instance running under the caller's account.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d3392-149">可能需要增加 <xref:System.Data.SqlClient.SqlConnection.ConnectionTimeout%2A> 值，因为加载用户实例可能比常规实例需要更长的时间。</span><span class="sxs-lookup"><span data-stu-id="d3392-149">It may be necessary to increase the <xref:System.Data.SqlClient.SqlConnection.ConnectionTimeout%2A> value since user instances may take longer to load than regular instances.</span></span>  
  
 <span data-ttu-id="d3392-150">以下代码段将打开一个新的 `SqlConnection`，在控制台窗口中显示连接字符串，然后在退出 `using` 代码块时关闭连接。</span><span class="sxs-lookup"><span data-stu-id="d3392-150">The following code fragment opens a new `SqlConnection`, displays the connection string in the console window, and then closes the connection when exiting the `using` code block.</span></span>  
  
```vb  
Private Sub OpenSqlConnection()  
    ' Retrieve the connection string.  
    Dim connectionString As String = GetConnectionString()  
  
    Using connection As New SqlConnection(connectionString)  
        connection.Open()  
        Console.WriteLine("ConnectionString: {0}", _  
           connection.ConnectionString)  
    End Using  
End Sub  
```  
  
```csharp  
private static void OpenSqlConnection()  
{  
    // Retrieve the connection string.  
    string connectionString = GetConnectionString();  
  
    using (SqlConnection connection =
        new SqlConnection(connectionString))  
    {  
        connection.Open();  
        Console.WriteLine("ConnectionString: {0}",
             connection.ConnectionString);  
    }  
}  
```  
  
> [!NOTE]
> <span data-ttu-id="d3392-151">在 SQL Server 中运行的公共语言运行时 (CLR) 代码不支持用户实例。</span><span class="sxs-lookup"><span data-stu-id="d3392-151">User instances are not supported in common language runtime (CLR) code that is running inside of SQL Server.</span></span> <span data-ttu-id="d3392-152">如果在连接字符串中有 `User Instance=true` 的 <xref:System.Data.SqlClient.SqlConnection> 上调用 `Open`，将引发 <xref:System.InvalidOperationException>。</span><span class="sxs-lookup"><span data-stu-id="d3392-152">An <xref:System.InvalidOperationException> is thrown if `Open` is called on a <xref:System.Data.SqlClient.SqlConnection> that has `User Instance=true` in the connection string.</span></span>  
  
## <a name="lifetime-of-a-user-instance-connection"></a><span data-ttu-id="d3392-153">用户实例连接的生存期</span><span class="sxs-lookup"><span data-stu-id="d3392-153">Lifetime of a User Instance Connection</span></span>  

 <span data-ttu-id="d3392-154">与作为服务运行的 SQL Server 版本不同，SQL Server Express 实例无需手动启动和停止。</span><span class="sxs-lookup"><span data-stu-id="d3392-154">Unlike versions of SQL Server that run as a service, SQL Server Express instances do not need to be manually started and stopped.</span></span> <span data-ttu-id="d3392-155">用户每次登录并连接到用户实例时，如果用户实例尚未运行，则启动该实例。</span><span class="sxs-lookup"><span data-stu-id="d3392-155">Each time a user logs in and connects to a user instance, the user instance is started if it is not already running.</span></span> <span data-ttu-id="d3392-156">用户实例数据库设置了 `AutoClose` 选项，以便在一段非活动期后自动关闭数据库。</span><span class="sxs-lookup"><span data-stu-id="d3392-156">User instance databases have the `AutoClose` option set so that the database is automatically shut down after a period of inactivity.</span></span> <span data-ttu-id="d3392-157">在实例的最后一个连接关闭后，启动的 sqlservr.exe 进程将在有限的超时期限内持续运行，因此，如果在超时过期之前打开另一个连接，无需重新启动。</span><span class="sxs-lookup"><span data-stu-id="d3392-157">The sqlservr.exe process that is started is kept running for a limited time-out period after the last connection to the instance is closed, so it does not need to be restarted if another connection is opened before the time-out has expired.</span></span> <span data-ttu-id="d3392-158">如果在超时期限过期之前没有打开新连接，用户实例将自动关闭。</span><span class="sxs-lookup"><span data-stu-id="d3392-158">The user instance automatically shuts down if no new connection opens before that time-out period has expired.</span></span> <span data-ttu-id="d3392-159">父实例的系统管理员可为用户实例设置超时期限的持续时间，方法为：使用 sp_configure 更改“用户实例超时”选项。</span><span class="sxs-lookup"><span data-stu-id="d3392-159">A system administrator on the parent instance can set the duration of the time-out period for a user instance by using **sp_configure** to change the **user instance timeout** option.</span></span> <span data-ttu-id="d3392-160">默认值为 60 分钟。</span><span class="sxs-lookup"><span data-stu-id="d3392-160">The default is 60 minutes.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d3392-161">如果在值大于 0 的连接字符串中使用 `Min Pool Size`，连接池程序将始终保持几个打开的连接，并且用户实例不会自动关闭。</span><span class="sxs-lookup"><span data-stu-id="d3392-161">If `Min Pool Size` is used in the connection string with a value greater than zero, the connection pooler will always maintain a few opened connections, and the user instance will not automatically shut down.</span></span>  
  
## <a name="how-user-instances-work"></a><span data-ttu-id="d3392-162">用户实例工作方式</span><span class="sxs-lookup"><span data-stu-id="d3392-162">How User Instances Work</span></span>  

 <span data-ttu-id="d3392-163">为每个用户首次生成用户实例时，系统会将 master 和 msdb 系统数据库从模板数据文件夹复制到用户的本地应用程序数据存储库目录下的某个路径中，供用户实例专用。</span><span class="sxs-lookup"><span data-stu-id="d3392-163">The first time a user instance is generated for each user, the **master** and **msdb** system databases are copied from the Template Data folder to a path under the user's local application data repository directory for exclusive use by the user instance.</span></span> <span data-ttu-id="d3392-164">此路径通常为 `C:\Documents and Settings\<UserName>\Local Settings\Application Data\Microsoft\Microsoft SQL Server Data\SQLEXPRESS`。</span><span class="sxs-lookup"><span data-stu-id="d3392-164">This path is typically `C:\Documents and Settings\<UserName>\Local Settings\Application Data\Microsoft\Microsoft SQL Server Data\SQLEXPRESS`.</span></span> <span data-ttu-id="d3392-165">启动用户实例时，tempdb、日志和跟踪文件也将被写入到此目录中。</span><span class="sxs-lookup"><span data-stu-id="d3392-165">When a user instance starts up, the **tempdb**, log, and trace files are also written to this directory.</span></span> <span data-ttu-id="d3392-166">为实例生成一个名称，该名称保证对每个用户都是唯一的。</span><span class="sxs-lookup"><span data-stu-id="d3392-166">A name is generated for the instance, which is guaranteed to be unique for each user.</span></span>  
  
 <span data-ttu-id="d3392-167">默认情况下，Windows Builtin\Users 组的所有成员都会被授予连接本地实例的权限，以及对 SQL Server 二进制文件的读取和执行权限。</span><span class="sxs-lookup"><span data-stu-id="d3392-167">By default all members of the Windows Builtin\Users group are granted permissions to connect on the local instance as well as read and execute permissions on the SQL Server binaries.</span></span> <span data-ttu-id="d3392-168">在对承载用户实例的调用用户的凭据进行验证后，该用户将成为该实例上的 `sysadmin`。</span><span class="sxs-lookup"><span data-stu-id="d3392-168">Once the credentials of the calling user hosting the user instance have been verified, that user becomes the `sysadmin` on that instance.</span></span> <span data-ttu-id="d3392-169">仅为用户实例启用共享内存，这意味着只能在本地计算机上执行操作。</span><span class="sxs-lookup"><span data-stu-id="d3392-169">Only shared memory is enabled for user instances, which means that only operations on the local machine are possible.</span></span>  
  
 <span data-ttu-id="d3392-170">必须为用户授予对在连接字符串中指定的 .mdf 和 .ldf 文件的读取和写入权限。</span><span class="sxs-lookup"><span data-stu-id="d3392-170">Users must be granted both read and write permissions on the .mdf and .ldf files specified in the connection string.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d3392-171">.mdf 和 .ldf 文件分别表示数据库和日志文件。</span><span class="sxs-lookup"><span data-stu-id="d3392-171">The .mdf and .ldf files represent the database and log files, respectively.</span></span> <span data-ttu-id="d3392-172">这两个文件是一个匹配的集，因此在备份和还原操作期间必须小心谨慎。</span><span class="sxs-lookup"><span data-stu-id="d3392-172">These two files are a matched set, so care must be taken during backup and restore operations.</span></span> <span data-ttu-id="d3392-173">数据库文件包含有关日志文件的确切版本的信息，如果数据库与错误的日志文件耦合，则该数据库将不会打开。</span><span class="sxs-lookup"><span data-stu-id="d3392-173">The database file contains information about the exact version of the log file, and the database will not open if it is coupled with the wrong log file.</span></span>  
  
 <span data-ttu-id="d3392-174">若要避免数据损坏，用户实例中的数据库将通过独占访问的方式打开。</span><span class="sxs-lookup"><span data-stu-id="d3392-174">To avoid data corruption, a database in the user instance is opened with exclusive access.</span></span> <span data-ttu-id="d3392-175">如果两个不同的用户实例共享同一台计算机上的同一个数据库，则第一个实例上的用户必须关闭该数据库，然后才能在第二个实例中打开数据库。</span><span class="sxs-lookup"><span data-stu-id="d3392-175">If two different user instances share the same database on the same computer, the user on the first instance must close the database before it can be opened in a second instance.</span></span>  
  
## <a name="user-instance-scenarios"></a><span data-ttu-id="d3392-176">用户实例方案</span><span class="sxs-lookup"><span data-stu-id="d3392-176">User Instance Scenarios</span></span>  

 <span data-ttu-id="d3392-177">用户实例为数据库应用程序开发人员提供了一个 SQL Server 数据存储区，该存储区不依赖于在其开发计算机上具有管理帐户的开发人员。</span><span class="sxs-lookup"><span data-stu-id="d3392-177">User instances provide developers of database applications with a SQL Server data store that does not depend on developers having administrative accounts on their development computers.</span></span> <span data-ttu-id="d3392-178">用户实例基于 Access/Jet 模型，在该模型中，数据库应用程序只连接到一个文件，用户自动对所有数据库对象具有完全权限，而不需要系统管理员干预来授予权限。</span><span class="sxs-lookup"><span data-stu-id="d3392-178">User instances are based on the Access/Jet model, where the database application simply connects to a file, and the user automatically has full permissions on all of the database objects without needing the intervention of a system administrator to grant permissions.</span></span> <span data-ttu-id="d3392-179">它适用于以下情况：用户在最低特权用户帐户 (LUA) 下运行，并且在服务器或本地计算机上没有管理权限，但需要创建数据库对象和应用程序。</span><span class="sxs-lookup"><span data-stu-id="d3392-179">It is intended to work in situations where the user is running under a least-privilege user account (LUA) and does not have administrative privileges on the server or local machine, yet needs to create database objects and applications.</span></span> <span data-ttu-id="d3392-180">用户实例允许用户在运行时创建在用户自己的安全上下文下运行的实例，而不是在具有更高权限的系统服务的安全上下文中运行的实例。</span><span class="sxs-lookup"><span data-stu-id="d3392-180">User instances allow users to create instances at run time that run under the user's own security context, and not in the security context of a more privileged system service.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="d3392-181">用户实例仅应在所有使用它的应用程序完全受信任的场景中使用。</span><span class="sxs-lookup"><span data-stu-id="d3392-181">User instances should only be used in scenarios where all the applications using it are fully trusted.</span></span>  
  
 <span data-ttu-id="d3392-182">用户实例场景包括：</span><span class="sxs-lookup"><span data-stu-id="d3392-182">User instance scenarios include:</span></span>  
  
- <span data-ttu-id="d3392-183">不需要共享数据的任何单用户应用程序。</span><span class="sxs-lookup"><span data-stu-id="d3392-183">Any single-user application where sharing data is not required.</span></span>  
  
- <span data-ttu-id="d3392-184">ClickOnce 部署。</span><span class="sxs-lookup"><span data-stu-id="d3392-184">ClickOnce deployment.</span></span> <span data-ttu-id="d3392-185">如果目标计算机上已安装 .NET Framework 2.0 (或更高版本) 和 SQL Server Express，则非管理员用户可以安装并使用作为 ClickOnce 操作的结果下载的安装包。</span><span class="sxs-lookup"><span data-stu-id="d3392-185">If .NET Framework 2.0 (or later) and SQL Server Express are already installed on the target computer, the installation package downloaded as a result of a ClickOnce action can be installed and used by non-administrator users.</span></span> <span data-ttu-id="d3392-186">请注意，如果 SQL Server Express 是安装的一部分，则管理员必须安装它。</span><span class="sxs-lookup"><span data-stu-id="d3392-186">Note that an administrator must install SQL Server Express if that is part of the setup.</span></span> <span data-ttu-id="d3392-187">有关详细信息，请参阅 [Windows 窗体的 ClickOnce 部署](/dotnet/desktop/winforms/clickonce-deployment-for-windows-forms)。</span><span class="sxs-lookup"><span data-stu-id="d3392-187">For more information, see [ClickOnce Deployment for Windows Forms](/dotnet/desktop/winforms/clickonce-deployment-for-windows-forms).</span></span>
  
- <span data-ttu-id="d3392-188">使用 Windows 身份验证的专用 ASP.NET 托管。</span><span class="sxs-lookup"><span data-stu-id="d3392-188">Dedicated ASP.NET hosting using Windows Authentication.</span></span> <span data-ttu-id="d3392-189">单个 SQL Server Express 实例可以承载在 Intranet 上。</span><span class="sxs-lookup"><span data-stu-id="d3392-189">A single SQL Server Express instance can be hosted on an intranet.</span></span> <span data-ttu-id="d3392-190">应用程序使用 ASPNET Windows 帐户进行连接，而不是使用模拟。</span><span class="sxs-lookup"><span data-stu-id="d3392-190">The application connects using the ASPNET Windows account, not by using impersonation.</span></span> <span data-ttu-id="d3392-191">用户实例不应用于第三方或共享托管场景，在这些场景中，所有应用程序将共享同一个用户实例，且不再彼此隔离。</span><span class="sxs-lookup"><span data-stu-id="d3392-191">User instances should not be used for third-party or shared hosting scenarios where all applications would share the same user instance and would no longer remain isolated from each other.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d3392-192">请参阅</span><span class="sxs-lookup"><span data-stu-id="d3392-192">See also</span></span>

- [<span data-ttu-id="d3392-193">SQL Server 和 ADO.NET</span><span class="sxs-lookup"><span data-stu-id="d3392-193">SQL Server and ADO.NET</span></span>](index.md)
- [<span data-ttu-id="d3392-194">连接字符串</span><span class="sxs-lookup"><span data-stu-id="d3392-194">Connection Strings</span></span>](../connection-strings.md)
- [<span data-ttu-id="d3392-195">连接到数据源</span><span class="sxs-lookup"><span data-stu-id="d3392-195">Connecting to a Data Source</span></span>](../connecting-to-a-data-source.md)
- [<span data-ttu-id="d3392-196">ADO.NET 概述</span><span class="sxs-lookup"><span data-stu-id="d3392-196">ADO.NET Overview</span></span>](../ado-net-overview.md)

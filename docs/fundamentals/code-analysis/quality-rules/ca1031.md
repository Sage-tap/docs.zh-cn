---
title: CA1031：不要捕捉一般异常类型（代码分析）
description: 了解代码分析规则 CA1031：不要捕捉一般异常类型
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- CA1031
- DoNotCatchGeneralExceptionTypes
helpviewer_keywords:
- CA1031
- DoNotCatchGeneralExceptionTypes
author: gewarren
ms.author: gewarren
dev_langs:
- CSharp
- VB
ms.openlocfilehash: 4ce9629a92f85b6402edce30916261d3effbd176
ms.sourcegitcommit: 05d0087dfca85aac9ca2960f86c5efd218bf833f
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/30/2021
ms.locfileid: "99547279"
---
# <a name="ca1031-do-not-catch-general-exception-types"></a><span data-ttu-id="db7de-103">CA1031:不要捕捉一般异常类型</span><span class="sxs-lookup"><span data-stu-id="db7de-103">CA1031: Do not catch general exception types</span></span>

| <span data-ttu-id="db7de-104">项</span><span class="sxs-lookup"><span data-stu-id="db7de-104">Item</span></span>                                     | <span data-ttu-id="db7de-105">“值”</span><span class="sxs-lookup"><span data-stu-id="db7de-105">Value</span></span>            |
|------------------------------------------|------------------|
| <span data-ttu-id="db7de-106">RuleId</span><span class="sxs-lookup"><span data-stu-id="db7de-106">RuleId</span></span>                                   | <span data-ttu-id="db7de-107">CA1031</span><span class="sxs-lookup"><span data-stu-id="db7de-107">CA1031</span></span>           |
| <span data-ttu-id="db7de-108">类别</span><span class="sxs-lookup"><span data-stu-id="db7de-108">Category</span></span>                                 | [<span data-ttu-id="db7de-109">Microsoft.Design</span><span class="sxs-lookup"><span data-stu-id="db7de-109">Microsoft.Design</span></span>](design-warnings.md) |
| <span data-ttu-id="db7de-110">修复是中断修复还是非中断修复</span><span class="sxs-lookup"><span data-stu-id="db7de-110">Fix is breaking or non-breaking</span></span> | <span data-ttu-id="db7de-111">非中断</span><span class="sxs-lookup"><span data-stu-id="db7de-111">Non-breaking</span></span>     |

## <a name="cause"></a><span data-ttu-id="db7de-112">原因</span><span class="sxs-lookup"><span data-stu-id="db7de-112">Cause</span></span>

<span data-ttu-id="db7de-113">在 `catch` 语句中捕捉到了 <xref:System.Exception?displayProperty=fullName> 或 <xref:System.SystemException?displayProperty=fullName> 等一般异常，或者已使用一般 catch 子句（如 `catch()`）。</span><span class="sxs-lookup"><span data-stu-id="db7de-113">A general exception such as <xref:System.Exception?displayProperty=fullName> or <xref:System.SystemException?displayProperty=fullName> is caught in a `catch` statement, or a general catch clause such as `catch()` is used.</span></span>

<span data-ttu-id="db7de-114">默认情况下，此规则仅标记要捕捉的一般异常类型，但这是[可配置的](#configure-code-to-analyze)。</span><span class="sxs-lookup"><span data-stu-id="db7de-114">By default, this rule only flags general exception types being caught, but this is [configurable](#configure-code-to-analyze).</span></span>

## <a name="rule-description"></a><span data-ttu-id="db7de-115">规则说明</span><span class="sxs-lookup"><span data-stu-id="db7de-115">Rule description</span></span>

<span data-ttu-id="db7de-116">不应捕捉一般异常。</span><span class="sxs-lookup"><span data-stu-id="db7de-116">General exceptions should not be caught.</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="db7de-117">如何解决冲突</span><span class="sxs-lookup"><span data-stu-id="db7de-117">How to fix violations</span></span>

<span data-ttu-id="db7de-118">若要解决此规则中的冲突，请捕捉更具体的异常，或者在执行 `catch` 块中的最后一条语句时重新引发一般异常。</span><span class="sxs-lookup"><span data-stu-id="db7de-118">To fix a violation of this rule, catch a more specific exception, or rethrow the general exception as the last statement in the `catch` block.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="db7de-119">何时禁止显示警告</span><span class="sxs-lookup"><span data-stu-id="db7de-119">When to suppress warnings</span></span>

<span data-ttu-id="db7de-120">不禁止显示此规则发出的警告。</span><span class="sxs-lookup"><span data-stu-id="db7de-120">Do not suppress a warning from this rule.</span></span> <span data-ttu-id="db7de-121">捕获一般异常类型可隐藏库用户的运行时问题，并且可能会使调试变得更加困难。</span><span class="sxs-lookup"><span data-stu-id="db7de-121">Catching general exception types can hide run-time problems from the library user and can make debugging more difficult.</span></span>

> [!NOTE]
> <span data-ttu-id="db7de-122">从 .NET Framework 4 开始，公共语言运行时 (CLR) 不再提供操作系统和托管代码中发生的损坏状态异常（例如，Windows 中的访问冲突），然后由托管代码来处理。</span><span class="sxs-lookup"><span data-stu-id="db7de-122">Starting with .NET Framework 4, the common language runtime (CLR) no longer delivers corrupted state exceptions that occur in the operating system and managed code, such as access violations in Windows, to be handled by managed code.</span></span> <span data-ttu-id="db7de-123">如果要在 .NET Framework 4 或更高版本中编译某个应用程序，并保留对损坏状态异常的处理，则可将 <xref:System.Runtime.ExceptionServices.HandleProcessCorruptedStateExceptionsAttribute> 特性应用于负责处理损坏状态异常的方法。</span><span class="sxs-lookup"><span data-stu-id="db7de-123">If you want to compile an application in .NET Framework 4 or later versions and maintain handling of corrupted state exceptions, you can apply the <xref:System.Runtime.ExceptionServices.HandleProcessCorruptedStateExceptionsAttribute> attribute to the method that handles the corrupted state exception.</span></span>

## <a name="configure-code-to-analyze"></a><span data-ttu-id="db7de-124">配置代码以进行分析</span><span class="sxs-lookup"><span data-stu-id="db7de-124">Configure code to analyze</span></span>

<span data-ttu-id="db7de-125">使用下面的选项来配置代码库的哪些部分要运行此规则。</span><span class="sxs-lookup"><span data-stu-id="db7de-125">Use the following option to configure which parts of your codebase to run this rule on.</span></span>

- [<span data-ttu-id="db7de-126">不允许的异常类型名称</span><span class="sxs-lookup"><span data-stu-id="db7de-126">Disallowed exception type names</span></span>](#disallowed-exception-type-names)

<span data-ttu-id="db7de-127">你可以仅为此规则、为所有规则或为此类别中的所有规则配置此选项（[设计](design-warnings.md)）。</span><span class="sxs-lookup"><span data-stu-id="db7de-127">You can configure this option for just this rule, for all rules, or for all rules in this category ([Design](design-warnings.md)).</span></span> <span data-ttu-id="db7de-128">有关详细信息，请参阅[代码质量规则配置选项](../code-quality-rule-options.md)。</span><span class="sxs-lookup"><span data-stu-id="db7de-128">For more information, see [Code quality rule configuration options](../code-quality-rule-options.md).</span></span>

### <a name="disallowed-exception-type-names"></a><span data-ttu-id="db7de-129">不允许的异常类型名称</span><span class="sxs-lookup"><span data-stu-id="db7de-129">Disallowed exception type names</span></span>

<span data-ttu-id="db7de-130">可配置不允许捕捉哪些异常类型。</span><span class="sxs-lookup"><span data-stu-id="db7de-130">You can configure which exception types are disallowed from being caught.</span></span> <span data-ttu-id="db7de-131">例如，若要指定规则应使用 `NullReferenceException` 标记 `catch` 处理程序，请将以下键值对添加到项目的 editorconfig 文件中：</span><span class="sxs-lookup"><span data-stu-id="db7de-131">For example, to specify that the rule should flag `catch` handlers with `NullReferenceException`, add the following key-value pair to an *.editorconfig* file in your project:</span></span>

```ini
dotnet_code_quality.CA1031.disallowed_symbol_names = NullReferenceException
```

<span data-ttu-id="db7de-132">选项值中允许的类型名称格式（用 `|` 分隔）：</span><span class="sxs-lookup"><span data-stu-id="db7de-132">Allowed type name formats in the option value (separated by `|`):</span></span>

- <span data-ttu-id="db7de-133">仅类型名称（包括具有相应名称的所有符号，不考虑包含的类型或命名空间）</span><span class="sxs-lookup"><span data-stu-id="db7de-133">Type name only (includes all symbols with the name, regardless of the containing type or namespace)</span></span>
- <span data-ttu-id="db7de-134">完全限定的名称，使用符号的[文档 ID 格式](../../../csharp/programming-guide/xmldoc/processing-the-xml-file.md#id-strings)，前缀为 `T:`。</span><span class="sxs-lookup"><span data-stu-id="db7de-134">Fully qualified names in the symbol's [documentation ID format](../../../csharp/programming-guide/xmldoc/processing-the-xml-file.md#id-strings) with a `T:` prefix.</span></span>

<span data-ttu-id="db7de-135">示例：</span><span class="sxs-lookup"><span data-stu-id="db7de-135">Examples:</span></span>

| <span data-ttu-id="db7de-136">选项值</span><span class="sxs-lookup"><span data-stu-id="db7de-136">Option Value</span></span> | <span data-ttu-id="db7de-137">总结</span><span class="sxs-lookup"><span data-stu-id="db7de-137">Summary</span></span> |
| --- | --- |
|`dotnet_code_quality.CA1031.disallowed_symbol_names = ExceptionType` | <span data-ttu-id="db7de-138">匹配编译中名为“ExceptionType”的所有符号</span><span class="sxs-lookup"><span data-stu-id="db7de-138">Matches all symbols named 'ExceptionType' in the compilation</span></span>
|`dotnet_code_quality.CA1031.disallowed_symbol_names = ExceptionType1|ExceptionType2` | <span data-ttu-id="db7de-139">匹配编译中名为“ExceptionType1”或“ExceptionType2”的所有符号</span><span class="sxs-lookup"><span data-stu-id="db7de-139">Matches all symbols named either 'ExceptionType1' or 'ExceptionType2' in the compilation</span></span>
|`dotnet_code_quality.CA1031.disallowed_symbol_names = T:NS.ExceptionType` | <span data-ttu-id="db7de-140">将名为“ExceptionType”的特定类型与给定的完全限定名称进行匹配。</span><span class="sxs-lookup"><span data-stu-id="db7de-140">Matches specific types named 'ExceptionType' with given fully qualified name.</span></span>
|`dotnet_code_quality.CA1031.disallowed_symbol_names = T:NS1.ExceptionType1|T:NS1.ExceptionType2` | <span data-ttu-id="db7de-141">将名为“ExceptionType1”和“ExceptionType2”的类型与各自的完全限定名称进行匹配</span><span class="sxs-lookup"><span data-stu-id="db7de-141">Matches types named 'ExceptionType1' and 'ExceptionType2' with respective fully qualified names</span></span>

<span data-ttu-id="db7de-142">你可以仅为此规则、为所有规则或为此类别（[设计](design-warnings.md)）中的所有规则配置这些选项。</span><span class="sxs-lookup"><span data-stu-id="db7de-142">You can configure these options for just this rule, for all rules, or for all rules in this category ([Design](design-warnings.md)).</span></span> <span data-ttu-id="db7de-143">有关详细信息，请参阅[代码质量规则配置选项](../code-quality-rule-options.md)。</span><span class="sxs-lookup"><span data-stu-id="db7de-143">For more information, see [Code quality rule configuration options](../code-quality-rule-options.md).</span></span>

## <a name="example"></a><span data-ttu-id="db7de-144">示例</span><span class="sxs-lookup"><span data-stu-id="db7de-144">Example</span></span>

<span data-ttu-id="db7de-145">以下示例显示与此规则冲突的类型，以及能正确实现 `catch` 块的类型。</span><span class="sxs-lookup"><span data-stu-id="db7de-145">The following example shows a type that violates this rule and a type that correctly implements the `catch` block.</span></span>

:::code language="vb" source="snippets/vb/all-rules/ca1031-do-not-catch-general-exception-types_1.vb":::

:::code language="csharp" source="snippets/csharp/all-rules/ca1031.cs" id="snippet1":::

## <a name="related-rules"></a><span data-ttu-id="db7de-146">相关规则</span><span class="sxs-lookup"><span data-stu-id="db7de-146">Related rules</span></span>

[<span data-ttu-id="db7de-147">CA2200:再次引发以保留堆栈详细信息</span><span class="sxs-lookup"><span data-stu-id="db7de-147">CA2200: Rethrow to preserve stack details</span></span>](ca2200.md)

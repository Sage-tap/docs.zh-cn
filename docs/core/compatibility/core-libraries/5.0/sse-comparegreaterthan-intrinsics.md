---
title: 中断性变更：SSE 和 SSE2 CompareGreaterThan 方法正确处理 NaN 输入
description: 了解核心 .NET 库中的 .NET 5 中断性变更：SSE 和 SSE2 比较方法已经过修复，现可正确处理 NaN 输入。
ms.date: 11/01/2020
ms.openlocfilehash: 23955f08f70d82635a0a93b9bbb9a05efbbab6a9
ms.sourcegitcommit: 9c589b25b005b9a7f87327646020eb85c3b6306f
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/06/2021
ms.locfileid: "102257110"
---
# <a name="sse-and-sse2-comparegreaterthan-methods-properly-handle-nan-inputs"></a><span data-ttu-id="85286-103">SSE 和 SSE2 CompareGreaterThan 方法正确处理 NaN 输入</span><span class="sxs-lookup"><span data-stu-id="85286-103">SSE and SSE2 CompareGreaterThan methods properly handle NaN inputs</span></span>

<span data-ttu-id="85286-104">以下 <xref:System.Runtime.Intrinsics.X86.Sse?displayProperty=nameWithType> 和 <xref:System.Runtime.Intrinsics.X86.Sse2?displayProperty=nameWithType> 方法已修复为正确处理 `NaN` 输入，并匹配 <xref:System.Runtime.Intrinsics.X86.Avx?displayProperty=nameWithType> 类中等效方法的硬件行为：</span><span class="sxs-lookup"><span data-stu-id="85286-104">The following <xref:System.Runtime.Intrinsics.X86.Sse?displayProperty=nameWithType> and <xref:System.Runtime.Intrinsics.X86.Sse2?displayProperty=nameWithType> methods have been fixed to properly handle `NaN` inputs and match the hardware behavior of the equivalent methods in the <xref:System.Runtime.Intrinsics.X86.Avx?displayProperty=nameWithType> class:</span></span>

* `CompareGreaterThan`
* `CompareGreaterThanOrEqual`
* `CompareNotGreaterThan`
* `CompareNotGreaterThanOrEqual`
* `CompareScalarGreaterThan`
* `CompareScalarGreaterThanOrEqual`
* `CompareScalarNotGreaterThan`
* `CompareScalarNotGreaterThanOrEqual`

## <a name="change-description"></a><span data-ttu-id="85286-105">更改描述</span><span class="sxs-lookup"><span data-stu-id="85286-105">Change description</span></span>

<span data-ttu-id="85286-106">以前，向列出的 <xref:System.Runtime.Intrinsics.X86.Sse> 和 <xref:System.Runtime.Intrinsics.X86.Sse2> 方法提供 `NaN` 输入所返回的结果不正确。</span><span class="sxs-lookup"><span data-stu-id="85286-106">Previously, `NaN` inputs to the listed <xref:System.Runtime.Intrinsics.X86.Sse> and <xref:System.Runtime.Intrinsics.X86.Sse2> methods returned an incorrect result.</span></span> <span data-ttu-id="85286-107">此结果也不同于 <xref:System.Runtime.Intrinsics.X86.Avx> 类中相应方法生成的结果。</span><span class="sxs-lookup"><span data-stu-id="85286-107">The result also differed from the result generated by the corresponding method in the <xref:System.Runtime.Intrinsics.X86.Avx> class.</span></span>

<span data-ttu-id="85286-108">从 .NET 5 开始，这些方法会正确地处理 `NaN` 输入，并返回与 <xref:System.Runtime.Intrinsics.X86.Avx> 类中相应方法相同的结果。</span><span class="sxs-lookup"><span data-stu-id="85286-108">Starting in .NET 5, these methods correctly handle `NaN` inputs and return the same results as the corresponding methods in the <xref:System.Runtime.Intrinsics.X86.Avx> class.</span></span>

<span data-ttu-id="85286-109">流式处理 SIMD 扩展 (SSE) 和流式处理 SIMD 扩展 2 (SSE2) 行业标准体系结构 (ISA) 没有为这些比较方法提供直接的硬件支持，因此它们是在软件中实现的。</span><span class="sxs-lookup"><span data-stu-id="85286-109">The Streaming SIMD Extensions (SSE) and Streaming SIMD Extensions 2 (SSE2) industry standard architectures (ISAs) don't provide direct hardware support for these comparison methods, so they're implemented in software.</span></span> <span data-ttu-id="85286-110">以前，这些方法没有得到正确的实现，也没有正确地处理 `NaN` 输入。</span><span class="sxs-lookup"><span data-stu-id="85286-110">Previously, the methods were improperly implemented, and they incorrectly handled `NaN` inputs.</span></span> <span data-ttu-id="85286-111">对于从本机移植的代码，不正确的行为可能会引入 bug。</span><span class="sxs-lookup"><span data-stu-id="85286-111">For code ported from native, the incorrect behavior may introduce bugs.</span></span> <span data-ttu-id="85286-112">对于 256 位代码路径，这些方法可能还会生成与 <xref:System.Runtime.Intrinsics.X86.Avx> 类中等效方法不同的结果。</span><span class="sxs-lookup"><span data-stu-id="85286-112">For a 256-bit code path, the methods can also produce different results to the equivalent methods in the <xref:System.Runtime.Intrinsics.X86.Avx> class.</span></span>

<span data-ttu-id="85286-113">有关说明这些方法以前是如何不正确的示例，可以为常规整数将 `CompareNotGreaterThan(x,y)` 实现为 `CompareLessThanOrEqual(x,y)`。</span><span class="sxs-lookup"><span data-stu-id="85286-113">As an example of how the methods were previously incorrect, you can implement `CompareNotGreaterThan(x,y)` as `CompareLessThanOrEqual(x,y)` for regular integers.</span></span> <span data-ttu-id="85286-114">不过，对于 `NaN` 输入，相应逻辑计算出的结果不正确。</span><span class="sxs-lookup"><span data-stu-id="85286-114">However, for `NaN` inputs, that logic computes the wrong result.</span></span> <span data-ttu-id="85286-115">相反，使用 `CompareNotLessThan(y,x)` 可以正确地比较数字，并  考虑 `NaN` 输入。</span><span class="sxs-lookup"><span data-stu-id="85286-115">Instead, using `CompareNotLessThan(y,x)` compares the numbers correctly *and* takes `NaN` inputs into consideration.</span></span>

## <a name="version-introduced"></a><span data-ttu-id="85286-116">引入的版本</span><span class="sxs-lookup"><span data-stu-id="85286-116">Version introduced</span></span>

<span data-ttu-id="85286-117">5.0</span><span class="sxs-lookup"><span data-stu-id="85286-117">5.0</span></span>

## <a name="recommended-action"></a><span data-ttu-id="85286-118">建议操作</span><span class="sxs-lookup"><span data-stu-id="85286-118">Recommended action</span></span>

- <span data-ttu-id="85286-119">如果以前的行为是 bug，则不需要进行任何更改。</span><span class="sxs-lookup"><span data-stu-id="85286-119">If the previous behavior was a bug, no change is required.</span></span>

- <span data-ttu-id="85286-120">如果需要以前的行为，则可以通过更改相关调用来维护此行为，如下所示：</span><span class="sxs-lookup"><span data-stu-id="85286-120">If the previous behavior was desired, you can maintain that behavior by changing the relevant invocation as follows:</span></span>

  * `CompareGreaterThan(x,y)` -> `CompareNotLessThanOrEqual(x,y)`
  * `CompareGreaterThanOrEqual(x,y)` -> `CompareNotLessThan(x,y)`
  * `CompareNotGreaterThan(x,y)` -> `CompareLessThanOrEqual(x,y)`
  * `CompareNotGreaterThanOrEqual(x,y)` -> `CompareLessThan(x,y)`
  * `CompareScalarGreaterThan(x,y)` -> `CompareScalarNotLessThanOrEqual(x,y)`
  * `CompareScalarGreaterThanOrEqual(x,y)` -> `CompareScalarNotLessThan(x,y)`
  * `CompareScalarNotGreaterThan(x,y)` -> `CompareScalarLessThanOrEqual(x,y)`
  * `CompareScalarNotGreaterThanOrEqual(x,y)` -> `CompareScalarLessThan(x,y)`

## <a name="affected-apis"></a><span data-ttu-id="85286-121">受影响的 API</span><span class="sxs-lookup"><span data-stu-id="85286-121">Affected APIs</span></span>

- <xref:System.Runtime.Intrinsics.X86.Sse.CompareGreaterThan(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})?displayProperty=fullName>
- <xref:System.Runtime.Intrinsics.X86.Sse.CompareGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})?displayProperty=fullName>
- <xref:System.Runtime.Intrinsics.X86.Sse.CompareNotGreaterThan(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})?displayProperty=fullName>
- <xref:System.Runtime.Intrinsics.X86.Sse.CompareNotGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})?displayProperty=fullName>
- <xref:System.Runtime.Intrinsics.X86.Sse.CompareScalarGreaterThan(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})?displayProperty=fullName>
- <xref:System.Runtime.Intrinsics.X86.Sse.CompareScalarGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})?displayProperty=fullName>
- <xref:System.Runtime.Intrinsics.X86.Sse.CompareScalarNotGreaterThan(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})?displayProperty=fullName>
- <xref:System.Runtime.Intrinsics.X86.Sse.CompareScalarNotGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})?displayProperty=fullName>

- <xref:System.Runtime.Intrinsics.X86.Sse2.CompareGreaterThan(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})?displayProperty=fullName>
- <xref:System.Runtime.Intrinsics.X86.Sse2.CompareGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})?displayProperty=fullName>
- <xref:System.Runtime.Intrinsics.X86.Sse2.CompareNotGreaterThan(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})?displayProperty=fullName>
- <xref:System.Runtime.Intrinsics.X86.Sse2.CompareNotGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})?displayProperty=fullName>
- <xref:System.Runtime.Intrinsics.X86.Sse2.CompareScalarGreaterThan(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})?displayProperty=fullName>
- <xref:System.Runtime.Intrinsics.X86.Sse2.CompareScalarGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})?displayProperty=fullName>
- <xref:System.Runtime.Intrinsics.X86.Sse2.CompareScalarNotGreaterThan(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})?displayProperty=fullName>
- <xref:System.Runtime.Intrinsics.X86.Sse2.CompareScalarNotGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})?displayProperty=fullName>

<!--

#### Category

Core .NET libraries

### Affected APIs

- `M:System.Runtime.Intrinsics.X86.Sse.CompareGreaterThan(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})`
- `M:System.Runtime.Intrinsics.X86.Sse.CompareGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})`
- `M:System.Runtime.Intrinsics.X86.Sse.CompareNotGreaterThan(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})`
- `M:System.Runtime.Intrinsics.X86.Sse.CompareNotGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})`
- `M:System.Runtime.Intrinsics.X86.Sse.CompareScalarGreaterThan(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})`
- `M:System.Runtime.Intrinsics.X86.Sse.CompareScalarGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})`
- `M:System.Runtime.Intrinsics.X86.Sse.CompareScalarNotGreaterThan(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})`
- `M:System.Runtime.Intrinsics.X86.Sse.CompareScalarNotGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})`

- `M:System.Runtime.Intrinsics.X86.Sse2.CompareGreaterThan(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})`
- `M:System.Runtime.Intrinsics.X86.Sse2.CompareGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})`
- `M:System.Runtime.Intrinsics.X86.Sse2.CompareNotGreaterThan(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})`
- `M:System.Runtime.Intrinsics.X86.Sse2.CompareNotGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})`
- `M:System.Runtime.Intrinsics.X86.Sse2.CompareScalarGreaterThan(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})`
- `M:System.Runtime.Intrinsics.X86.Sse2.CompareScalarGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})`
- `M:System.Runtime.Intrinsics.X86.Sse2.CompareScalarNotGreaterThan(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})`
- `M:System.Runtime.Intrinsics.X86.Sse2.CompareScalarNotGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})`

-->

---
title: 主体和标识对象
description: 阅读表示 .NET 中的用户的标识对象。 另请参阅主体对象，这些对象将标识对象封装 & 角色。
ms.date: 07/15/2020
helpviewer_keywords:
- WindowsIdentity objects
- GenericIdentity objects
- GenericPrincipal objects
- identity objects, about identity objects
- security [.NET], identity objects
- principal objects, about principal objects
- security [.NET], principals
- WindowsPrincipal objects
ms.assetid: aa5930ad-f3d7-40aa-b6f6-c6edcd5c64f7
ms.openlocfilehash: daa851e22ab70826395fa86a4d3aae9901e01be7
ms.sourcegitcommit: aab60b21144bf04b3057b5d59aa7c58edaef32d1
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/14/2021
ms.locfileid: "107494410"
---
# <a name="principal-and-identity-objects"></a><span data-ttu-id="b625b-104">主体和标识对象</span><span class="sxs-lookup"><span data-stu-id="b625b-104">Principal and Identity Objects</span></span>

> [!NOTE]
> <span data-ttu-id="b625b-105">本文适用于 Windows。</span><span class="sxs-lookup"><span data-stu-id="b625b-105">This article applies to Windows.</span></span>
>
> <span data-ttu-id="b625b-106">有关 ASP.NET Core 的信息，请参阅 [ASP.NET Core 安全性](/aspnet/core/security/)。</span><span class="sxs-lookup"><span data-stu-id="b625b-106">For information about ASP.NET Core, see [ASP.NET Core Security](/aspnet/core/security/).</span></span>

<span data-ttu-id="b625b-107">托管代码可以通过包含对对象的引用的对象发现标识或主体的角色 <xref:System.Security.Principal.IPrincipal> <xref:System.Security.Principal.IIdentity> 。</span><span class="sxs-lookup"><span data-stu-id="b625b-107">Managed code can discover the identity or the role of a principal through a <xref:System.Security.Principal.IPrincipal> object, which contains a reference to an <xref:System.Security.Principal.IIdentity> object.</span></span> <span data-ttu-id="b625b-108">将标识对象和主体对象同用户帐户与组帐户这样常见的概念进行比较，可能会有所帮助。</span><span class="sxs-lookup"><span data-stu-id="b625b-108">It might be helpful to compare identity and principal objects to familiar concepts like user and group accounts.</span></span> <span data-ttu-id="b625b-109">在大多数网络环境中，用户帐户表示人员或程序，而组帐户表示特定类别的用户及其拥有的权限。</span><span class="sxs-lookup"><span data-stu-id="b625b-109">In most network environments, user accounts represent people or programs, while group accounts represent certain categories of users and the rights they possess.</span></span> <span data-ttu-id="b625b-110">同样，.NET identity 对象表示用户，而角色表示成员身份和安全上下文。</span><span class="sxs-lookup"><span data-stu-id="b625b-110">Similarly, .NET identity objects represent users, while roles represent memberships and security contexts.</span></span> <span data-ttu-id="b625b-111">在 .NET 中，主体对象同时封装标识对象和角色。</span><span class="sxs-lookup"><span data-stu-id="b625b-111">In .NET, the principal object encapsulates both an identity object and a role.</span></span> <span data-ttu-id="b625b-112">.NET 应用程序基于其标识或更常见的角色成员身份向主体授予权限。</span><span class="sxs-lookup"><span data-stu-id="b625b-112">.NET applications grant rights to the principal based on its identity or, more commonly, its role membership.</span></span>  
  
## <a name="identity-objects"></a><span data-ttu-id="b625b-113">标识对象</span><span class="sxs-lookup"><span data-stu-id="b625b-113">Identity Objects</span></span>

<span data-ttu-id="b625b-114">标识对象封装有关正在验证的用户或实体的信息。</span><span class="sxs-lookup"><span data-stu-id="b625b-114">The identity object encapsulates information about the user or entity being validated.</span></span> <span data-ttu-id="b625b-115">在最基本的级别上，标识对象包含名称和身份验证类型。</span><span class="sxs-lookup"><span data-stu-id="b625b-115">At their most basic level, identity objects contain a name and an authentication type.</span></span> <span data-ttu-id="b625b-116">名称可以是用户名或 Windows 帐户名，而身份验证类型可以是所支持的登录协议（如 Kerberos V5）或自定义值。</span><span class="sxs-lookup"><span data-stu-id="b625b-116">The name can either be a user's name or the name of a Windows account, while the authentication type can be either a supported logon protocol, such as Kerberos V5, or a custom value.</span></span> <span data-ttu-id="b625b-117">.NET 定义一个 <xref:System.Security.Principal.GenericIdentity> 对象，该对象可用于大多数自定义登录方案和一个更专用的 <xref:System.Security.Principal.WindowsIdentity> 对象，当你希望你的应用程序依赖于 Windows 身份验证时，可以使用该对象。</span><span class="sxs-lookup"><span data-stu-id="b625b-117">.NET defines a <xref:System.Security.Principal.GenericIdentity> object that can be used for most custom logon scenarios and a more specialized <xref:System.Security.Principal.WindowsIdentity> object that can be used when you want your application to rely on Windows authentication.</span></span> <span data-ttu-id="b625b-118">此外，还可以定义自己的标识类来封装自定义用户信息。</span><span class="sxs-lookup"><span data-stu-id="b625b-118">Additionally, you can define your own identity class that encapsulates custom user information.</span></span>  
  
<span data-ttu-id="b625b-119"><xref:System.Security.Principal.IIdentity>接口定义用于访问名称和身份验证类型（如 Kerberos V5 或 NTLM）的属性。</span><span class="sxs-lookup"><span data-stu-id="b625b-119">The <xref:System.Security.Principal.IIdentity> interface defines properties for accessing a name and an authentication type, such as Kerberos V5 or NTLM.</span></span> <span data-ttu-id="b625b-120">所有 **Identity** 类均实现 **IIdentity** 接口。</span><span class="sxs-lookup"><span data-stu-id="b625b-120">All **Identity** classes implement the **IIdentity** interface.</span></span> <span data-ttu-id="b625b-121">**标识** 对象与当前正在执行线程的 Windows 进程标记之间没有必需的关系。</span><span class="sxs-lookup"><span data-stu-id="b625b-121">There is no required relationship between an **Identity** object and the Windows process token under which a thread is currently executing.</span></span> <span data-ttu-id="b625b-122">但是，如果 **identity** 对象是 **WindowsIdentity** 对象，则假定该标识表示 Windows 安全标记。</span><span class="sxs-lookup"><span data-stu-id="b625b-122">However, if the **Identity** object is a **WindowsIdentity** object, the identity is assumed to represent a Windows security token.</span></span>  
  
## <a name="principal-objects"></a><span data-ttu-id="b625b-123">主体对象</span><span class="sxs-lookup"><span data-stu-id="b625b-123">Principal Objects</span></span>

<span data-ttu-id="b625b-124">主体对象表示代码运行时所在的安全性上下文。</span><span class="sxs-lookup"><span data-stu-id="b625b-124">The principal object represents the security context under which code is running.</span></span> <span data-ttu-id="b625b-125">实现基于角色的安全性的应用程序基于与主体对象关联的角色来授予权限。</span><span class="sxs-lookup"><span data-stu-id="b625b-125">Applications that implement role-based security grant rights based on the role associated with a principal object.</span></span> <span data-ttu-id="b625b-126">与标识对象类似，.NET 提供了一个 <xref:System.Security.Principal.GenericPrincipal> 对象和一个 <xref:System.Security.Principal.WindowsPrincipal> 对象。</span><span class="sxs-lookup"><span data-stu-id="b625b-126">Similar to identity objects, .NET provides a <xref:System.Security.Principal.GenericPrincipal> object and a <xref:System.Security.Principal.WindowsPrincipal> object.</span></span> <span data-ttu-id="b625b-127">你还可以定义自己的自定义主体类。</span><span class="sxs-lookup"><span data-stu-id="b625b-127">You can also define your own custom principal classes.</span></span>  
  
<span data-ttu-id="b625b-128"><xref:System.Security.Principal.IPrincipal>接口定义用于访问关联的 **标识** 对象的属性，以及用于确定由 **主体** 对象标识的用户是否是给定角色的成员的方法。</span><span class="sxs-lookup"><span data-stu-id="b625b-128">The <xref:System.Security.Principal.IPrincipal> interface defines a property for accessing an associated **Identity** object as well as a method for determining whether the user identified by the **Principal** object is a member of a given role.</span></span> <span data-ttu-id="b625b-129">所有 **Principal** 类都实现 **IPrincipal** 接口以及任何必需的附加属性和方法。</span><span class="sxs-lookup"><span data-stu-id="b625b-129">All **Principal** classes implement the **IPrincipal** interface as well as any additional properties and methods that are necessary.</span></span> <span data-ttu-id="b625b-130">例如，公共语言运行时提供 **WindowsPrincipal** 类，该类实现将组成员身份映射到角色的附加功能。</span><span class="sxs-lookup"><span data-stu-id="b625b-130">For example, the common language runtime provides the **WindowsPrincipal** class, which implements additional functionality for mapping group membership to roles.</span></span>  
  
<span data-ttu-id="b625b-131">**主体** 对象被绑定到 <xref:System.Runtime.Remoting.Messaging.CallContext> 应用程序域 () 中 () 对象的调用上下文 <xref:System.AppDomain> 。</span><span class="sxs-lookup"><span data-stu-id="b625b-131">A **Principal** object is bound to a call context (<xref:System.Runtime.Remoting.Messaging.CallContext>) object within an application domain (<xref:System.AppDomain>).</span></span> <span data-ttu-id="b625b-132">默认的调用上下文始终用每个新的 **AppDomain** 创建，因此始终存在可用于接受 **Principal** 对象的调用上下文。</span><span class="sxs-lookup"><span data-stu-id="b625b-132">A default call context is always created with each new **AppDomain**, so there is always a call context available to accept the **Principal** object.</span></span> <span data-ttu-id="b625b-133">创建新线程的同时也为该线程创建 **CallContext** 对象。</span><span class="sxs-lookup"><span data-stu-id="b625b-133">When a new thread is created, a **CallContext** object is also created for the thread.</span></span> <span data-ttu-id="b625b-134">**Principal** 对象引用从正在创建的线程自动复制到新线程的 **CallContext** 中。</span><span class="sxs-lookup"><span data-stu-id="b625b-134">The **Principal** object reference is automatically copied from the creating thread to the new thread's **CallContext**.</span></span> <span data-ttu-id="b625b-135">如果运行时无法确定哪个 **Principal** 对象属于线程的创建者，则会遵循 **Principal** 和 **Identity** 对象创建的默认策略。</span><span class="sxs-lookup"><span data-stu-id="b625b-135">If the runtime cannot determine which **Principal** object belongs to the creator of the thread, it follows the default policy for **Principal** and **Identity** object creation.</span></span>  
  
<span data-ttu-id="b625b-136">可配置的应用程序域特定策略定义了一些规则，用以决定同新的应用程序域关联的 **Principal** 对象类型。</span><span class="sxs-lookup"><span data-stu-id="b625b-136">A configurable application domain-specific policy defines the rules for deciding what type of **Principal** object to associate with a new application domain.</span></span> <span data-ttu-id="b625b-137">在安全策略的允许范围内，运行时可创建 **Principal** 和 **Identity** 对象来反射与当前执行线程关联的操作系统标记。</span><span class="sxs-lookup"><span data-stu-id="b625b-137">Where security policy permits, the runtime can create **Principal** and **Identity** objects that reflect the operating system token associated with the current thread of execution.</span></span> <span data-ttu-id="b625b-138">默认情况下，运行时使用 **Principal** 和 **Identity** 对象表示未经身份验证的用户。</span><span class="sxs-lookup"><span data-stu-id="b625b-138">By default, the runtime uses **Principal** and **Identity** objects that represent unauthenticated users.</span></span> <span data-ttu-id="b625b-139">运行时不创建这些默认的 **Principal** 和 **Identity** 对象，除非代码尝试访问它们。</span><span class="sxs-lookup"><span data-stu-id="b625b-139">The runtime does not create these default **Principal** and **Identity** objects until the code attempts to access them.</span></span>  
  
<span data-ttu-id="b625b-140">创建应用程序域的受信任代码可设置应用程序域策略，以控制默认 **Principal** 和 **Identity** 对象的构造。</span><span class="sxs-lookup"><span data-stu-id="b625b-140">Trusted code that creates an application domain can set the application domain policy that controls construction of the default **Principal** and **Identity** objects.</span></span> <span data-ttu-id="b625b-141">此应用程序域特定策略适用于该应用程序域中的所有执行线程。</span><span class="sxs-lookup"><span data-stu-id="b625b-141">This application domain-specific policy applies to all execution threads in that application domain.</span></span> <span data-ttu-id="b625b-142">非托管的受信任主机本质上能够设置此策略，但设置此策略的托管代码必须具有 <xref:System.Security.Permissions.SecurityPermission?displayProperty=nameWithType> 用于控制域策略的。</span><span class="sxs-lookup"><span data-stu-id="b625b-142">An unmanaged, trusted host inherently has the ability to set this policy, but managed code that sets this policy must have the <xref:System.Security.Permissions.SecurityPermission?displayProperty=nameWithType> for controlling domain policy.</span></span>  
  
<span data-ttu-id="b625b-143">在不同的应用程序域之间、但在同一进程内（因此在同一台计算机上）传输 **Principal** 对象时，远程处理基础结构将与调用方上下文相关联的、对 **Principal** 对象的引用复制到被调用方的上下文中。</span><span class="sxs-lookup"><span data-stu-id="b625b-143">When transmitting a **Principal** object across application domains but within the same process (and therefore on the same computer), the remoting infrastructure copies a reference to the **Principal** object associated with the caller's context to the callee's context.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b625b-144">另请参阅</span><span class="sxs-lookup"><span data-stu-id="b625b-144">See also</span></span>

- [<span data-ttu-id="b625b-145">如何：创建 WindowsPrincipal 对象</span><span class="sxs-lookup"><span data-stu-id="b625b-145">How to: Create a WindowsPrincipal Object</span></span>](how-to-create-a-windowsprincipal-object.md)
- [<span data-ttu-id="b625b-146">如何：创建 GenericPrincipal 和 GenericIdentity 对象</span><span class="sxs-lookup"><span data-stu-id="b625b-146">How to: Create GenericPrincipal and GenericIdentity Objects</span></span>](how-to-create-genericprincipal-and-genericidentity-objects.md)
- [<span data-ttu-id="b625b-147">替换 Principal 对象</span><span class="sxs-lookup"><span data-stu-id="b625b-147">Replacing a Principal Object</span></span>](replacing-a-principal-object.md)
- [<span data-ttu-id="b625b-148">模拟与恢复</span><span class="sxs-lookup"><span data-stu-id="b625b-148">Impersonating and Reverting</span></span>](impersonating-and-reverting.md)
- [<span data-ttu-id="b625b-149">基于角色的安全性</span><span class="sxs-lookup"><span data-stu-id="b625b-149">Role-Based Security</span></span>](role-based-security.md)
- [<span data-ttu-id="b625b-150">安全性的基础概念</span><span class="sxs-lookup"><span data-stu-id="b625b-150">Key Security Concepts</span></span>](key-security-concepts.md)
- [<span data-ttu-id="b625b-151">ASP.NET Core 安全性</span><span class="sxs-lookup"><span data-stu-id="b625b-151">ASP.NET Core Security</span></span>](/aspnet/core/security/)

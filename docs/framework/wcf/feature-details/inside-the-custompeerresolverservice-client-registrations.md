---
description: 了解有关以下内容的详细信息： CustomPeerResolverService：客户端注册
title: CustomPeerResolverService 内部：客户端注册
ms.date: 03/30/2017
ms.assetid: 40236953-a916-4236-84a6-928859e1331a
ms.openlocfilehash: 2cc0706fc473985cf6572e6ee5387a26366bc2c8
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/06/2021
ms.locfileid: "99802835"
---
# <a name="inside-the-custompeerresolverservice-client-registrations"></a><span data-ttu-id="476de-103">CustomPeerResolverService 内部：客户端注册</span><span class="sxs-lookup"><span data-stu-id="476de-103">Inside the CustomPeerResolverService: Client Registrations</span></span>

<span data-ttu-id="476de-104">网格中的每个节点都通过 `Register` 函数，将自己的终结点信息发布到解析程序服务。</span><span class="sxs-lookup"><span data-stu-id="476de-104">Each node in the mesh publishes its endpoint information to the resolver service through the `Register` function.</span></span> <span data-ttu-id="476de-105">解析程序服务将此信息存储为注册记录。</span><span class="sxs-lookup"><span data-stu-id="476de-105">The resolver service stores this information as a registration record.</span></span> <span data-ttu-id="476de-106">此记录包含节点的唯一标识符 (RegistrationID) 和终结点信息 (PeerNodeAddress)。</span><span class="sxs-lookup"><span data-stu-id="476de-106">This record contains a unique identifier (RegistrationID) and endpoint information (PeerNodeAddress) for the node.</span></span>  
  
## <a name="stale-records-and-expiration-time"></a><span data-ttu-id="476de-107">过时记录和过期时间</span><span class="sxs-lookup"><span data-stu-id="476de-107">Stale Records and Expiration Time</span></span>  

 <span data-ttu-id="476de-108">理想情况下，当节点离开网格时，它将调用 `Unregister` 函数，让解析程序服务删除相关注册项。</span><span class="sxs-lookup"><span data-stu-id="476de-108">Ideally, when a node leaves the mesh, it will call the `Unregister` function, which causes the resolver service to remove the registration entry.</span></span> <span data-ttu-id="476de-109">有时，节点会在调用 `Unregister` 之前关闭或无法访问，从而留下过时的注册记录。</span><span class="sxs-lookup"><span data-stu-id="476de-109">Sometimes, nodes shut down or become inaccessible before calling `Unregister`, leaving behind a stale registration record.</span></span>  
  
 <span data-ttu-id="476de-110">解析程序服务中的过时记录可能导致连接失败。</span><span class="sxs-lookup"><span data-stu-id="476de-110">Stale records in your resolver service can cause failed connections.</span></span> <span data-ttu-id="476de-111">如果尝试连接到网格的节点从解析程序服务收到过时的连接信息，则需要更长的时间才能成功加入网格。</span><span class="sxs-lookup"><span data-stu-id="476de-111">If a node trying to connect to a mesh receives stale connection information from the resolver service, it can take longer to successfully join the mesh.</span></span> <span data-ttu-id="476de-112">过时记录还会占用内存。</span><span class="sxs-lookup"><span data-stu-id="476de-112">Stale records also take up memory.</span></span> <span data-ttu-id="476de-113">如果没有有效的清除过程，用于存储注册的缓存最终可能会溢出，并使解析程序服务崩溃。</span><span class="sxs-lookup"><span data-stu-id="476de-113">Without an efficient clean up process, the cache used to store registrations could eventually overflow and crash the resolver service.</span></span>  
  
 <span data-ttu-id="476de-114"><xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> 用过期时间 (DateTime) 标记每条记录，并将该信息存储在记录中。</span><span class="sxs-lookup"><span data-stu-id="476de-114">The <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> marks each record with an expiration time (DateTime), and stores that information as part of the record.</span></span> <span data-ttu-id="476de-115">服务使用过期时间来标识过时的记录。</span><span class="sxs-lookup"><span data-stu-id="476de-115">The service uses the expiration time to identify stale records.</span></span> <span data-ttu-id="476de-116">自定义实现应执行类似的操作。</span><span class="sxs-lookup"><span data-stu-id="476de-116">Custom implementations should do something similar.</span></span>  
  
## <a name="refreshinterval-and-cleanupinterval"></a><span data-ttu-id="476de-117">RefreshInterval 和 CleanupInterval</span><span class="sxs-lookup"><span data-stu-id="476de-117">RefreshInterval and CleanupInterval</span></span>  

 <span data-ttu-id="476de-118">`RefreshInterval` 的<xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> 属性定义了注册记录在服务的注册查找表中保持有效的持续时间。</span><span class="sxs-lookup"><span data-stu-id="476de-118">The `RefreshInterval` property of the <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> defines how long registration records remain valid in the service's registration lookup table.</span></span> <span data-ttu-id="476de-119">对于给定的记录，在为此属性提供的时间到期后，该记录将过时，并标记为待删除。</span><span class="sxs-lookup"><span data-stu-id="476de-119">When the amount of time supplied to this property has passed for a given record, that record becomes stale and is marked for deletion.</span></span>  
  
 <span data-ttu-id="476de-120">`CleanupInterval` 的 <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> 属性通知服务搜索和删除过时注册记录的频率。</span><span class="sxs-lookup"><span data-stu-id="476de-120">The `CleanupInterval` property of the <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> tells the service how often to search for and delete stale registration records.</span></span> <span data-ttu-id="476de-121">`CleanupInterval` 应设置为大于或等于对服务设置的 `RefreshInterval` 时间。</span><span class="sxs-lookup"><span data-stu-id="476de-121">The `CleanupInterval` should be set to a time greater than or equal to the `RefreshInterval` set on the service.</span></span>  
  
 <span data-ttu-id="476de-122">若要实现您自己的解析程序服务，需编写一个维护函数来删除过时的注册记录。</span><span class="sxs-lookup"><span data-stu-id="476de-122">To implement your own resolver service, you need to write a maintenance function to remove stale registration records.</span></span> <span data-ttu-id="476de-123">有若干方法可实现此操作：</span><span class="sxs-lookup"><span data-stu-id="476de-123">There are several ways to do this:</span></span>  
  
- <span data-ttu-id="476de-124">**定期维护**：将计时器设置为定期关闭，并浏览数据存储以删除旧记录。</span><span class="sxs-lookup"><span data-stu-id="476de-124">**Periodic maintenance**: Set a timer to go off periodically, and go through your data store to delete old records.</span></span> <span data-ttu-id="476de-125"><xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> 使用此方法。</span><span class="sxs-lookup"><span data-stu-id="476de-125">The <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> uses this approach.</span></span>  
  
- <span data-ttu-id="476de-126">**被动删除**：当服务已在执行其他功能时，可以确定并删除过时记录，而不是定期定期搜索过时记录。</span><span class="sxs-lookup"><span data-stu-id="476de-126">**Passive deletion**: Instead of actively searching for stale records at regular intervals, you can identify and delete stale records when your service is already performing another function.</span></span> <span data-ttu-id="476de-127">这可能会延长对解析程序客户端请求的响应时间，但此方法不需要计时器。此外，如果预期很少有节点会不调用 `Unregister` 便离开，此方法将更有效。</span><span class="sxs-lookup"><span data-stu-id="476de-127">This may potentially slow down response time to requests from the resolver clients, but it eliminates the need for a timer, and may be more efficient if few nodes are expected to leave without calling `Unregister`.</span></span>  
  
## <a name="registrationlifetime-and-refresh"></a><span data-ttu-id="476de-128">RegistrationLifetime 和 Refresh</span><span class="sxs-lookup"><span data-stu-id="476de-128">RegistrationLifetime and Refresh</span></span>  

 <span data-ttu-id="476de-129">节点向解析程序服务注册时，它将从该服务收到一个 <xref:System.ServiceModel.PeerResolvers.RegisterResponseInfo> 对象。</span><span class="sxs-lookup"><span data-stu-id="476de-129">When a node registers with a resolver service, it receives a <xref:System.ServiceModel.PeerResolvers.RegisterResponseInfo> object from the service.</span></span> <span data-ttu-id="476de-130">此对象具有 `RegistrationLifetime` 属性，该属性告知节点，注册将在多久之后过期并被解析程序服务删除。</span><span class="sxs-lookup"><span data-stu-id="476de-130">This object has a `RegistrationLifetime` property which indicates to the node how much time it has before the registration expires and is removed by the resolver service.</span></span> <span data-ttu-id="476de-131">例如，如果 `RegistrationLifetime` 为 2 分钟，则节点需要在 2 分钟内调用 `Refresh`，以确保记录保持不过时状态，以免被删除。</span><span class="sxs-lookup"><span data-stu-id="476de-131">If, for example, the `RegistrationLifetime` is 2 minutes, the node needs to call `Refresh` in under 2 minutes to ensure the record stays fresh and is not deleted.</span></span> <span data-ttu-id="476de-132">解析程序服务收到 `Refresh` 请求时，它会查找记录并重置过期时间。</span><span class="sxs-lookup"><span data-stu-id="476de-132">When the resolver service receives a `Refresh` request, it looks up the record and resets the expiration time.</span></span> <span data-ttu-id="476de-133">Refresh 返回一个具有 <xref:System.ServiceModel.PeerResolvers.RefreshResponseInfo> 属性的 `RegistrationLifetime` 对象。</span><span class="sxs-lookup"><span data-stu-id="476de-133">Refresh returns a <xref:System.ServiceModel.PeerResolvers.RefreshResponseInfo> object with a `RegistrationLifetime` property.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="476de-134">请参阅</span><span class="sxs-lookup"><span data-stu-id="476de-134">See also</span></span>

- [<span data-ttu-id="476de-135">对等解析程序</span><span class="sxs-lookup"><span data-stu-id="476de-135">Peer Resolvers</span></span>](peer-resolvers.md)

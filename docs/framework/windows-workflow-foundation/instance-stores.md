---
description: 了解详细信息：实例存储
title: 实例存储区
ms.date: 03/30/2017
ms.assetid: f2629668-0923-4987-b943-67477131c1e0
ms.openlocfilehash: 4d2f7c72d744d2de87a8c2af7b89090b4261de83
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/06/2021
ms.locfileid: "99631172"
---
# <a name="instance-stores"></a><span data-ttu-id="bcb39-103">实例存储区</span><span class="sxs-lookup"><span data-stu-id="bcb39-103">Instance Stores</span></span>

<span data-ttu-id="bcb39-104">实例存储区是实例的逻辑容器。</span><span class="sxs-lookup"><span data-stu-id="bcb39-104">An instance store is a logical container of instances.</span></span> <span data-ttu-id="bcb39-105">它是实例数据和元数据的存储位置。</span><span class="sxs-lookup"><span data-stu-id="bcb39-105">It is the place where the instance data and metadata is stored.</span></span> <span data-ttu-id="bcb39-106">实例存储区不表示专用物理存储区。</span><span class="sxs-lookup"><span data-stu-id="bcb39-106">An instance store does not imply dedicated physical storage.</span></span> <span data-ttu-id="bcb39-107">实例存储区可以包含 SQL Server 数据库中的持久性信息或内存中的非持久状态信息。</span><span class="sxs-lookup"><span data-stu-id="bcb39-107">An instance store could contain durable information in a SQL Server database or non-durable state information in a memory.</span></span> <span data-ttu-id="bcb39-108">[!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)]附带的 SQL 工作流实例存储是实例存储区的具体实现，它允许工作流在 SQL Server 2005 或 SQL Server 2008 数据库中持久保存实例数据和元数据。</span><span class="sxs-lookup"><span data-stu-id="bcb39-108">The [!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)] ships with the SQL Workflow Instance Store, which is a concrete implementation of an instance store that allows workflows to persist instance data and metadata into a SQL Server 2005 or SQL Server 2008 database.</span></span> <span data-ttu-id="bcb39-109">此外，Windows Server App Fabric 还提供了实例存储区的具体实现。</span><span class="sxs-lookup"><span data-stu-id="bcb39-109">In addition Windows Server App Fabric also provides a concrete implementation of an instance store.</span></span> <span data-ttu-id="bcb39-110">有关详细信息，请参阅 [Windows Server App Fabric 实例存储、查询和控制提供程序](/previous-versions/appfabric/ff383417(v=azure.10))。</span><span class="sxs-lookup"><span data-stu-id="bcb39-110">For more information, see [Windows Server App Fabric Instance Store, Query, and Control Providers](/previous-versions/appfabric/ff383417(v=azure.10)).</span></span>  
  
 <span data-ttu-id="bcb39-111">持久性 API 是宿主与实例存储区之间的接口，允许宿主向实例存储区发送命令请求（例如，<xref:System.Activities.DurableInstancing.LoadWorkflowCommand> 和 <xref:System.Activities.DurableInstancing.SaveWorkflowCommand>）。</span><span class="sxs-lookup"><span data-stu-id="bcb39-111">The persistence API is the interface between a host and an instance store that allows the host to send command requests (for example, <xref:System.Activities.DurableInstancing.LoadWorkflowCommand> and <xref:System.Activities.DurableInstancing.SaveWorkflowCommand>) to the instance store.</span></span> <span data-ttu-id="bcb39-112">该 API 的具体实施被称为持久性提供程序。</span><span class="sxs-lookup"><span data-stu-id="bcb39-112">The concrete implementation of this API is called a persistence provider.</span></span> <span data-ttu-id="bcb39-113">持久性提供程序收到宿主的请求，并修改实例存储区。</span><span class="sxs-lookup"><span data-stu-id="bcb39-113">The persistence provider receives requests from a host and modifies the instance store.</span></span>  
  
 <span data-ttu-id="bcb39-114">宿主与实例存储区是可插入的，这样一个宿主可用于多个实例存储区，一个实例存储区也可用于多个宿主。</span><span class="sxs-lookup"><span data-stu-id="bcb39-114">Hosts and instance stores are pluggable so that a host can be used with many instance stores, and an instance store can be used with many hosts.</span></span> <span data-ttu-id="bcb39-115">虽然实例存储区和宿主可在独立的生命周期中演变，但通常会针对特定宿主的使用模式来优化实例存储区。</span><span class="sxs-lookup"><span data-stu-id="bcb39-115">An instance store is typically optimized for the usage patterns of a particular host, although the instance store and host may evolve on independent life cycles.</span></span> <span data-ttu-id="bcb39-116">例如， **WorkflowServiceHost** 和 **SqlWorkflowInstanceStore** 旨在一起工作。</span><span class="sxs-lookup"><span data-stu-id="bcb39-116">For example, the **WorkflowServiceHost** and the **SqlWorkflowInstanceStore** are designed to work well together.</span></span> <span data-ttu-id="bcb39-117">您可以创建自己的实例存储区来保存工作流服务实例的数据和元数据，并将该实例存储用于 **WorkflowServiceHost**。</span><span class="sxs-lookup"><span data-stu-id="bcb39-117">You can create your own instance store to persist data and metadata of workflow service instances and use that instance store with the **WorkflowServiceHost**.</span></span> <span data-ttu-id="bcb39-118">例如，可创建 OracleWorkflowInstanceStore，以使工作流能够将信息持久保存到 Oracle 数据库中，而不是将它们保存到 SQL Server 数据库中。</span><span class="sxs-lookup"><span data-stu-id="bcb39-118">For example, you can create an OracleWorkflowInstanceStore that lets workflows persist information into an Oracle database instead of saving them into a SQL Server database.</span></span>  
  
 <span data-ttu-id="bcb39-119">通常会为宿主扩展附加功能，从而修改持久保存的对象。</span><span class="sxs-lookup"><span data-stu-id="bcb39-119">It is common for hosts to be extended with additional functionality that modifies the persisted objects.</span></span> <span data-ttu-id="bcb39-120">例如，实例持久性系统可能具有工作流宿主、支持 "挂起" 操作的扩展以及一个 SQL 实例存储区。</span><span class="sxs-lookup"><span data-stu-id="bcb39-120">For example, an instance persistence system may have a workflow host, an extension that supports the "Suspend" operation, and an SQL instance store.</span></span>  <span data-ttu-id="bcb39-121">工作流宿主可能发送标准命令，如“保存”或“加载”，以便保存实例存储区中的工作流或从实例存储区加载工作流，或将工作流保存到实例存储区中。</span><span class="sxs-lookup"><span data-stu-id="bcb39-121">The workflow host might send a standard command such as Save or Load to save or load a workflow from an instance store or to save a workflow into an instance store.</span></span> <span data-ttu-id="bcb39-122">挂起扩展可能将附加语义添加到命令中来保存和加载工作流实例，使挂起的工作流实例无法加载。</span><span class="sxs-lookup"><span data-stu-id="bcb39-122">The suspend extension might add additional semantics to the commands for saving and loading workflow instances so that a suspended workflow instance cannot be loaded.</span></span> <span data-ttu-id="bcb39-123">SQL 实例存储区的持久性提供程序了解保存和加载工作流实例的命令，并通过调用可更改 SQL Server 数据库中的持久性对象表的适当存储过程来执行命令。</span><span class="sxs-lookup"><span data-stu-id="bcb39-123">The persistence provider for the SQL instance store understands the commands for saving and loading workflow instances, and implements the commands by calling appropriate stored procedures that change the tables of persistent objects in an SQL Server database.</span></span>  
  
 <span data-ttu-id="bcb39-124">在实例存储区中，宿主充当实例所有者。</span><span class="sxs-lookup"><span data-stu-id="bcb39-124">A host acts as an instance owner within an instance store.</span></span> <span data-ttu-id="bcb39-125">宿主可以同时充当多个实例所有者，拥有多个实例存储区。</span><span class="sxs-lookup"><span data-stu-id="bcb39-125">A host may act as more than one instance owner with more than one instance store at the same time.</span></span> <span data-ttu-id="bcb39-126">宿主为与实例相关的实例键提供 GUID。</span><span class="sxs-lookup"><span data-stu-id="bcb39-126">The host provides GUIDs for instance keys associated with the instances.</span></span> <span data-ttu-id="bcb39-127">实例键是识别实例的唯一别名。</span><span class="sxs-lookup"><span data-stu-id="bcb39-127">An instance key is a unique alias that identifies an instance.</span></span> <span data-ttu-id="bcb39-128">持久性系统在执行宿主请求的命令时将创建、更新和删除实例所有者信息。</span><span class="sxs-lookup"><span data-stu-id="bcb39-128">The persistence system creates, updates, and deletes instance owner information as it executes commands requested by hosts.</span></span>  
  
 <span data-ttu-id="bcb39-129">以下列表包含了涉及宿主与实例存储区交互的重要步骤：</span><span class="sxs-lookup"><span data-stu-id="bcb39-129">The following list contains the important steps involved in the host’s interaction with the instance store:</span></span>  
  
1. <span data-ttu-id="bcb39-130">从永久性提供程序获取 **InstanceStore** 。</span><span class="sxs-lookup"><span data-stu-id="bcb39-130">Obtain an **InstanceStore** from a persistence provider.</span></span>  

2. <span data-ttu-id="bcb39-131">通过对 InstanceStore 调用方法来获取实例的句柄 <xref:System.Runtime.DurableInstancing.InstanceStore.CreateInstanceHandle%2A> 。 </span><span class="sxs-lookup"><span data-stu-id="bcb39-131">Obtain the handle to an instance by calling the <xref:System.Runtime.DurableInstancing.InstanceStore.CreateInstanceHandle%2A> method on the **InstanceStore**.</span></span>  
  
3. <span data-ttu-id="bcb39-132">通过对 InstanceStore 调用方法来调用针对实例句柄的命令 <xref:System.Runtime.DurableInstancing.InstanceStore.Execute%2A> 。 </span><span class="sxs-lookup"><span data-stu-id="bcb39-132">Invoke commands against the instance handle by calling the <xref:System.Runtime.DurableInstancing.InstanceStore.Execute%2A> method on the **InstanceStore**.</span></span>  
  
4. <span data-ttu-id="bcb39-133">检查 <xref:System.Runtime.DurableInstancing.InstanceView> **InstanceStore.Exe** 的返回结果，以确定命令的结果。</span><span class="sxs-lookup"><span data-stu-id="bcb39-133">Examine the <xref:System.Runtime.DurableInstancing.InstanceView> returned by **InstanceStore.Execute** to determine the results of the commands.</span></span>

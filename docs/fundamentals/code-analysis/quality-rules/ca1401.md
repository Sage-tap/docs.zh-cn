---
title: CA1401：P-Invokes 应为不可见（代码分析）
description: 了解代码分析规则 CA1401：P-Invokes 应为不可见
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- PInvokesShouldNotBeVisible
- CA1401
helpviewer_keywords:
- CA1401
- PInvokesShouldNotBeVisible
author: gewarren
ms.author: gewarren
dev_langs:
- CSharp
- VB
ms.openlocfilehash: f90ca8df32004376873207ee5203f5cb8e0276b2
ms.sourcegitcommit: 05d0087dfca85aac9ca2960f86c5efd218bf833f
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/30/2021
ms.locfileid: "99777393"
---
# <a name="ca1401-pinvokes-should-not-be-visible"></a><span data-ttu-id="232b7-103">CA1401：P/Invokes 应该是不可见的</span><span class="sxs-lookup"><span data-stu-id="232b7-103">CA1401: P/Invokes should not be visible</span></span>

|                                     | <span data-ttu-id="232b7-104">值</span><span class="sxs-lookup"><span data-stu-id="232b7-104">Value</span></span>                      |
|-------------------------------------|----------------------------|
| <span data-ttu-id="232b7-105">**规则 ID**</span><span class="sxs-lookup"><span data-stu-id="232b7-105">**Rule ID**</span></span>                          | <span data-ttu-id="232b7-106">CA1401</span><span class="sxs-lookup"><span data-stu-id="232b7-106">CA1401</span></span>                     |
| <span data-ttu-id="232b7-107">**类别**</span><span class="sxs-lookup"><span data-stu-id="232b7-107">**Category**</span></span>                        | [<span data-ttu-id="232b7-108">互操作性</span><span class="sxs-lookup"><span data-stu-id="232b7-108">Interoperability</span></span>](interoperability-warnings.md) |
| <span data-ttu-id="232b7-109">**修复是中断修复还是非中断修复**</span><span class="sxs-lookup"><span data-stu-id="232b7-109">**Fix is breaking or non-breaking**</span></span> | <span data-ttu-id="232b7-110">重大</span><span class="sxs-lookup"><span data-stu-id="232b7-110">Breaking</span></span>                   |

## <a name="cause"></a><span data-ttu-id="232b7-111">原因</span><span class="sxs-lookup"><span data-stu-id="232b7-111">Cause</span></span>

<span data-ttu-id="232b7-112">公共类型中的公共或受保护方法具有 <xref:System.Runtime.InteropServices.DllImportAttribute?displayProperty=fullName> 特性（在 Visual Basic 中也由 `Declare` 关键字实现）。</span><span class="sxs-lookup"><span data-stu-id="232b7-112">A public or protected method in a public type has the <xref:System.Runtime.InteropServices.DllImportAttribute?displayProperty=fullName> attribute (also implemented by the `Declare` keyword in Visual Basic).</span></span>

## <a name="rule-description"></a><span data-ttu-id="232b7-113">规则说明</span><span class="sxs-lookup"><span data-stu-id="232b7-113">Rule description</span></span>

<span data-ttu-id="232b7-114">标记有 <xref:System.Runtime.InteropServices.DllImportAttribute> 特性的方法（或在 Visual Basic 中使用 `Declare` 关键字定义的方法）使用平台调用服务来访问非托管代码。</span><span class="sxs-lookup"><span data-stu-id="232b7-114">Methods that are marked with the <xref:System.Runtime.InteropServices.DllImportAttribute> attribute (or methods that are defined by using the `Declare` keyword in Visual Basic) use Platform Invocation Services to access unmanaged code.</span></span> <span data-ttu-id="232b7-115">这些方法不能公开。</span><span class="sxs-lookup"><span data-stu-id="232b7-115">Such methods should not be exposed.</span></span> <span data-ttu-id="232b7-116">通过使这些方法保持专用或内部，可以阻止调用方访问他们不能调用的非托管 API，从而确保库不会破坏安全性。</span><span class="sxs-lookup"><span data-stu-id="232b7-116">By keeping these methods private or internal, you make sure that your library cannot be used to breach security by allowing callers access to unmanaged APIs that they could not call otherwise.</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="232b7-117">如何解决冲突</span><span class="sxs-lookup"><span data-stu-id="232b7-117">How to fix violations</span></span>

<span data-ttu-id="232b7-118">若要解决此规则的冲突，请更改该方法的访问级别。</span><span class="sxs-lookup"><span data-stu-id="232b7-118">To fix a violation of this rule, change the access level of the method.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="232b7-119">何时禁止显示警告</span><span class="sxs-lookup"><span data-stu-id="232b7-119">When to suppress warnings</span></span>

<span data-ttu-id="232b7-120">不禁止显示此规则发出的警告。</span><span class="sxs-lookup"><span data-stu-id="232b7-120">Do not suppress a warning from this rule.</span></span>

## <a name="example"></a><span data-ttu-id="232b7-121">示例</span><span class="sxs-lookup"><span data-stu-id="232b7-121">Example</span></span>

<span data-ttu-id="232b7-122">下面的示例声明了违反此规则的方法。</span><span class="sxs-lookup"><span data-stu-id="232b7-122">The following example declares a method that violates this rule.</span></span>

:::code language="csharp" source="snippets/csharp/all-rules/ca1401.cs" id="snippet1":::

:::code language="vb" source="snippets/vb/all-rules/ca1401-p-invokes-should-not-be-visible_1.vb":::

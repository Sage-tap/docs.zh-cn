---
description: 了解详细信息：保护 WCF Data Services
title: WCF 数据服务的安全
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- securing application [WCF Data Services]
- WCF Data Services, security
ms.assetid: 99fc2baa-a040-4549-bc4d-f683d60298af
ms.openlocfilehash: c7f8cb989c33df3d124a1745046ea68cb27e8c2f
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/06/2021
ms.locfileid: "99773103"
---
# <a name="securing-wcf-data-services"></a><span data-ttu-id="9191c-103">WCF 数据服务的安全</span><span class="sxs-lookup"><span data-stu-id="9191c-103">Securing WCF Data Services</span></span>

[!INCLUDE [wcf-deprecated](~/includes/wcf-deprecated.md)]

<span data-ttu-id="9191c-104">本文介绍了特定于开发、部署和运行 WCF Data Services 和应用程序的安全注意事项，这些注意事项 (OData) 访问支持 Open Data Protocol 的服务。</span><span class="sxs-lookup"><span data-stu-id="9191c-104">This article describes security considerations that are specific to developing, deploying, and running WCF Data Services and applications that access services that support the Open Data Protocol (OData).</span></span> <span data-ttu-id="9191c-105">还应遵循创建安全 .NET Framework 应用程序的建议。</span><span class="sxs-lookup"><span data-stu-id="9191c-105">You should also follow recommendations for creating secure .NET Framework applications.</span></span>  
  
<span data-ttu-id="9191c-106">规划如何保护基于 WCF Data Services 的 OData 服务时，您必须同时处理身份验证、发现和验证主体身份的过程，以及确定是否允许经过身份验证的主体访问请求的资源的过程。</span><span class="sxs-lookup"><span data-stu-id="9191c-106">When planning how to secure a WCF Data Services-based OData service, you must address both authentication, the process of discovering and verifying the identity of a principal, and authorization, the process of determining whether an authenticated principal is allowed to access the requested resources.</span></span> <span data-ttu-id="9191c-107">还要考虑是否使用 SSL 来加密消息。</span><span class="sxs-lookup"><span data-stu-id="9191c-107">Also consider whether to encrypt the message by using SSL.</span></span>  
  
## <a name="authenticating-client-requests"></a><span data-ttu-id="9191c-108">对客户端请求进行身份验证</span><span class="sxs-lookup"><span data-stu-id="9191c-108">Authenticating Client Requests</span></span>  

<span data-ttu-id="9191c-109">WCF Data Services 不会自行实现任何类型的身份验证，而是依赖数据服务主机的身份验证设置。</span><span class="sxs-lookup"><span data-stu-id="9191c-109">WCF Data Services does not implement any kind of authentication of its own, but rather relies on the authentication provisions of the data service host.</span></span> <span data-ttu-id="9191c-110">这意味着，该服务假定其收到的任何请求已经由网络主机进行身份验证，并且该主机已通过 WCF Data Services 提供的接口正确地识别了请求的原则。</span><span class="sxs-lookup"><span data-stu-id="9191c-110">This means that the service assumes that any request that it receives has already been authenticated by the network host and that the host has correctly identified the principle for the request appropriately via the interfaces provided by WCF Data Services.</span></span> <span data-ttu-id="9191c-111">多部分 [OData 和身份验证系列](https://devblogs.microsoft.com/odata/?s=%22OData+and+authentication%22)详细介绍了这些身份验证选项和方法。</span><span class="sxs-lookup"><span data-stu-id="9191c-111">These authentication options and approaches are detailed in the multipart [OData and Authentication series](https://devblogs.microsoft.com/odata/?s=%22OData+and+authentication%22).</span></span>  
  
### <a name="authentication-options-for-a-wcf-data-service"></a><span data-ttu-id="9191c-112">WCF 数据服务的身份验证选项</span><span class="sxs-lookup"><span data-stu-id="9191c-112">Authentication Options for a WCF Data Service</span></span>  

 <span data-ttu-id="9191c-113">下表列出了一些可用来对发向 WCF 数据服务的请求进行身份验证的身份验证机制。</span><span class="sxs-lookup"><span data-stu-id="9191c-113">The following table lists some of the authentication mechanisms that are available to help you authenticate requests to a WCF Data Service.</span></span>  
  
|<span data-ttu-id="9191c-114">身份验证选项</span><span class="sxs-lookup"><span data-stu-id="9191c-114">Authentication Options</span></span>|<span data-ttu-id="9191c-115">说明</span><span class="sxs-lookup"><span data-stu-id="9191c-115">Description</span></span>|  
|----------------------------|-----------------|  
|<span data-ttu-id="9191c-116">匿名身份验证</span><span class="sxs-lookup"><span data-stu-id="9191c-116">Anonymous authentication</span></span>|<span data-ttu-id="9191c-117">启用 HTTP 匿名身份验证时，任何主体都能连接到数据服务。</span><span class="sxs-lookup"><span data-stu-id="9191c-117">When HTTP anonymous authentication is enabled, any principle is able to connect to the data service.</span></span> <span data-ttu-id="9191c-118">匿名访问无需凭据。</span><span class="sxs-lookup"><span data-stu-id="9191c-118">Credentials are not required for anonymous access.</span></span> <span data-ttu-id="9191c-119">仅当希望允许任何人访问数据服务时，才使用此选项。</span><span class="sxs-lookup"><span data-stu-id="9191c-119">Use this option only when you want to allow anyone to access the data service.</span></span>|  
|<span data-ttu-id="9191c-120">基本和摘要式身份验证</span><span class="sxs-lookup"><span data-stu-id="9191c-120">Basic and digest authentication</span></span>|<span data-ttu-id="9191c-121">需要由用户名和密码组成的凭据以进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="9191c-121">Credentials consisting of a user name and password are required for authentication.</span></span> <span data-ttu-id="9191c-122">支持非 Windows 客户端的身份验证。</span><span class="sxs-lookup"><span data-stu-id="9191c-122">Supports authentication of non-Windows clients.</span></span> <span data-ttu-id="9191c-123">**安全说明：**  基本身份验证凭据 (用户名和密码) 以明文形式发送，并可被截取。</span><span class="sxs-lookup"><span data-stu-id="9191c-123">**Security Note:**  Basic authentication credentials (user name and password) are sent in the clear and can be intercepted.</span></span> <span data-ttu-id="9191c-124">摘要式身份验证基于所提供的凭据发送一个哈希值，因而比基本身份验证更安全。</span><span class="sxs-lookup"><span data-stu-id="9191c-124">Digest authentication sends a hash based-on the supplied credentials, which makes it more secure than basic authentication.</span></span> <span data-ttu-id="9191c-125">这两者都容易受到中间人攻击。</span><span class="sxs-lookup"><span data-stu-id="9191c-125">Both are susceptible to man-in-the-middle attacks.</span></span> <span data-ttu-id="9191c-126">使用这些身份验证方法时，应考虑使用安全套接字层 (SSL) 加密客户端与数据服务之间的通信。</span><span class="sxs-lookup"><span data-stu-id="9191c-126">When using these authentication methods, you should consider encrypting communication between client and the data service by using the Secure Sockets Layer (SSL).</span></span> <br /><br /> <span data-ttu-id="9191c-127">Microsoft Internet Information Services (IIS) 为 ASP.NET 应用程序中的 HTTP 请求提供基本身份验证和摘要式身份验证的实现。</span><span class="sxs-lookup"><span data-stu-id="9191c-127">Microsoft Internet Information Services (IIS) provides an implementation of both basic and digest authentication for HTTP requests in an ASP.NET application.</span></span> <span data-ttu-id="9191c-128">该 Windows 身份验证提供程序实现允许 .NET Framework 客户端应用程序在发给数据服务的请求的 HTTP 标头中提供凭据，以无缝协商 Windows 用户的身份验证。</span><span class="sxs-lookup"><span data-stu-id="9191c-128">This Windows Authentication Provider implementation enables a .NET Framework client application to supply credentials in the HTTP header of the request to the data service to seamlessly negotiate authentication of a Windows user.</span></span> <span data-ttu-id="9191c-129">有关详细信息，请参阅 [摘要式身份验证技术参考](/previous-versions/windows/it-pro/windows-server-2003/cc782794(v=ws.10))。</span><span class="sxs-lookup"><span data-stu-id="9191c-129">For more information, see [Digest Authentication Technical Reference](/previous-versions/windows/it-pro/windows-server-2003/cc782794(v=ws.10)).</span></span><br /><br /> <span data-ttu-id="9191c-130">如果希望数据服务使用基于某些自定义身份验证服务的基本身份验证而不是 Windows 凭据，则必须实现用于身份验证的自定义 ADP.NET HTTP 模块。</span><span class="sxs-lookup"><span data-stu-id="9191c-130">When you want to have your data service use basic authentication based on some custom authentication service and not Windows credentials, you must implement a custom ADP.NET HTTP Module for authentication.</span></span><br /><br /> <span data-ttu-id="9191c-131">有关如何将自定义基本身份验证方案与 WCF Data Services 结合使用的示例，请参阅博客文章 [OData 和身份验证–第6部分–自定义基本身份验证](https://devblogs.microsoft.com/odata/odata-and-authentication-part-6-custom-basic-authentication/)。</span><span class="sxs-lookup"><span data-stu-id="9191c-131">For an example of how to use a custom basic authentication scheme with WCF Data Services, see the blog post [OData and Authentication – Part 6 – Custom Basic Authentication](https://devblogs.microsoft.com/odata/odata-and-authentication-part-6-custom-basic-authentication/).</span></span>|  
|<span data-ttu-id="9191c-132">Windows 身份验证</span><span class="sxs-lookup"><span data-stu-id="9191c-132">Windows authentication</span></span>|<span data-ttu-id="9191c-133">基于 Windows 的凭据使用 NTLM 或 Kerberos 进行交换。</span><span class="sxs-lookup"><span data-stu-id="9191c-133">Windows-based credentials are exchanged by using NTLM or Kerberos.</span></span> <span data-ttu-id="9191c-134">该机制比基本或摘要式身份验证更安全，但它要求客户端是基于 Windows 的应用程序。</span><span class="sxs-lookup"><span data-stu-id="9191c-134">This mechanism is more secure than basic or digest authentication, but it requires that the client be a Windows-based application.</span></span> <span data-ttu-id="9191c-135">IIS 还为 ASP.NET 应用程序中的 HTTP 请求提供 Windows 身份验证的实现。</span><span class="sxs-lookup"><span data-stu-id="9191c-135">IIS also provides an implementation of Windows authentication for HTTP requests in an ASP.NET application.</span></span> <span data-ttu-id="9191c-136">有关详细信息，请参阅 [ASP.NET Forms Authentication 概述](/previous-versions/aspnet/7t6b43z4(v=vs.100))。</span><span class="sxs-lookup"><span data-stu-id="9191c-136">For more information, see [ASP.NET Forms Authentication Overview](/previous-versions/aspnet/7t6b43z4(v=vs.100)).</span></span><br /><br /> <span data-ttu-id="9191c-137">有关如何在 WCF Data Services 中使用 Windows 身份验证的示例，请参阅博客文章 [OData 和身份验证–第2部分– Windows 身份验证](https://devblogs.microsoft.com/odata/odata-and-authentication-part-2-windows-authentication/)。</span><span class="sxs-lookup"><span data-stu-id="9191c-137">For an example of how to use Windows authentication with WCF Data Services, see the blog post [OData and Authentication – Part 2 – Windows Authentication](https://devblogs.microsoft.com/odata/odata-and-authentication-part-2-windows-authentication/).</span></span>|  
|<span data-ttu-id="9191c-138">ASP.NET forms 身份验证</span><span class="sxs-lookup"><span data-stu-id="9191c-138">ASP.NET forms authentication</span></span>|<span data-ttu-id="9191c-139">Forms 身份验证使你可以使用自己的代码对用户进行身份验证，然后将身份验证标记保留在 Cookie 或页的 URL 中。</span><span class="sxs-lookup"><span data-stu-id="9191c-139">Forms authentication lets you authenticate users by using your own code and then maintain an authentication token in a cookie or in the page URL.</span></span> <span data-ttu-id="9191c-140">您使用自己创建的登录窗体对用户的用户名和密码进行验证。</span><span class="sxs-lookup"><span data-stu-id="9191c-140">You authenticate the user name and password of your users using a login form that you create.</span></span> <span data-ttu-id="9191c-141">未经过身份验证的请求被重定向到登录页，用户在该页上提供凭据和提交窗体。</span><span class="sxs-lookup"><span data-stu-id="9191c-141">Unauthenticated requests are redirected to a login page, where the user provides credentials and submits the form.</span></span> <span data-ttu-id="9191c-142">如果应用程序对请求进行了验证，系统会颁发一个票证，该票证包含用于重建后续请求的标识的密钥。</span><span class="sxs-lookup"><span data-stu-id="9191c-142">If the application authenticates the request, the system issues a ticket that contains a key for reestablishing the identity for subsequent requests.</span></span> <span data-ttu-id="9191c-143">有关详细信息，请参阅 [Forms 身份验证提供程序](/previous-versions/aspnet/9wff0kyh(v=vs.100))。</span><span class="sxs-lookup"><span data-stu-id="9191c-143">For more information, see [Forms Authentication Provider](/previous-versions/aspnet/9wff0kyh(v=vs.100)).</span></span> <span data-ttu-id="9191c-144">**安全说明：**  默认情况下，在 ASP.NET Web 应用程序中使用 forms 身份验证时，包含 forms 身份验证票证的 cookie 不受保护。</span><span class="sxs-lookup"><span data-stu-id="9191c-144">**Security Note:**  By default, the cookie that contains the forms authentication ticket is not secured when you use forms authentication in a ASP.NET Web application.</span></span> <span data-ttu-id="9191c-145">应考虑要求使用 SSL 以保护身份验证票证和初始登录凭据。</span><span class="sxs-lookup"><span data-stu-id="9191c-145">You should consider requiring SSL to protect both the authentication ticket and the initial login credentials.</span></span> <br /><br /> <span data-ttu-id="9191c-146">有关如何在 WCF Data Services 中使用 forms 身份验证的示例，请参阅博客文章 [OData 和身份验证–第7部分– Forms 身份验证](https://devblogs.microsoft.com/odata/odata-and-authentication-part-7-forms-authentication/)。</span><span class="sxs-lookup"><span data-stu-id="9191c-146">For an example of how to use forms authentication with WCF Data Services, see the blog post [OData and Authentication – Part 7 – Forms Authentication](https://devblogs.microsoft.com/odata/odata-and-authentication-part-7-forms-authentication/).</span></span>|  
|<span data-ttu-id="9191c-147">基于声明的身份验证</span><span class="sxs-lookup"><span data-stu-id="9191c-147">Claims-based authentication</span></span>|<span data-ttu-id="9191c-148">在基于声明的身份验证中，数据服务依赖于受信任的 "第三方" 标识提供者服务对用户进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="9191c-148">In claims-based authentication, the data service relies on a trusted "third-party" identity provider service to authenticate the user.</span></span> <span data-ttu-id="9191c-149">该标识提供程序对请求访问数据服务资源的用户进行肯定的身份验证并发出一个标记，授予对所请求资源的访问权限。</span><span class="sxs-lookup"><span data-stu-id="9191c-149">The identity provider positively authenticates the user that is requesting access to data service resources and issues a token that grants access to the requested resources.</span></span> <span data-ttu-id="9191c-150">该标记随后提供给数据服务，后者基于与发出访问权限标记的标识服务的信任关系授予用户访问权限。</span><span class="sxs-lookup"><span data-stu-id="9191c-150">This token is then presented to the data service, which then grants access to the user based on the trust relationship with the identity service that issued the access token.</span></span><br /><br /> <span data-ttu-id="9191c-151">使用基于声明的身份验证提供程序的优点是它们可用于跨越信任域对各种类型的客户端进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="9191c-151">The benefit of using a claims-based authentication provider is that they can be used to authenticate various types of clients across trust domains.</span></span> <span data-ttu-id="9191c-152">通过采用这样一种第三方提供程序，数据服务可以不必维护用户并对其进行身份验证，从而减轻了负担。</span><span class="sxs-lookup"><span data-stu-id="9191c-152">By employing such a third-party provider, a data service can offload the requirements of maintaining and authenticating users.</span></span> <span data-ttu-id="9191c-153">OAuth 2.0 是一种基于声明的身份验证协议，受 Azure AppFabric 访问控制，支持联合身份验证作为服务。</span><span class="sxs-lookup"><span data-stu-id="9191c-153">OAuth 2.0 is a claims-based authentication protocol that is supported by Azure AppFabric Access Control for federated authorization as a service.</span></span> <span data-ttu-id="9191c-154">此协议支持基于 REST 的服务。</span><span class="sxs-lookup"><span data-stu-id="9191c-154">This protocol supports REST-based services.</span></span> <span data-ttu-id="9191c-155">有关如何将 OAuth 2.0 与 WCF Data Services 结合使用的示例，请参阅博客文章 [OData 和身份验证–第8部分– OAUTH 包装](https://devblogs.microsoft.com/odata/odata-and-authentication-part-8-oauth-wrap/)。</span><span class="sxs-lookup"><span data-stu-id="9191c-155">For an example of how to use OAuth 2.0 with WCF Data Services, see the blog post [OData and Authentication – Part 8 – OAuth WRAP](https://devblogs.microsoft.com/odata/odata-and-authentication-part-8-oauth-wrap/).</span></span>|  
  
<a name="clientAuthentication"></a>

### <a name="authentication-in-the-client-library"></a><span data-ttu-id="9191c-156">客户端库中的身份验证</span><span class="sxs-lookup"><span data-stu-id="9191c-156">Authentication in the Client Library</span></span>  

 <span data-ttu-id="9191c-157">默认情况下，WCF Data Services 客户端库在向 OData 服务发出请求时不提供凭据。</span><span class="sxs-lookup"><span data-stu-id="9191c-157">By default, the WCF Data Services client library does not supply credentials when making a request to an OData service.</span></span> <span data-ttu-id="9191c-158">如果数据服务需要登录凭据以进行用户身份验证，可以在 <xref:System.Net.NetworkCredential>（可通过 <xref:System.Data.Services.Client.DataServiceContext.Credentials%2A> 的 <xref:System.Data.Services.Client.DataServiceContext> 属性访问）中提供凭据，如下例所示：</span><span class="sxs-lookup"><span data-stu-id="9191c-158">When login credentials are required by the data service to authenticate a user, these credentials can be supplied in a <xref:System.Net.NetworkCredential> accessed from the <xref:System.Data.Services.Client.DataServiceContext.Credentials%2A> property of the <xref:System.Data.Services.Client.DataServiceContext>, as in the following example:</span></span>  
  
```csharp  
// Set the client authentication credentials.  
context.Credentials =  
    new NetworkCredential(userName, password, domain);  
```  
  
```vb  
' Set the client authentication credentials.  
context.Credentials = _  
    New NetworkCredential(userName, password, domain)  
```  
  
 <span data-ttu-id="9191c-159">有关详细信息，请参阅 [如何：为数据服务请求指定客户端凭据](specify-client-creds-for-a-data-service-request-wcf.md)。</span><span class="sxs-lookup"><span data-stu-id="9191c-159">For more information, see [How to: Specify Client Credentials for a Data Service Request](specify-client-creds-for-a-data-service-request-wcf.md).</span></span>  
  
 <span data-ttu-id="9191c-160">如果数据服务需要的登录凭据不能通过使用 <xref:System.Net.NetworkCredential> 对象（如基于声明的标记或 Cookie）指定，则必须在 HTTP 请求中手动设置标头，通常是 `Authorization` 和 `Cookie` 标头。</span><span class="sxs-lookup"><span data-stu-id="9191c-160">When the data service requires login credentials that cannot be specified by using a <xref:System.Net.NetworkCredential> object, such as a claims-based token or cookie, you must manually set headers in the HTTP request, usually the `Authorization` and `Cookie` headers.</span></span> <span data-ttu-id="9191c-161">有关此类身份验证方案的详细信息，请参阅博客文章 [ OData 和身份验证–第3部分–客户端挂钩](https://devblogs.microsoft.com/odata/odata-and-authentication-part-3-clientside-hooks/)。</span><span class="sxs-lookup"><span data-stu-id="9191c-161">For more information about this kind of authentication scenario, see the blog post [ OData and Authentication – Part 3 – ClientSide Hooks](https://devblogs.microsoft.com/odata/odata-and-authentication-part-3-clientside-hooks/).</span></span> <span data-ttu-id="9191c-162">有关如何在请求消息中设置 HTTP 标头的示例，请参阅 [如何：在客户端请求中设置标头](how-to-set-headers-in-the-client-request-wcf-data-services.md)。</span><span class="sxs-lookup"><span data-stu-id="9191c-162">For an example of how to set HTTP headers in a request message, see [How to: Set Headers in the Client Request](how-to-set-headers-in-the-client-request-wcf-data-services.md).</span></span>  
  
## <a name="impersonation"></a><span data-ttu-id="9191c-163">模拟</span><span class="sxs-lookup"><span data-stu-id="9191c-163">Impersonation</span></span>  

 <span data-ttu-id="9191c-164">通常，数据服务使用承载数据服务的工作进程的凭据访问所需资源，如服务器上的文件或数据库。</span><span class="sxs-lookup"><span data-stu-id="9191c-164">Generally, the data service accesses required resources, such as files on the server or a database, by using the credentials of the worker process that is hosting the data service.</span></span> <span data-ttu-id="9191c-165">使用模拟时，ASP.NET 应用程序可使用 Windows 标识 (用户帐户) 发出请求的用户。</span><span class="sxs-lookup"><span data-stu-id="9191c-165">When using impersonation, ASP.NET applications can execute with the Windows identity (user account) of the user making the request.</span></span> <span data-ttu-id="9191c-166">模拟通常用在依赖 IIS 进行用户身份验证的应用程序中，并使用该主体的凭据访问所需资源。</span><span class="sxs-lookup"><span data-stu-id="9191c-166">Impersonation is commonly used in applications that rely on IIS to authenticate the user, and the credentials of this principle are used to access the required resources.</span></span> <span data-ttu-id="9191c-167">有关详细信息，请参阅 [ASP.NET 模拟](/previous-versions/aspnet/xh507fc5(v=vs.100))。</span><span class="sxs-lookup"><span data-stu-id="9191c-167">For more information, see [ASP.NET Impersonation](/previous-versions/aspnet/xh507fc5(v=vs.100)).</span></span>  
  
## <a name="configuring-data-service-authorization"></a><span data-ttu-id="9191c-168">配置数据服务授权</span><span class="sxs-lookup"><span data-stu-id="9191c-168">Configuring Data Service Authorization</span></span>  

 <span data-ttu-id="9191c-169">授权是基于之前的成功身份验证为所识别的主体或进程授予应用程序资源的访问权限。</span><span class="sxs-lookup"><span data-stu-id="9191c-169">Authorization is the granting of access to application resources to a principle or process that is identified based on a previously successful authentication.</span></span> <span data-ttu-id="9191c-170">作为一种通行做法，只应当为数据服务的用户授予刚好足够的权限以执行客户端应用程序所需的操作。</span><span class="sxs-lookup"><span data-stu-id="9191c-170">As a general practice, you should only grant sufficient rights to users of the data service to perform the operations required by client applications.</span></span>  
  
### <a name="restrict-access-to-data-service-resources"></a><span data-ttu-id="9191c-171">限制对数据服务资源的访问</span><span class="sxs-lookup"><span data-stu-id="9191c-171">Restrict Access to Data Service Resources</span></span>  

 <span data-ttu-id="9191c-172">默认情况下，WCF Data Services 使你能够向能够访问数据服务的任何用户授予对数据服务资源 (实体集和服务) 操作的通用读写访问权限。</span><span class="sxs-lookup"><span data-stu-id="9191c-172">By default, WCF Data Services enables you to grant common read and write access against data service resources (entity set and service operations) to any user that is able to access the data service.</span></span> <span data-ttu-id="9191c-173">可以为数据服务公开的每个实体集分别定义用于定义读取和写入访问权限的规则。</span><span class="sxs-lookup"><span data-stu-id="9191c-173">Rules that define read and write access can be defined separately for each entity set exposed by the data service, as well as to any service operations.</span></span> <span data-ttu-id="9191c-174">我们建议将读取和写入访问权限仅限于客户端应用程序所需的资源。</span><span class="sxs-lookup"><span data-stu-id="9191c-174">We recommend limiting both read and write access to only the resources required by the client application.</span></span> <span data-ttu-id="9191c-175">有关详细信息，请参阅 [最低资源访问要求](configuring-the-data-service-wcf-data-services.md#accessRequirements)。</span><span class="sxs-lookup"><span data-stu-id="9191c-175">For more information, see [Minimum Resource Access Requirements](configuring-the-data-service-wcf-data-services.md#accessRequirements).</span></span>  
  
### <a name="implement-role-based-interceptors"></a><span data-ttu-id="9191c-176">实现基于角色的侦听器</span><span class="sxs-lookup"><span data-stu-id="9191c-176">Implement Role-Based Interceptors</span></span>  

 <span data-ttu-id="9191c-177">侦听器可用于在数据服务对数据服务资源采取操作之前截取对它们的请求。</span><span class="sxs-lookup"><span data-stu-id="9191c-177">Interceptors enable you to intercept requests against data service resources before they are acted on by the data service.</span></span> <span data-ttu-id="9191c-178">有关详细信息，请参阅 [拦截](interceptors-wcf-data-services.md)程序。</span><span class="sxs-lookup"><span data-stu-id="9191c-178">For more information, see [Interceptors](interceptors-wcf-data-services.md).</span></span> <span data-ttu-id="9191c-179">拦截器可让您基于发出请求的已进行身份验证的用户作出授权决策。</span><span class="sxs-lookup"><span data-stu-id="9191c-179">Interceptors enable you to make authorization decisions based the authenticated user that is making the request.</span></span> <span data-ttu-id="9191c-180">有关如何根据经过身份验证的用户标识限制对数据服务资源的访问的示例，请参阅 [如何：截获数据服务消息](how-to-intercept-data-service-messages-wcf-data-services.md)。</span><span class="sxs-lookup"><span data-stu-id="9191c-180">For an example of how to restrict access to data service resources based on an authenticated user identity, see [How to: Intercept Data Service Messages](how-to-intercept-data-service-messages-wcf-data-services.md).</span></span>  
  
### <a name="restrict-access-to-the-persisted-data-store-and-local-resources"></a><span data-ttu-id="9191c-181">限制对持久数据存储区和本地资源的访问</span><span class="sxs-lookup"><span data-stu-id="9191c-181">Restrict Access to the Persisted Data Store and Local Resources</span></span>  

 <span data-ttu-id="9191c-182">用于访问持久存储区的帐户应仅授予刚好足够的数据库或文件系统权限以支持数据服务的要求。</span><span class="sxs-lookup"><span data-stu-id="9191c-182">The accounts that are used to access the persisted store should be granted only enough rights in a database or the file system to support the requirements of the data service.</span></span> <span data-ttu-id="9191c-183">在使用匿名身份验证时，这是用于运行宿主应用程序的帐户。</span><span class="sxs-lookup"><span data-stu-id="9191c-183">When anonymous authentication is used, this is the account used to run the hosting application.</span></span> <span data-ttu-id="9191c-184">有关详细信息，请参阅 [How to: Develop a WCF Data Service Running on IIS](how-to-develop-a-wcf-data-service-running-on-iis.md)。</span><span class="sxs-lookup"><span data-stu-id="9191c-184">For more information, see [How to: Develop a WCF Data Service Running on IIS](how-to-develop-a-wcf-data-service-running-on-iis.md).</span></span> <span data-ttu-id="9191c-185">使用模拟时，必须为经过身份验证的用户授予这些资源的访问权限，通常是作为 Windows 组的一部分。</span><span class="sxs-lookup"><span data-stu-id="9191c-185">When impersonation is used, authenticated users must be granted access to these resources, usually as part of a Windows group.</span></span>  
  
## <a name="other-security-considerations"></a><span data-ttu-id="9191c-186">其他安全注意事项</span><span class="sxs-lookup"><span data-stu-id="9191c-186">Other Security Considerations</span></span>  
  
### <a name="secure-the-data-in-the-payload"></a><span data-ttu-id="9191c-187">负载中的数据安全</span><span class="sxs-lookup"><span data-stu-id="9191c-187">Secure the Data in the Payload</span></span>  

<span data-ttu-id="9191c-188">OData 以 HTTP 协议为基础。</span><span class="sxs-lookup"><span data-stu-id="9191c-188">OData is based on the HTTP protocol.</span></span> <span data-ttu-id="9191c-189">在 HTTP 消息中，标头可能包含重要的用户凭据，具体取决于数据服务实现的身份验证。</span><span class="sxs-lookup"><span data-stu-id="9191c-189">In an HTTP message, the header may contain valuable user credentials, depending on the authentication implemented by the data service.</span></span> <span data-ttu-id="9191c-190">消息正文还可能包含必须予以保护的重要客户数据。</span><span class="sxs-lookup"><span data-stu-id="9191c-190">The message body may also contain valuable customer data that must be protected.</span></span> <span data-ttu-id="9191c-191">在这两种情况下，我们建议使用 SSL 在网络上保护此信息。</span><span class="sxs-lookup"><span data-stu-id="9191c-191">In both of these cases, we recommend that you use SSL to protect this information over the wire.</span></span>  
  
### <a name="ignored-message-headers-and-cookies"></a><span data-ttu-id="9191c-192">忽略的消息标头和 Cookie</span><span class="sxs-lookup"><span data-stu-id="9191c-192">Ignored Message Headers and Cookies</span></span>  

 <span data-ttu-id="9191c-193">除了声明内容类型和资源位置以外的 HTTP 请求标头将被忽略，数据服务永远不会设置它们。</span><span class="sxs-lookup"><span data-stu-id="9191c-193">HTTP request headers, other than those that declare content types and resource locations, are ignored and are never set by the data service.</span></span>  
  
 <span data-ttu-id="9191c-194">Cookie 可用作身份验证方案的一部分，如使用 ASP.NET Forms 身份验证。</span><span class="sxs-lookup"><span data-stu-id="9191c-194">Cookies can be used as part of an authentication scheme, such as with ASP.NET Forms Authentication.</span></span> <span data-ttu-id="9191c-195">不过，WCF DataServices 将忽略为传入请求设置的任何 HTTP cookie。</span><span class="sxs-lookup"><span data-stu-id="9191c-195">However, any HTTP cookies set on an incoming request are ignored by WCF DataServices.</span></span> <span data-ttu-id="9191c-196">数据服务的主机可能处理 cookie，但 WCF Data Services 运行时从不分析或返回 cookie。</span><span class="sxs-lookup"><span data-stu-id="9191c-196">The host of a data service may process the cookie, but the WCF Data Services runtime never analyzes or returns cookies.</span></span> <span data-ttu-id="9191c-197">WCF Data Services 客户端库也不会处理在响应中发送的 cookie。</span><span class="sxs-lookup"><span data-stu-id="9191c-197">The WCF Data Services client library also does not process cookies sent in the response.</span></span>  
  
### <a name="custom-hosting-requirements"></a><span data-ttu-id="9191c-198">自定义承载需求</span><span class="sxs-lookup"><span data-stu-id="9191c-198">Custom Hosting Requirements</span></span>  

 <span data-ttu-id="9191c-199">默认情况下，WCF Data Services 创建为在 IIS 中托管的 ASP.NET 应用程序。</span><span class="sxs-lookup"><span data-stu-id="9191c-199">By default, WCF Data Services is created as an ASP.NET application hosted in IIS.</span></span> <span data-ttu-id="9191c-200">这样数据服务便可以利用该平台的安全行为。</span><span class="sxs-lookup"><span data-stu-id="9191c-200">This enables the data service to leverage the secure behaviors of this platform.</span></span> <span data-ttu-id="9191c-201">您可以定义由自定义宿主承载的 WCF Data Services。</span><span class="sxs-lookup"><span data-stu-id="9191c-201">You can define WCF Data Services that are hosted by a custom host.</span></span> <span data-ttu-id="9191c-202">有关详细信息，请参阅 [承载数据服务](hosting-the-data-service-wcf-data-services.md)。</span><span class="sxs-lookup"><span data-stu-id="9191c-202">For more information, see [Hosting the Data Service](hosting-the-data-service-wcf-data-services.md).</span></span> <span data-ttu-id="9191c-203">承载数据服务的组件和平台还必须确保以下安全行为以防范对数据服务的攻击：</span><span class="sxs-lookup"><span data-stu-id="9191c-203">The components and platform hosting a data service must ensure the following security behaviors to prevent attacks on the data service:</span></span>  
  
- <span data-ttu-id="9191c-204">限制针对所有可能操作的数据服务请求中接受的 URI 的长度。</span><span class="sxs-lookup"><span data-stu-id="9191c-204">Limit the length of the URI accepted in a data service request for all possible operations.</span></span>  
  
- <span data-ttu-id="9191c-205">限制传入和传出 HTTP 消息的大小。</span><span class="sxs-lookup"><span data-stu-id="9191c-205">Limit the size of both incoming and outgoing HTTP messages.</span></span>  
  
- <span data-ttu-id="9191c-206">限制任何给定时间点的未完成请求的总数。</span><span class="sxs-lookup"><span data-stu-id="9191c-206">Limit the total number of outstanding requests at any given time.</span></span>  
  
- <span data-ttu-id="9191c-207">限制 HTTP 标头及其值的大小，并提供对标头数据 WCF Data Services 访问。</span><span class="sxs-lookup"><span data-stu-id="9191c-207">Limit the size of HTTP headers and their values, and provide WCF Data Services access to header data.</span></span>  
  
- <span data-ttu-id="9191c-208">检测和计数已知攻击，如 TCP SYN 和消息重播攻击。</span><span class="sxs-lookup"><span data-stu-id="9191c-208">Detect and counter known attacks, such as TCP SYN and message replay attacks.</span></span>  
  
### <a name="values-are-not-further-encoded"></a><span data-ttu-id="9191c-209">值不进一步编码</span><span class="sxs-lookup"><span data-stu-id="9191c-209">Values Are Not Further Encoded</span></span>  

 <span data-ttu-id="9191c-210">发送到数据服务的属性值不会通过 WCF Data Services 运行时进一步编码。</span><span class="sxs-lookup"><span data-stu-id="9191c-210">Property values sent to the data service are not further encoded by the WCF Data Services runtime.</span></span> <span data-ttu-id="9191c-211">例如，当某个实体的字符串属性包含带格式的 HTML 内容时，数据服务不对标记进行 HTML 编码。</span><span class="sxs-lookup"><span data-stu-id="9191c-211">For example, when a string property of an entity contains formatted HTML content, the tags are not HTML encoded by the data service.</span></span> <span data-ttu-id="9191c-212">数据服务也不会在响应中对属性值进行进一步编码。</span><span class="sxs-lookup"><span data-stu-id="9191c-212">The data service also does not further encode property values in the response.</span></span> <span data-ttu-id="9191c-213">客户端库也不会执行任何其他编码。</span><span class="sxs-lookup"><span data-stu-id="9191c-213">The client library also does not perform any additional encoding.</span></span>  
  
### <a name="considerations-for-client-applications"></a><span data-ttu-id="9191c-214">客户端应用程序的注意事项</span><span class="sxs-lookup"><span data-stu-id="9191c-214">Considerations for Client Applications</span></span>  

 <span data-ttu-id="9191c-215">以下安全注意事项适用于使用 WCF Data Services 客户端访问 OData 服务的应用程序：</span><span class="sxs-lookup"><span data-stu-id="9191c-215">The following security considerations apply to applications that use the WCF Data Services client to access OData services:</span></span>  
  
- <span data-ttu-id="9191c-216">客户端库假定用于访问数据服务的协议提供了适当安全级别。</span><span class="sxs-lookup"><span data-stu-id="9191c-216">The client library assumes that the protocols used to access the data service provide an appropriate level of security.</span></span>  
  
- <span data-ttu-id="9191c-217">客户端库使用基础平台提供的传输堆栈的超时和分析选项的全部默认值。</span><span class="sxs-lookup"><span data-stu-id="9191c-217">The client library uses all the default values for timeouts and parsing options of the underlying platform-provided transport stacks.</span></span>  
  
- <span data-ttu-id="9191c-218">客户端库不从应用程序配置文件中读取任何设置。</span><span class="sxs-lookup"><span data-stu-id="9191c-218">The client library does not read any settings from application configuration files.</span></span>  
  
- <span data-ttu-id="9191c-219">客户端库不实现任何跨域访问机制，</span><span class="sxs-lookup"><span data-stu-id="9191c-219">The client library does not implement any cross domain access mechanisms.</span></span> <span data-ttu-id="9191c-220">而是依赖于基础 HTTP 堆栈提供的机制。</span><span class="sxs-lookup"><span data-stu-id="9191c-220">Instead, it relies on the mechanisms provided by the underlying HTTP stack.</span></span>  
  
- <span data-ttu-id="9191c-221">客户端库没有用户界面元素，并且它从不尝试显示或呈现它所接收或发送的数据。</span><span class="sxs-lookup"><span data-stu-id="9191c-221">The client library has no user interface elements, and it never tries to display or render the data that it receives or sends.</span></span>  
  
- <span data-ttu-id="9191c-222">我们建议客户端应用程序始终对用户输入以及接受自非信任服务的数据进行验证。</span><span class="sxs-lookup"><span data-stu-id="9191c-222">We recommend that client applications always validate user input as well as data accepted from untrusted services.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="9191c-223">请参阅</span><span class="sxs-lookup"><span data-stu-id="9191c-223">See also</span></span>

- [<span data-ttu-id="9191c-224">定义 WCF 数据服务</span><span class="sxs-lookup"><span data-stu-id="9191c-224">Defining WCF Data Services</span></span>](defining-wcf-data-services.md)
- [<span data-ttu-id="9191c-225">WCF 数据服务客户端库</span><span class="sxs-lookup"><span data-stu-id="9191c-225">WCF Data Services Client Library</span></span>](wcf-data-services-client-library.md)

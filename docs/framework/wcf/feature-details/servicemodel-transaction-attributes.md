---
description: 了解有关
title: ServiceModel 事务属性
ms.date: 03/30/2017
helpviewer_keywords:
- transactions [WCF], ServiceModel attributes
ms.assetid: 1e0d2436-6ae5-439b-9765-a448d6f60000
ms.openlocfilehash: 0b443fc6b9503007574608afe03c5e0508f666d9
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/06/2021
ms.locfileid: "99793475"
---
# <a name="servicemodel-transaction-attributes"></a><span data-ttu-id="da6a2-103">ServiceModel 事务属性</span><span class="sxs-lookup"><span data-stu-id="da6a2-103">ServiceModel Transaction Attributes</span></span>

<span data-ttu-id="da6a2-104">Windows Communication Foundation (WCF) 提供了三个标准 <xref:System.ServiceModel> 特性的属性，这些属性使你能够为 WCF 服务配置事务行为：</span><span class="sxs-lookup"><span data-stu-id="da6a2-104">Windows Communication Foundation (WCF) provides properties on three standard <xref:System.ServiceModel> attributes that enable you to configure the behavior of transactions for a WCF service:</span></span>

- <xref:System.ServiceModel.TransactionFlowAttribute>

- <xref:System.ServiceModel.ServiceBehaviorAttribute>

- <xref:System.ServiceModel.OperationBehaviorAttribute>

## <a name="transactionflowattribute"></a><span data-ttu-id="da6a2-105">TransactionFlowAttribute</span><span class="sxs-lookup"><span data-stu-id="da6a2-105">TransactionFlowAttribute</span></span>

<span data-ttu-id="da6a2-106"><xref:System.ServiceModel.TransactionFlowAttribute> 属性指定服务协定中的操作是否愿意接受来自客户端的传入事务。</span><span class="sxs-lookup"><span data-stu-id="da6a2-106">The <xref:System.ServiceModel.TransactionFlowAttribute> attribute specifies the willingness of an operation in a service contract to accept incoming transactions from a client.</span></span> <span data-ttu-id="da6a2-107">此属性 (attribute) 通过以下属性 (property) 提供此控制：事务使用 <xref:System.ServiceModel.TransactionFlowOption> 枚举指定传入事务是 <xref:System.ServiceModel.TransactionFlowOption.Mandatory>、<xref:System.ServiceModel.TransactionFlowOption.Allowed> 还是 <xref:System.ServiceModel.TransactionFlowOption.NotAllowed>。</span><span class="sxs-lookup"><span data-stu-id="da6a2-107">The attribute provides this control with the following property: Transactions use the <xref:System.ServiceModel.TransactionFlowOption> enumeration to specify whether an incoming transaction is <xref:System.ServiceModel.TransactionFlowOption.Mandatory>, <xref:System.ServiceModel.TransactionFlowOption.Allowed>, or <xref:System.ServiceModel.TransactionFlowOption.NotAllowed>.</span></span>

<span data-ttu-id="da6a2-108">此属性是将服务操作和与客户端的外部交互操作相关联的唯一属性。</span><span class="sxs-lookup"><span data-stu-id="da6a2-108">This is the only attribute that relates service operations to external interactions with a client.</span></span> <span data-ttu-id="da6a2-109">下面几节中说明的属性与在操作的执行中使用的事务有关。</span><span class="sxs-lookup"><span data-stu-id="da6a2-109">The attributes described in the following sections relate to the use of transactions within the execution of the operation.</span></span>

## <a name="servicebehaviorattribute"></a><span data-ttu-id="da6a2-110">ServiceBehaviorAttribute</span><span class="sxs-lookup"><span data-stu-id="da6a2-110">ServiceBehaviorAttribute</span></span>

<span data-ttu-id="da6a2-111"><xref:System.ServiceModel.ServiceBehaviorAttribute> 属性指定服务协定实现的内部执行行为。</span><span class="sxs-lookup"><span data-stu-id="da6a2-111">The <xref:System.ServiceModel.ServiceBehaviorAttribute> attribute specifies the internal execution behavior of a service contract implementation.</span></span> <span data-ttu-id="da6a2-112">此属性 (Attribute) 的特定于事务的属性 (Property) 包括：</span><span class="sxs-lookup"><span data-stu-id="da6a2-112">Transaction-specific properties of this attribute include:</span></span>

- <span data-ttu-id="da6a2-113"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionAutoCompleteOnSessionClose%2A>，此属性指定会话关闭时是否完成未完成的事务。</span><span class="sxs-lookup"><span data-stu-id="da6a2-113"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionAutoCompleteOnSessionClose%2A> specifies whether to complete an uncompleted transaction when the session closes.</span></span> <span data-ttu-id="da6a2-114">此属性的默认值为 `false`。</span><span class="sxs-lookup"><span data-stu-id="da6a2-114">The default value for this property is `false`.</span></span> <span data-ttu-id="da6a2-115">如果此属性为 `true` 且传入会话正常关闭而不是由于网络或客户端故障而关闭，则会成功完成任何未完成的事务。</span><span class="sxs-lookup"><span data-stu-id="da6a2-115">If this property is `true`, and the incoming session was gracefully shut down instead of closing due to network or client faults, any uncompleted transaction is successfully completed.</span></span> <span data-ttu-id="da6a2-116">否则，如果此属性为 `false` 或者如果会话未正常关闭，则会话关闭时任何未完成的事务将会回滚。</span><span class="sxs-lookup"><span data-stu-id="da6a2-116">Otherwise, if this property is `false` or if the session was not gracefully closed, any uncompleted transaction is rolled back when the session closes.</span></span> <span data-ttu-id="da6a2-117">如果此属性为 `true`，则传入通道必须基于会话。</span><span class="sxs-lookup"><span data-stu-id="da6a2-117">If this property is `true`, the incoming channel must be session-based.</span></span>

- <span data-ttu-id="da6a2-118"><xref:System.ServiceModel.ServiceBehaviorAttribute.ReleaseServiceInstanceOnTransactionComplete%2A>，此属性指定事务完成时是否释放基础服务实例。</span><span class="sxs-lookup"><span data-stu-id="da6a2-118"><xref:System.ServiceModel.ServiceBehaviorAttribute.ReleaseServiceInstanceOnTransactionComplete%2A> specifies whether the underlying service instance is released when a transaction completes.</span></span> <span data-ttu-id="da6a2-119">此属性的默认值为 `true`。</span><span class="sxs-lookup"><span data-stu-id="da6a2-119">The default value for this property is `true`.</span></span> <span data-ttu-id="da6a2-120">下一个入站消息会导致创建新的基础实例，放弃上一个实例可能保持的每个事务的任何状态。</span><span class="sxs-lookup"><span data-stu-id="da6a2-120">The next inbound message causes a new underlying instance to be created, discarding any per-transaction state that the previous instance might have held.</span></span> <span data-ttu-id="da6a2-121">释放服务实例是服务执行的内部操作，对客户端可能已经建立的任何现有连接或会话没有影响。</span><span class="sxs-lookup"><span data-stu-id="da6a2-121">Releasing a service instance is an internal action the service takes and has no impact on any existing connections or sessions that clients might have established.</span></span> <span data-ttu-id="da6a2-122">此功能等效于 COM+ 提供的实时激活功能。</span><span class="sxs-lookup"><span data-stu-id="da6a2-122">This functionality is equivalent to the just-in-time activation feature COM+ provides.</span></span> <span data-ttu-id="da6a2-123">如果此属性为 `true`，则 <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A> 必须等于 <xref:System.ServiceModel.ConcurrencyMode.Single>。</span><span class="sxs-lookup"><span data-stu-id="da6a2-123">If the property is `true`, <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A> must be equal to <xref:System.ServiceModel.ConcurrencyMode.Single>.</span></span> <span data-ttu-id="da6a2-124">否则，服务在启动过程中会引发无效配置验证异常。</span><span class="sxs-lookup"><span data-stu-id="da6a2-124">Otherwise, the service throws an invalid configuration validation exception during startup.</span></span>

- <span data-ttu-id="da6a2-125"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionIsolationLevel%2A>，此属性指定用于服务内事务的隔离级别；此属性采用 <xref:System.Transactions.IsolationLevel> 值之一。</span><span class="sxs-lookup"><span data-stu-id="da6a2-125"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionIsolationLevel%2A> specifies the isolation level to use for transactions within the service; this property takes one of the <xref:System.Transactions.IsolationLevel> values.</span></span> <span data-ttu-id="da6a2-126">如果本地隔离级别属性是 <xref:System.Transactions.IsolationLevel.Unspecified> 以外的任何值，则传入事务的隔离级别必须与此本地属性的设置相匹配。</span><span class="sxs-lookup"><span data-stu-id="da6a2-126">If the local isolation level property is anything other than <xref:System.Transactions.IsolationLevel.Unspecified>, the isolation level of an incoming transaction must match the setting of this local property.</span></span> <span data-ttu-id="da6a2-127">否则会拒绝传入事务并将故障发回客户端。</span><span class="sxs-lookup"><span data-stu-id="da6a2-127">Otherwise, the incoming transaction is rejected, and a fault is sent back to the client.</span></span> <span data-ttu-id="da6a2-128">如果 <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> 为 `true`，且没有对事务进行流处理，则此属性确定要用于本地创建的事务的 <xref:System.Transactions.IsolationLevel> 值。</span><span class="sxs-lookup"><span data-stu-id="da6a2-128">If <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> is `true`, and no transaction is flowed, this property determines the <xref:System.Transactions.IsolationLevel> value to use for the locally created transaction.</span></span> <span data-ttu-id="da6a2-129">如果 <xref:System.Transactions.IsolationLevel> 设置为 <xref:System.Transactions.IsolationLevel.Unspecified>，则使用 <xref:System.Transactions.IsolationLevel><xref:System.Transactions.IsolationLevel.Serializable>。</span><span class="sxs-lookup"><span data-stu-id="da6a2-129">If <xref:System.Transactions.IsolationLevel> is set to <xref:System.Transactions.IsolationLevel.Unspecified>, <xref:System.Transactions.IsolationLevel><xref:System.Transactions.IsolationLevel.Serializable> is used.</span></span>

- <span data-ttu-id="da6a2-130"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionTimeout%2A>，此属性指定一个时间段，在服务中创建的新事务必须在此时间段内完成。</span><span class="sxs-lookup"><span data-stu-id="da6a2-130"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionTimeout%2A> specifies the time period within which a new transaction created at the service must complete.</span></span> <span data-ttu-id="da6a2-131">如果达到此时间时事务没有完成，则会中止事务。</span><span class="sxs-lookup"><span data-stu-id="da6a2-131">If this time is reached and the transaction has not been completed, it will abort.</span></span> <span data-ttu-id="da6a2-132">对于已将 <xref:System.TimeSpan> 设置为 <xref:System.Transactions.TransactionScope> 的任何操作以及为其创建了新事务的任何操作，<xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> 用作 `true` 超时。</span><span class="sxs-lookup"><span data-stu-id="da6a2-132">The <xref:System.TimeSpan> is used as the <xref:System.Transactions.TransactionScope> time-out for any operations that have <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> set to `true` and for which a new transaction was created.</span></span> <span data-ttu-id="da6a2-133">该超时是从创建事务到完成两阶段提交协议的第 1 阶段所允许的最长时间。</span><span class="sxs-lookup"><span data-stu-id="da6a2-133">The time-out is the maximum allowed duration from the creation of the transaction to the completion of phase 1 in the two-phase commit protocol.</span></span> <span data-ttu-id="da6a2-134">使用的超时值始终是 <xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionTimeout%2A> 属性和 `transactionTimeout` 配置设置之间的较小值。</span><span class="sxs-lookup"><span data-stu-id="da6a2-134">The time-out value used is always the lower value between the <xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionTimeout%2A> property and the `transactionTimeout` configuration setting.</span></span>

## <a name="operationbehaviorattribute"></a><span data-ttu-id="da6a2-135">OperationBehaviorAttribute</span><span class="sxs-lookup"><span data-stu-id="da6a2-135">OperationBehaviorAttribute</span></span>

<span data-ttu-id="da6a2-136"><xref:System.ServiceModel.OperationBehaviorAttribute> 属性指定服务实现中方法的行为。</span><span class="sxs-lookup"><span data-stu-id="da6a2-136">The <xref:System.ServiceModel.OperationBehaviorAttribute> attribute specifies the behaviors of the methods in the service implementation.</span></span> <span data-ttu-id="da6a2-137">可以用此属性指示操作的特定执行行为。</span><span class="sxs-lookup"><span data-stu-id="da6a2-137">You can use it to indicate the operation's specific execution behavior.</span></span> <span data-ttu-id="da6a2-138">此属性的属性不影响服务协定 (WSDL) 说明的 Web 服务描述语言，而是 WCF 编程模型的纯粹元素，这些元素允许开发人员自行实现的通用功能。</span><span class="sxs-lookup"><span data-stu-id="da6a2-138">Properties of this attribute do not affect the Web Service Description Language (WSDL) description of the service contract, and are purely elements of the WCF programming model that enable common features that developers otherwise have to implement themselves.</span></span>

<span data-ttu-id="da6a2-139">此属性 (Attribute) 具有以下特定于事务的属性 (Property)：</span><span class="sxs-lookup"><span data-stu-id="da6a2-139">This attribute has the following transaction-specific properties:</span></span>

- <span data-ttu-id="da6a2-140"><xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> 指定是否必须在活动事务范围内执行方法。</span><span class="sxs-lookup"><span data-stu-id="da6a2-140"><xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> specifies whether a method must execute within an active transaction scope.</span></span> <span data-ttu-id="da6a2-141">默认值为 `false`。</span><span class="sxs-lookup"><span data-stu-id="da6a2-141">The default is `false`.</span></span> <span data-ttu-id="da6a2-142">如果没有为方法设置 <xref:System.ServiceModel.OperationBehaviorAttribute> 属性，这也暗示着不会在事务中执行该方法。</span><span class="sxs-lookup"><span data-stu-id="da6a2-142">If the <xref:System.ServiceModel.OperationBehaviorAttribute> attribute is not set for a method, it also implies that the method will not execute in a transaction.</span></span> <span data-ttu-id="da6a2-143">如果操作不需要事务范围，则不会激活消息头中存在的任何事务，并且这些事务将保持作为 <xref:System.ServiceModel.OperationContext.IncomingMessageProperties%2A> 的 <xref:System.ServiceModel.OperationContext> 的元素。</span><span class="sxs-lookup"><span data-stu-id="da6a2-143">If a transaction scope is not required for an operation, any transaction that is present within the message header is not activated and remains as an element of the <xref:System.ServiceModel.OperationContext.IncomingMessageProperties%2A> of the <xref:System.ServiceModel.OperationContext>.</span></span> <span data-ttu-id="da6a2-144">如果操作需要事务范围，则从下列各项之一中派生该事务的源：</span><span class="sxs-lookup"><span data-stu-id="da6a2-144">If a transaction scope is required for an operation, the source for the transaction is derived from one of the following:</span></span>

  - <span data-ttu-id="da6a2-145">如果从客户端流动事务，则在使用该分布式事务创建的事务范围内执行此方法。</span><span class="sxs-lookup"><span data-stu-id="da6a2-145">If a transaction is flowed from the client, the method is executed under a transaction scope created using that distributed transaction.</span></span>

  - <span data-ttu-id="da6a2-146">使用排队传输时，使用用于对消息取消排队的事务。</span><span class="sxs-lookup"><span data-stu-id="da6a2-146">With a queued transport, the transaction used to dequeue the message is used.</span></span> <span data-ttu-id="da6a2-147">请注意，使用的事务不是流事务，因为它不是由消息的原始发送方提供。</span><span class="sxs-lookup"><span data-stu-id="da6a2-147">Note that the transaction used is not a flowed transaction, in that it was not provided by the original sender of the message.</span></span>

  - <span data-ttu-id="da6a2-148">自定义传输可以通过使用 `TransportTransactionProperty` 提供事务。</span><span class="sxs-lookup"><span data-stu-id="da6a2-148">A custom transport can provide a transaction through the use of the `TransportTransactionProperty`.</span></span>

  - <span data-ttu-id="da6a2-149">如果上面的任一属性均没有为事务提供外部源，则会在调用方法之前创建一个新的 <xref:System.Transactions.Transaction> 实例。</span><span class="sxs-lookup"><span data-stu-id="da6a2-149">If none of the above provides an external source for a transaction, a new <xref:System.Transactions.Transaction> instance is created immediately prior to calling the method.</span></span>

- <span data-ttu-id="da6a2-150"><xref:System.ServiceModel.OperationBehaviorAttribute.TransactionAutoComplete%2A> 指定在没有引发未处理的异常的情况下，在其中执行方法的事务是否自动完成。</span><span class="sxs-lookup"><span data-stu-id="da6a2-150"><xref:System.ServiceModel.OperationBehaviorAttribute.TransactionAutoComplete%2A> specifies whether the transaction in which the method executes is automatically completed if no unhandled exceptions are thrown.</span></span> <span data-ttu-id="da6a2-151">如果此属性为 `true`，则当用户方法在未引发异常的情况下返回时，调用基础结构会自动将事务标记为“已完成”。</span><span class="sxs-lookup"><span data-stu-id="da6a2-151">If this property is `true`, the calling infrastructure automatically marks the transaction as "completed" if the user method returns without throwing an exception.</span></span> <span data-ttu-id="da6a2-152">如果此属性为 `false`，则事务会附加到实例，并且仅当客户端调用标记为此属性等于 `true` 的后续方法时，或仅当后续方法显式调 <xref:System.ServiceModel.OperationContext.SetTransactionComplete%2A> 时，事务才会标记为“已完成”。</span><span class="sxs-lookup"><span data-stu-id="da6a2-152">If this property is `false`, the transaction is attached to the instance, and is only marked as "completed" if the client calls a subsequent method that is marked with this property equal to `true`, or if a subsequent method explicitly calls <xref:System.ServiceModel.OperationContext.SetTransactionComplete%2A>.</span></span> <span data-ttu-id="da6a2-153">不执行这两种方案之一会导致事务永远也不会处于“已完成”状态，其中所包含的工作也不会提交，除非将 <xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionAutoCompleteOnSessionClose%2A> 属性设置为 `true`。</span><span class="sxs-lookup"><span data-stu-id="da6a2-153">Failure to perform either of these results in the transaction never being "completed," and the contained work is not committed, unless the <xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionAutoCompleteOnSessionClose%2A> property is set to `true`.</span></span> <span data-ttu-id="da6a2-154">如果此属性设置为 `true`，则必须与会话一起使用通道，且必须将 <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A> 设置为 <xref:System.ServiceModel.InstanceContextMode.PerSession>。</span><span class="sxs-lookup"><span data-stu-id="da6a2-154">If this property is set to `true`, you must use a channel with a session, and the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A> must be set to <xref:System.ServiceModel.InstanceContextMode.PerSession>.</span></span>

---
title: Blazor 应用托管模型
description: 了解在 Blazor 或服务器上的浏览中托管 WebAssembly 应用的不同方法。
author: danroth27
ms.author: daroth
no-loc:
- Blazor
- WebAssembly
ms.date: 11/20/2020
ms.openlocfilehash: 18258c54cffdc538ddd11ec1393639216f86f85a
ms.sourcegitcommit: 05d0087dfca85aac9ca2960f86c5efd218bf833f
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/30/2021
ms.locfileid: "102255452"
---
# <a name="blazor-app-hosting-models"></a><span data-ttu-id="cc501-103">Blazor 应用托管模型</span><span class="sxs-lookup"><span data-stu-id="cc501-103">Blazor app hosting models</span></span>

<span data-ttu-id="cc501-104">Blazor 应用可以通过以下方式托管：</span><span class="sxs-lookup"><span data-stu-id="cc501-104">Blazor apps can be hosted in one of the following ways:</span></span>

- <span data-ttu-id="cc501-105">WebAssembly 上浏览器中的客户端。</span><span class="sxs-lookup"><span data-stu-id="cc501-105">Client-side in the browser on WebAssembly.</span></span>
- <span data-ttu-id="cc501-106">ASP.NET Core 应用中的服务器端。</span><span class="sxs-lookup"><span data-stu-id="cc501-106">Server-side in an ASP.NET Core app.</span></span>

## <a name="blazor-webassembly-apps"></a><span data-ttu-id="cc501-107">Blazor WebAssembly 应用</span><span class="sxs-lookup"><span data-stu-id="cc501-107">Blazor WebAssembly apps</span></span>

<span data-ttu-id="cc501-108">Blazor WebAssembly 应用使用基于 WebAssembly 的 .NET 运行时在浏览器中直接执行。</span><span class="sxs-lookup"><span data-stu-id="cc501-108">Blazor WebAssembly apps execute directly in the browser on a WebAssembly-based .NET runtime.</span></span> <span data-ttu-id="cc501-109">Blazor WebAssembly 应用的工作方式类似于 Angular 和 React 等前端 JavaScript 框架。</span><span class="sxs-lookup"><span data-stu-id="cc501-109">Blazor WebAssembly apps function in a similar way to front-end JavaScript frameworks like Angular or React.</span></span> <span data-ttu-id="cc501-110">但不是编写 JavaScript，而是编写 C#。</span><span class="sxs-lookup"><span data-stu-id="cc501-110">However, instead of writing JavaScript you write C#.</span></span> <span data-ttu-id="cc501-111">.NET 运行时与应用、应用程序集和任何必需的依赖项一起下载。</span><span class="sxs-lookup"><span data-stu-id="cc501-111">The .NET runtime is downloaded with the app along with the app assembly and any required dependencies.</span></span> <span data-ttu-id="cc501-112">无需浏览器插件和扩展。</span><span class="sxs-lookup"><span data-stu-id="cc501-112">No browser plugins or extensions are required.</span></span>

<span data-ttu-id="cc501-113">下载的程序集是普通的 .NET 程序集，就像在任何其他 .NET 应用中使用的程序集一样。</span><span class="sxs-lookup"><span data-stu-id="cc501-113">The downloaded assemblies are normal .NET assemblies, like you would use in any other .NET app.</span></span> <span data-ttu-id="cc501-114">运行时支持 .NET Standard，因此可将现有的 .NET Standard 用于 Blazor WebAssembly 应用。</span><span class="sxs-lookup"><span data-stu-id="cc501-114">Because the runtime supports .NET Standard, you can use existing .NET Standard libraries with your Blazor WebAssembly app.</span></span> <span data-ttu-id="cc501-115">但这些程序集仍在浏览器安全沙盒中执行。</span><span class="sxs-lookup"><span data-stu-id="cc501-115">However, these assemblies will still execute in the browser security sandbox.</span></span> <span data-ttu-id="cc501-116">某些功能可能会引发 <xref:System.PlatformNotSupportedException>，如尝试访问文件系统或打开任意网络连接。</span><span class="sxs-lookup"><span data-stu-id="cc501-116">Some functionality may throw a <xref:System.PlatformNotSupportedException>, like trying to access the file system or opening arbitrary network connections.</span></span>

<span data-ttu-id="cc501-117">应用加载时，.NET 运行时会启动并指向应用程序集。</span><span class="sxs-lookup"><span data-stu-id="cc501-117">When the app loads, the .NET runtime is started and pointed at the app assembly.</span></span> <span data-ttu-id="cc501-118">应用启动逻辑会运行，并且根组件会呈现。</span><span class="sxs-lookup"><span data-stu-id="cc501-118">The app startup logic runs, and the root components are rendered.</span></span> <span data-ttu-id="cc501-119">Blazor 根据组件呈现的输出计算 UI 更新。</span><span class="sxs-lookup"><span data-stu-id="cc501-119">Blazor calculates the UI updates based on the rendered output from the components.</span></span> <span data-ttu-id="cc501-120">然后应用 DOM 更新。</span><span class="sxs-lookup"><span data-stu-id="cc501-120">The DOM updates are then applied.</span></span>

![Blazor WebAssembly](media/hosting-models/blazor-webassembly.png)

<span data-ttu-id="cc501-122">Blazor WebAssembly 应用完全在客户端运行。</span><span class="sxs-lookup"><span data-stu-id="cc501-122">Blazor WebAssembly apps run purely client-side.</span></span> <span data-ttu-id="cc501-123">此类应用可以部署到 GitHub 网页或 Azure 静态网站托管等静态网站托管解决方案。</span><span class="sxs-lookup"><span data-stu-id="cc501-123">Such apps can be deployed to static site hosting solutions like GitHub Pages or Azure Static Website Hosting.</span></span> <span data-ttu-id="cc501-124">在服务器上根本不需要 .NET。</span><span class="sxs-lookup"><span data-stu-id="cc501-124">.NET isn't required on the server at all.</span></span> <span data-ttu-id="cc501-125">到应用的某些部分的深层链接通常需要服务器上的路由解决方案。</span><span class="sxs-lookup"><span data-stu-id="cc501-125">Deep linking to parts of the app typically requires a routing solution on the server.</span></span> <span data-ttu-id="cc501-126">路由解决方案会将请求重定向到应用的根。</span><span class="sxs-lookup"><span data-stu-id="cc501-126">The routing solution redirects requests to the root of the app.</span></span> <span data-ttu-id="cc501-127">例如，可以通过使用 URL 重写 IIS 中的规则来处理此重定向。</span><span class="sxs-lookup"><span data-stu-id="cc501-127">For example, this redirection can be handled using URL rewrite rules in IIS.</span></span>

<span data-ttu-id="cc501-128">要利用 Blazor 和全栈 .NET Web 开发的所有优势，请使用 ASP.NET Core 托管 Blazor WebAssembly 应用。</span><span class="sxs-lookup"><span data-stu-id="cc501-128">To get all the benefits of Blazor and full-stack .NET web development, host your Blazor WebAssembly app with ASP.NET Core.</span></span> <span data-ttu-id="cc501-129">通过使用客户端和服务器上的 .NET，你可以轻松共享代码，并使用一组一致的语言、框架和工具生成应用。</span><span class="sxs-lookup"><span data-stu-id="cc501-129">By using .NET on both the client and server, you can easily share code and build your app using one consistent set of languages, frameworks, and tools.</span></span> <span data-ttu-id="cc501-130">Blazor 提供便捷的模板，可用于设置包含 Blazor WebAssembly 应用和 ASP.NET Core 托管项目的解决方案。</span><span class="sxs-lookup"><span data-stu-id="cc501-130">Blazor provides convenient templates for setting up a solution that contains both a Blazor WebAssembly app and an ASP.NET Core host project.</span></span> <span data-ttu-id="cc501-131">生成解决方案后，Blazor 应用中已生成的静态文件由已设置回退路由的 ASP.NET Core 应用托管。</span><span class="sxs-lookup"><span data-stu-id="cc501-131">When the solution is built, the built static files from the Blazor app are hosted by the ASP.NET Core app with fallback routing already setup.</span></span>

## <a name="blazor-server-apps"></a><span data-ttu-id="cc501-132">Blazor Server 应用</span><span class="sxs-lookup"><span data-stu-id="cc501-132">Blazor Server apps</span></span>

<span data-ttu-id="cc501-133">回想一下对 [Blazor 体系结构](architecture-comparison.md#blazor)的讨论，Blazor 组件会将其输出呈现为名为 `RenderTree` 的中间抽象。</span><span class="sxs-lookup"><span data-stu-id="cc501-133">Recall from the [Blazor architecture](architecture-comparison.md#blazor) discussion that Blazor components render their output to an intermediate abstraction called a `RenderTree`.</span></span> <span data-ttu-id="cc501-134">Blazor 框架然后将呈现的内容与之前呈现的内容相比较。</span><span class="sxs-lookup"><span data-stu-id="cc501-134">The Blazor framework then compares what was rendered with what was previously rendered.</span></span> <span data-ttu-id="cc501-135">这些差异会应用到 DOM。</span><span class="sxs-lookup"><span data-stu-id="cc501-135">The differences are applied to the DOM.</span></span> <span data-ttu-id="cc501-136">Blazor 组件根据呈现的输出的应用方式进行去耦。</span><span class="sxs-lookup"><span data-stu-id="cc501-136">Blazor components are decoupled from how their rendered output is applied.</span></span> <span data-ttu-id="cc501-137">因此组件本身运行的进程无需与更新 UI 的进程相同。</span><span class="sxs-lookup"><span data-stu-id="cc501-137">Consequently, the components themselves don't have to run in the same process as the process updating the UI.</span></span> <span data-ttu-id="cc501-138">实际上，它们甚至不必在同一计算机上运行。</span><span class="sxs-lookup"><span data-stu-id="cc501-138">In fact, they don't even have to run on the same machine.</span></span>

<span data-ttu-id="cc501-139">在 Blazor Server 应用中，组件在服务器上运行，而不是在浏览器中的客户端运行。</span><span class="sxs-lookup"><span data-stu-id="cc501-139">In Blazor Server apps, the components run on the server instead of client-side in the browser.</span></span> <span data-ttu-id="cc501-140">浏览器中发生的 UI 事件通过实时连接发送到服务器。</span><span class="sxs-lookup"><span data-stu-id="cc501-140">UI events that occur in the browser are sent to the server over a real-time connection.</span></span> <span data-ttu-id="cc501-141">事件被分派到正确的组件实例。</span><span class="sxs-lookup"><span data-stu-id="cc501-141">The events are dispatched to the correct component instances.</span></span> <span data-ttu-id="cc501-142">组件将呈现，计算的 UI 差异被序列化后发送到浏览器并在其中应用于 DOM。</span><span class="sxs-lookup"><span data-stu-id="cc501-142">The components render, and the calculated UI diff is serialized and sent to the browser where it's applied to the DOM.</span></span>

![Blazor Server](media/hosting-models/blazor-server.png)

<span data-ttu-id="cc501-144">如果你使用过 ASP.NET AJAX 和 Blazor 控件，可能不会对 <xref:System.Web.UI.UpdatePanel> Server 托管模型感到陌生。</span><span class="sxs-lookup"><span data-stu-id="cc501-144">The Blazor Server hosting model may sound familiar if you've used ASP.NET AJAX and the <xref:System.Web.UI.UpdatePanel> control.</span></span> <span data-ttu-id="cc501-145">`UpdatePanel` 控件负责应用部分页面更新以响应页面上的触发事件。</span><span class="sxs-lookup"><span data-stu-id="cc501-145">The `UpdatePanel` control handles applying partial page updates in response to trigger events on the page.</span></span> <span data-ttu-id="cc501-146">触发时，`UpdatePanel` 会请求部分更新，然后应用该更新，无需刷新页面。</span><span class="sxs-lookup"><span data-stu-id="cc501-146">When triggered, the `UpdatePanel` requests a partial update and then applies it without needing to refresh the page.</span></span> <span data-ttu-id="cc501-147">UI 状态使用 `ViewState` 进行管理。</span><span class="sxs-lookup"><span data-stu-id="cc501-147">The state of the UI is managed using `ViewState`.</span></span> <span data-ttu-id="cc501-148">Blazor Server 应用略有不同，因为该应用需要与客户端建立活动连接。</span><span class="sxs-lookup"><span data-stu-id="cc501-148">Blazor Server apps are slightly different in that the app requires an active connection with the client.</span></span> <span data-ttu-id="cc501-149">此外，服务器上的所有 UI 状态都需要进行维护。</span><span class="sxs-lookup"><span data-stu-id="cc501-149">Additionally, all UI state is maintained on the server.</span></span> <span data-ttu-id="cc501-150">除了这些差异之外，这两个模型在概念上类似。</span><span class="sxs-lookup"><span data-stu-id="cc501-150">Aside from those differences, the two models are conceptually similar.</span></span>

## <a name="how-to-choose-the-right-blazor-hosting-model"></a><span data-ttu-id="cc501-151">如何选择正确的 Blazor 托管模型</span><span class="sxs-lookup"><span data-stu-id="cc501-151">How to choose the right Blazor hosting model</span></span>

<span data-ttu-id="cc501-152">正如 [Blazor 托管模型文档](/aspnet/core/blazor/hosting-models)中所述，不同的 Blazor 托管模型具有不同的优缺点。</span><span class="sxs-lookup"><span data-stu-id="cc501-152">As described in the [Blazor hosting model docs](/aspnet/core/blazor/hosting-models), the different Blazor hosting models have different tradeoffs.</span></span>

<span data-ttu-id="cc501-153">Blazor WebAssembly 托管模型具有以下优点：</span><span class="sxs-lookup"><span data-stu-id="cc501-153">The Blazor WebAssembly hosting model has the following benefits:</span></span>

- <span data-ttu-id="cc501-154">没有 .NET 服务器端依赖项。</span><span class="sxs-lookup"><span data-stu-id="cc501-154">There's no .NET server-side dependency.</span></span> <span data-ttu-id="cc501-155">应用下载到客户端后即可正常运行。</span><span class="sxs-lookup"><span data-stu-id="cc501-155">The app is fully functioning after downloaded to the client.</span></span>
- <span data-ttu-id="cc501-156">可充分利用客户端资源和功能。</span><span class="sxs-lookup"><span data-stu-id="cc501-156">Client resources and capabilities are fully leveraged.</span></span>
- <span data-ttu-id="cc501-157">工作可从服务器转移到客户端。</span><span class="sxs-lookup"><span data-stu-id="cc501-157">Work is offloaded from the server to the client.</span></span>
- <span data-ttu-id="cc501-158">无需 ASP.NET Core Web 服务器即可托管应用。</span><span class="sxs-lookup"><span data-stu-id="cc501-158">An ASP.NET Core web server isn't required to host the app.</span></span> <span data-ttu-id="cc501-159">无服务器部署方案可行（例如通过 CDN 为应用提供服务的方案）。</span><span class="sxs-lookup"><span data-stu-id="cc501-159">Serverless deployment scenarios are possible (for example, serving the app from a CDN).</span></span>

<span data-ttu-id="cc501-160">Blazor WebAssembly 托管模型具有以下缺点：</span><span class="sxs-lookup"><span data-stu-id="cc501-160">The downsides of the Blazor WebAssembly hosting model are:</span></span>

- <span data-ttu-id="cc501-161">浏览器功能限制了该应用。</span><span class="sxs-lookup"><span data-stu-id="cc501-161">Browser capabilities restrict the app.</span></span>
- <span data-ttu-id="cc501-162">需要客户端硬件和软件支持（例如 WebAssembly 支持）。</span><span class="sxs-lookup"><span data-stu-id="cc501-162">Capable client hardware and software (for example, WebAssembly support) is required.</span></span>
- <span data-ttu-id="cc501-163">下载项大小较大，应用加载耗时较长。</span><span class="sxs-lookup"><span data-stu-id="cc501-163">Download size is larger, and apps take longer to load.</span></span>
- <span data-ttu-id="cc501-164">.NET 运行时和工具支持不够完善。</span><span class="sxs-lookup"><span data-stu-id="cc501-164">.NET runtime and tooling support is less mature.</span></span> <span data-ttu-id="cc501-165">例如，[.NET Standard](../../standard/net-standard.md) 支持和调试方面存在限制。</span><span class="sxs-lookup"><span data-stu-id="cc501-165">For example, there are limitations in [.NET Standard](../../standard/net-standard.md) support and debugging.</span></span>

<span data-ttu-id="cc501-166">相反，Blazor Server 托管模型具有以下优点：</span><span class="sxs-lookup"><span data-stu-id="cc501-166">Conversely, the Blazor Server hosting model offers the following benefits:</span></span>

- <span data-ttu-id="cc501-167">下载大小明显小于客户端应用，并且应用的加载速度更快。</span><span class="sxs-lookup"><span data-stu-id="cc501-167">Download size is much smaller than a client-side app, and the app loads much faster.</span></span>
- <span data-ttu-id="cc501-168">应用可以充分利用服务器功能，包括使用任何与 .NET 兼容的 API。</span><span class="sxs-lookup"><span data-stu-id="cc501-168">The app takes full advantage of server capabilities, including use of any .NET compatible APIs.</span></span>
- <span data-ttu-id="cc501-169">服务器上的 .NET 用于运行应用，因此调试等现有 .NET 工具可按预期正常工作。</span><span class="sxs-lookup"><span data-stu-id="cc501-169">.NET on the server is used to run the app, so existing .NET tooling, such as debugging, works as expected.</span></span>
- <span data-ttu-id="cc501-170">支持瘦客户端。</span><span class="sxs-lookup"><span data-stu-id="cc501-170">Thin clients are supported.</span></span> <span data-ttu-id="cc501-171">例如，服务器端的应用适用于不支持 WebAssembly 以及资源受约束的设备上的浏览器。</span><span class="sxs-lookup"><span data-stu-id="cc501-171">For example, server-side apps work with browsers that don't support WebAssembly and on resource-constrained devices.</span></span>
- <span data-ttu-id="cc501-172">应用的 .NET/C# 代码库（其中包括应用的组件代码）不适用于客户端。</span><span class="sxs-lookup"><span data-stu-id="cc501-172">The app's .NET/C# code base, including the app's component code, isn't served to clients.</span></span>

<span data-ttu-id="cc501-173">Blazor Server 托管模型具有以下缺点：</span><span class="sxs-lookup"><span data-stu-id="cc501-173">The downsides to the Blazor Server hosting model are:</span></span>

- <span data-ttu-id="cc501-174">UI 延迟更高。</span><span class="sxs-lookup"><span data-stu-id="cc501-174">Higher UI latency.</span></span> <span data-ttu-id="cc501-175">每次用户交互都涉及到网络跃点。</span><span class="sxs-lookup"><span data-stu-id="cc501-175">Every user interaction involves a network hop.</span></span>
- <span data-ttu-id="cc501-176">不支持脱机工作。</span><span class="sxs-lookup"><span data-stu-id="cc501-176">There's no offline support.</span></span> <span data-ttu-id="cc501-177">如果客户端连接失败，应用会停止工作。</span><span class="sxs-lookup"><span data-stu-id="cc501-177">If the client connection fails, the app stops working.</span></span>
- <span data-ttu-id="cc501-178">如果具有多名用户，则应用扩缩性存在挑战。</span><span class="sxs-lookup"><span data-stu-id="cc501-178">Scalability is challenging for apps with many users.</span></span> <span data-ttu-id="cc501-179">服务器必须管理多个客户端连接并处理客户端状态。</span><span class="sxs-lookup"><span data-stu-id="cc501-179">The server must manage multiple client connections and handle client state.</span></span>
- <span data-ttu-id="cc501-180">需要 ASP.NET Core 服务器为应用提供服务。</span><span class="sxs-lookup"><span data-stu-id="cc501-180">An ASP.NET Core server is required to serve the app.</span></span> <span data-ttu-id="cc501-181">不支持无服务器部署方案。</span><span class="sxs-lookup"><span data-stu-id="cc501-181">Serverless deployment scenarios aren't possible.</span></span> <span data-ttu-id="cc501-182">例如，无法从 CDN 提供应用。</span><span class="sxs-lookup"><span data-stu-id="cc501-182">For example, you can't serve the app from a CDN.</span></span>

<span data-ttu-id="cc501-183">上述优缺点列表可能会让你顾虑重重，但你可在以后更改托管模型。</span><span class="sxs-lookup"><span data-stu-id="cc501-183">The preceding list of trade-offs may be intimidating, but your hosting model can be changed later.</span></span> <span data-ttu-id="cc501-184">无论是否选择 Blazor 托管模型，组件模型都是相同的。</span><span class="sxs-lookup"><span data-stu-id="cc501-184">Regardless of the Blazor hosting model selected, the component model is *the same*.</span></span> <span data-ttu-id="cc501-185">原则上，相同组件可用于任一托管模型。</span><span class="sxs-lookup"><span data-stu-id="cc501-185">In principle, the same components can be used with either hosting model.</span></span> <span data-ttu-id="cc501-186">应用代码不会更改，但最佳做法是引入抽象，使组件与托管模型无关。</span><span class="sxs-lookup"><span data-stu-id="cc501-186">Your app code doesn't change; however, it's a good practice to introduce abstractions so that your components stay hosting model-agnostic.</span></span> <span data-ttu-id="cc501-187">抽象使应用能够更轻松地采用不同的托管模型。</span><span class="sxs-lookup"><span data-stu-id="cc501-187">The abstractions allow your app to more easily adopt a different hosting model.</span></span>

## <a name="deploy-your-app"></a><span data-ttu-id="cc501-188">部署你的应用</span><span class="sxs-lookup"><span data-stu-id="cc501-188">Deploy your app</span></span>

<span data-ttu-id="cc501-189">ASP.NET Web Forms 应用通常在 Windows Server 计算机或群集的 IIS 上托管。</span><span class="sxs-lookup"><span data-stu-id="cc501-189">ASP.NET Web Forms apps are typically hosted on IIS on a Windows Server machine or cluster.</span></span> <span data-ttu-id="cc501-190">Blazor 应用还可以：</span><span class="sxs-lookup"><span data-stu-id="cc501-190">Blazor apps can also:</span></span>

- <span data-ttu-id="cc501-191">作为静态文件或 ASP.NET Core 应用托管在 IIS 上。</span><span class="sxs-lookup"><span data-stu-id="cc501-191">Be hosted on IIS, either as static files or as an ASP.NET Core app.</span></span>
- <span data-ttu-id="cc501-192">利用 ASP.NET Core 的灵活性托管在各种平台和服务器基础结构上。</span><span class="sxs-lookup"><span data-stu-id="cc501-192">Leverage ASP.NET Core's flexibility to be hosted on various platforms and server infrastructures.</span></span> <span data-ttu-id="cc501-193">例如，可使用 Linux 上的 [Nginx](/aspnet/core/host-and-deploy/linux-nginx) 或 [Apache](/aspnet/core/host-and-deploy/linux-apache) 托管 Blazor 应用。</span><span class="sxs-lookup"><span data-stu-id="cc501-193">For example, you can host a Blazor App using [Nginx](/aspnet/core/host-and-deploy/linux-nginx) or [Apache](/aspnet/core/host-and-deploy/linux-apache) on Linux.</span></span> <span data-ttu-id="cc501-194">有关如何发布和部署 Blazor 应用的详细信息，请参阅 Blazor [托管和部署](/aspnet/core/host-and-deploy/blazor/)文档。</span><span class="sxs-lookup"><span data-stu-id="cc501-194">For more information about how to publish and deploy Blazor apps, see the Blazor [Hosting and deployment](/aspnet/core/host-and-deploy/blazor/) documentation.</span></span>

<span data-ttu-id="cc501-195">在下一部分中，我们将介绍如何设置 Blazor WebAssembly 和 Blazor Server 应用的项目。</span><span class="sxs-lookup"><span data-stu-id="cc501-195">In the next section, we'll look at how the projects for Blazor WebAssembly and Blazor Server apps are set up.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="cc501-196">[上一页](architecture-comparison.md)
>[下一页](project-structure.md)</span><span class="sxs-lookup"><span data-stu-id="cc501-196">[Previous](architecture-comparison.md)
[Next](project-structure.md)</span></span>

---
description: 了解详细信息：消息传递活动
title: 消息传递活动
ms.date: 03/30/2017
ms.assetid: 8498f215-1823-4aba-a6e1-391407f8c273
ms.openlocfilehash: fc98081cabc552cd51bf35db3bed9443220fc065
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/06/2021
ms.locfileid: "99756066"
---
# <a name="messaging-activities"></a><span data-ttu-id="fbc2c-103">消息传递活动</span><span class="sxs-lookup"><span data-stu-id="fbc2c-103">Messaging activities</span></span>

<span data-ttu-id="fbc2c-104">消息传递活动使工作流能够发送和接收 WCF 消息。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-104">Messaging activities allow workflows to send and receive WCF messages.</span></span> <span data-ttu-id="fbc2c-105">通过将消息传递活动添加到工作流，您可以对任意复杂的消息交换模式 (MEP) 进行建模。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-105">By adding messaging activities to a workflow you can model any arbitrarily complex message exchange patterns (MEP).</span></span>

## <a name="message-exchange-patterns"></a><span data-ttu-id="fbc2c-106">消息交换模式</span><span class="sxs-lookup"><span data-stu-id="fbc2c-106">Message exchange patterns</span></span>

<span data-ttu-id="fbc2c-107">有以下三种基本消息交换模式：</span><span class="sxs-lookup"><span data-stu-id="fbc2c-107">There are three basic message exchange patterns:</span></span>

- <span data-ttu-id="fbc2c-108">**数据报** -当使用数据报 MEP 时，客户端将向服务发送一条消息，但服务不响应。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-108">**Datagram** - When using the datagram MEP the client sends a message to the service, but the service does not respond.</span></span> <span data-ttu-id="fbc2c-109">有时称为“发后不理”(fire and forget)。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-109">This is sometimes called "fire and forget".</span></span> <span data-ttu-id="fbc2c-110">“发后不理”交换形式是一种要求带外确认成功传递的交换形式。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-110">A fire and forget exchange is one that requires out-of-band confirmation of successful delivery.</span></span> <span data-ttu-id="fbc2c-111">消息在传输过程中可能会丢失，而永远不能到达服务。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-111">The message might be lost in transit and never reach the service.</span></span> <span data-ttu-id="fbc2c-112">即使客户端成功发送消息，也并不保证服务已经收到消息。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-112">If the client successfully sends a message, it does not guarantee that the service has received the message.</span></span> <span data-ttu-id="fbc2c-113">数据报是消息传递的基本构造块，因为您可以基于数据报构建自己的 MEP。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-113">The datagram is a fundamental building block for messaging, as you can build your own MEPs on top of it.</span></span>

- <span data-ttu-id="fbc2c-114">**请求-响应** -当使用请求-响应 MEP 时，客户端将向服务发送一条消息，服务将执行所需的处理，然后将响应发送回客户端。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-114">**Request-Response** - When using the request-response MEP the client sends a message to the service, the service does the required processing, and then sends a response back to the client.</span></span> <span data-ttu-id="fbc2c-115">此模式由请求-响应对组成。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-115">The pattern consists of request-response pairs.</span></span> <span data-ttu-id="fbc2c-116">请求-响应调用的示例包括远程过程调用 (RPC) 和浏览器的 GET 请求。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-116">Examples of request-response calls are remote procedure calls (RPC) and browser GET requests.</span></span> <span data-ttu-id="fbc2c-117">此模式也称为半双工。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-117">This pattern is also known as half-duplex.</span></span>

- <span data-ttu-id="fbc2c-118">**双工** -使用双工 MEP 时，客户端和服务可以按任意顺序发送消息。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-118">**Duplex** - When using the duplex MEP the client and service can send messages to each other in any order.</span></span> <span data-ttu-id="fbc2c-119">双工 MEP 就像电话通话，所说的每一个字都是一条消息。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-119">The duplex MEP is like a phone conversation, where each word being spoken is a message.</span></span>

<span data-ttu-id="fbc2c-120">使用消息传递活动能够实现这些基本 MEP 中的任何一个以及任意复杂的 MEP。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-120">The messaging activities allow you to implement any of these basic MEPs as well as any arbitrarily complex MEP.</span></span>

## <a name="messaging-activities"></a><span data-ttu-id="fbc2c-121">消息传递活动</span><span class="sxs-lookup"><span data-stu-id="fbc2c-121">Messaging activities</span></span>

<span data-ttu-id="fbc2c-122">[!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)]定义了下面的消息传递活动：</span><span class="sxs-lookup"><span data-stu-id="fbc2c-122">The [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] defines the following messaging activities:</span></span>

- <span data-ttu-id="fbc2c-123"><xref:System.ServiceModel.Activities.Send> - 使用 <xref:System.ServiceModel.Activities.Send> 活动可发送消息。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-123"><xref:System.ServiceModel.Activities.Send>- Use the <xref:System.ServiceModel.Activities.Send> activity to send a message.</span></span>

- <span data-ttu-id="fbc2c-124"><xref:System.ServiceModel.Activities.SendReply> - 使用 <xref:System.ServiceModel.Activities.SendReply> 活动可发送对接收到的消息的响应。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-124"><xref:System.ServiceModel.Activities.SendReply> - Use the <xref:System.ServiceModel.Activities.SendReply> activity to send a response to a received message.</span></span> <span data-ttu-id="fbc2c-125">此活动由工作流服务用来实现请求/答复 MEP。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-125">This activity is used by workflow services when implementing a request/reply MEP.</span></span>

- <span data-ttu-id="fbc2c-126"><xref:System.ServiceModel.Activities.Receive> - 使用 <xref:System.ServiceModel.Activities.Receive> 活动可接收消息。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-126"><xref:System.ServiceModel.Activities.Receive>- Use the <xref:System.ServiceModel.Activities.Receive> activity to receive a message.</span></span>

- <span data-ttu-id="fbc2c-127"><xref:System.ServiceModel.Activities.ReceiveReply> - 使用 <xref:System.ServiceModel.Activities.ReceiveReply> 活动可接收答复消息。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-127"><xref:System.ServiceModel.Activities.ReceiveReply> - Use the <xref:System.ServiceModel.Activities.ReceiveReply> activity to receive a reply message.</span></span> <span data-ttu-id="fbc2c-128">此活动由工作流服务客户端用来实现请求/答复 MEP。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-128">This activity is used by workflow service clients when implementing a request/reply MEP.</span></span>

## <a name="messaging-activities-and-message-exchange-patterns"></a><span data-ttu-id="fbc2c-129">消息传递活动和消息交换模式</span><span class="sxs-lookup"><span data-stu-id="fbc2c-129">Messaging activities and message exchange patterns</span></span>

<span data-ttu-id="fbc2c-130">数据报 MEP 涉及发送消息的客户端和接收消息的服务。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-130">A datagram MEP involves a client sending a message and a service receiving the message.</span></span> <span data-ttu-id="fbc2c-131">如果客户端为工作流，则使用 <xref:System.ServiceModel.Activities.Send> 活动发送消息。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-131">If the client is a workflow use a <xref:System.ServiceModel.Activities.Send> activity to send the message.</span></span> <span data-ttu-id="fbc2c-132">若要接收工作流中的该消息，请使用 <xref:System.ServiceModel.Activities.Receive> 活动。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-132">To receive that message in a workflow, use a <xref:System.ServiceModel.Activities.Receive> activity.</span></span> <span data-ttu-id="fbc2c-133"><xref:System.ServiceModel.Activities.Send> 和 <xref:System.ServiceModel.Activities.Receive> 活动各自具有一个名为 `Content` 的属性。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-133">The <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.Receive> activities each have a property named `Content`.</span></span> <span data-ttu-id="fbc2c-134">此属性包含要发送或接收的数据。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-134">This property contains the data being sent or received.</span></span> <span data-ttu-id="fbc2c-135">实现请求-响应 MEP 时，客户端和服务都使用活动对。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-135">When implementing the request-response MEP both the client and the service use pairs of activities.</span></span> <span data-ttu-id="fbc2c-136">客户端使用 <xref:System.ServiceModel.Activities.Send> 活动发送消息并使用 <xref:System.ServiceModel.Activities.ReceiveReply> 活动接收来自服务的响应。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-136">The client uses a <xref:System.ServiceModel.Activities.Send> activity to send the message and a <xref:System.ServiceModel.Activities.ReceiveReply> activity to receive the response from the service.</span></span> <span data-ttu-id="fbc2c-137">这两个活动通过 <xref:System.ServiceModel.Activities.ReceiveReply.Request%2A> 属性相互关联。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-137">These two activities are associated with each other by the <xref:System.ServiceModel.Activities.ReceiveReply.Request%2A> property.</span></span> <span data-ttu-id="fbc2c-138">该属性设置为发送原始消息的 <xref:System.ServiceModel.Activities.Send> 活动。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-138">This property is set to the <xref:System.ServiceModel.Activities.Send> activity that sent the original message.</span></span> <span data-ttu-id="fbc2c-139">服务还使用一对关联的活动：<xref:System.ServiceModel.Activities.Receive> 和 <xref:System.ServiceModel.Activities.SendReply>。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-139">The service also uses a pair of associated activities: <xref:System.ServiceModel.Activities.Receive> and <xref:System.ServiceModel.Activities.SendReply>.</span></span> <span data-ttu-id="fbc2c-140">这两个活动通过 <xref:System.ServiceModel.Activities.SendReply.Request%2A> 属性关联。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-140">These two activities are associated by the <xref:System.ServiceModel.Activities.SendReply.Request%2A> property.</span></span> <span data-ttu-id="fbc2c-141">该属性设置为接收原始消息的 <xref:System.ServiceModel.Activities.Receive> 活动。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-141">This property is set to the <xref:System.ServiceModel.Activities.Receive> activity that received the original message.</span></span> <span data-ttu-id="fbc2c-142"><xref:System.ServiceModel.Activities.ReceiveReply> 和 <xref:System.ServiceModel.Activities.SendReply> 活动，与 <xref:System.ServiceModel.Activities.Send> 和 <xref:System.ServiceModel.Activities.Receive> 一样，可用于发送 <xref:System.ServiceModel.Channels.Message> 实例或消息协定类型。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-142">The <xref:System.ServiceModel.Activities.ReceiveReply> and <xref:System.ServiceModel.Activities.SendReply> activities, like <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.Receive> allow you to send a <xref:System.ServiceModel.Channels.Message> instance or a message contract type.</span></span>

<span data-ttu-id="fbc2c-143">由于工作流具有长时间运行的性质，因此同时支持长时间运行的对话对于双工通信模式非常重要。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-143">Because of the long-running nature of workflows, it is important for the duplex pattern of communication to also support long-running conversations.</span></span> <span data-ttu-id="fbc2c-144">若要支持长时间运行的对话，启动对话的客户端必须提供适当的机会，使服务在以后数据变为可用时能够回拨客户端。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-144">To support long-running conversations, clients who initiate the conversation must provide the service with an opportunity to call it back at a later time when the data becomes available.</span></span> <span data-ttu-id="fbc2c-145">例如，已提交采购订单请求等待经理批准，但该请求可能一天、一周甚至一年也未被处理；管理采购订单批准的工作流必须知道在请求得到批准后恢复。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-145">For example, a purchase order request is submitted for manager approval, but it might not be processed for a day, a week, or even a year; the workflow that manages the purchase order approval must know to resume after the approval is given.</span></span> <span data-ttu-id="fbc2c-146">使用相关性的工作流中支持此双工通信模式。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-146">This pattern of duplex communication is supported in workflows using correlation.</span></span> <span data-ttu-id="fbc2c-147">若要实现双工模式，请使用 <xref:System.ServiceModel.Activities.Send> 和 <xref:System.ServiceModel.Activities.Receive> 活动。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-147">To implement a duplex pattern, use <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.Receive> activities.</span></span> <span data-ttu-id="fbc2c-148">在 <xref:System.ServiceModel.Activities.Receive> 活动上，使用初始化相关 <xref:System.ServiceModel.Activities.CorrelationHandle> 。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-148">On the <xref:System.ServiceModel.Activities.Receive> activity, initialize a correlation using <xref:System.ServiceModel.Activities.CorrelationHandle>.</span></span> <span data-ttu-id="fbc2c-149">在 <xref:System.ServiceModel.Activities.Send> 活动上，将该相关性句柄设置为 <xref:System.ServiceModel.Activities.Send.CorrelatesWith%2A> 属性值。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-149">On the <xref:System.ServiceModel.Activities.Send> activity set that correlation handle as the <xref:System.ServiceModel.Activities.Send.CorrelatesWith%2A> property value.</span></span> <span data-ttu-id="fbc2c-150">有关详细信息，请参阅 [持久双工](durable-duplex-correlation.md)。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-150">For more information, see [Durable Duplex](durable-duplex-correlation.md).</span></span>

> [!NOTE]
> <span data-ttu-id="fbc2c-151">使用回调相关 ( "持久双工" ) 的工作流的双工实现适用于长时间运行的会话。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-151">Workflow’s implementation of duplex using a callback correlation ("Durable Duplex") is intended for long-running conversations.</span></span> <span data-ttu-id="fbc2c-152">这与具有回调协定的 WCF 双工不同，在 WCF 双工中，对话是短时间运行的（通道的生存期）。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-152">This is not the same as WCF duplex with callback contracts where the conversation is short-running (the lifetime of the channel).</span></span>

## <a name="message-formatting-and-messaging-activities"></a><span data-ttu-id="fbc2c-153">消息格式和消息传递活动</span><span class="sxs-lookup"><span data-stu-id="fbc2c-153">Message formatting and messaging activities</span></span>

<span data-ttu-id="fbc2c-154"><xref:System.ServiceModel.Activities.Receive> 和 <xref:System.ServiceModel.Activities.ReceiveReply> 活动具有一个名为 `Content` 的属性。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-154">The <xref:System.ServiceModel.Activities.Receive> and <xref:System.ServiceModel.Activities.ReceiveReply> activities have a property named `Content`.</span></span> <span data-ttu-id="fbc2c-155">此属性的类型为 <xref:System.ServiceModel.Activities.ReceiveContent>，它表示 <xref:System.ServiceModel.Activities.Receive> 或 <xref:System.ServiceModel.Activities.ReceiveReply> 活动接收的数据。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-155">This property is of type <xref:System.ServiceModel.Activities.ReceiveContent> and represents data the <xref:System.ServiceModel.Activities.Receive> or <xref:System.ServiceModel.Activities.ReceiveReply> activity receives.</span></span> <span data-ttu-id="fbc2c-156">.NET Framework 定义两个名为 <xref:System.ServiceModel.Activities.ReceiveMessageContent> 和 <xref:System.ServiceModel.Activities.ReceiveParametersContent> 的相关类，这两个类都派生自 <xref:System.ServiceModel.Activities.ReceiveContent>。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-156">The .NET Framework defines two related classes called <xref:System.ServiceModel.Activities.ReceiveMessageContent> and <xref:System.ServiceModel.Activities.ReceiveParametersContent> both of which are derived from <xref:System.ServiceModel.Activities.ReceiveContent>.</span></span> <span data-ttu-id="fbc2c-157">将 <xref:System.ServiceModel.Activities.Receive> 或 <xref:System.ServiceModel.Activities.ReceiveReply> 活动的 `Content` 属性设置为其中一个类型的实例，这样可将数据接收到工作流服务。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-157">Set the <xref:System.ServiceModel.Activities.Receive> or <xref:System.ServiceModel.Activities.ReceiveReply> activity’s `Content` property to an instance of one of these types to receive data into a workflow service.</span></span> <span data-ttu-id="fbc2c-158">要使用的类型取决于活动接收的数据的类型。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-158">The type to use depends upon the type of data the activity receives.</span></span> <span data-ttu-id="fbc2c-159">如果活动接收到 `Message` 对象或消息协定类型，则使用 <xref:System.ServiceModel.Activities.ReceiveMessageContent>。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-159">If the activity receives a `Message` object or a message contract type, use <xref:System.ServiceModel.Activities.ReceiveMessageContent>.</span></span> <span data-ttu-id="fbc2c-160">如果活动接收到一组数据协定或可序列化的 XML 类型，则使用 <xref:System.ServiceModel.Activities.ReceiveParametersContent>。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-160">If the activity receives a set of data contract or XML types that can be serialized, use <xref:System.ServiceModel.Activities.ReceiveParametersContent>.</span></span> <span data-ttu-id="fbc2c-161">使用 <xref:System.ServiceModel.Activities.ReceiveParametersContent> 可以发送多个参数，而使用 <xref:System.ServiceModel.Activities.ReceiveMessageContent> 只能发送一个对象，即消息（或消息协定类型）。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-161"><xref:System.ServiceModel.Activities.ReceiveParametersContent> allows you to send multiple parameters, whereas <xref:System.ServiceModel.Activities.ReceiveMessageContent> only allows you to send one object, the message (or message contract type).</span></span>

> [!NOTE]
> <span data-ttu-id="fbc2c-162">还可将 <xref:System.ServiceModel.Activities.ReceiveMessageContent> 与单个数据协定或可序列化的 XML 类型一起使用。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-162"><xref:System.ServiceModel.Activities.ReceiveMessageContent> can also be used with a single data contract or XML type that can be serialized.</span></span> <span data-ttu-id="fbc2c-163">将 <xref:System.ServiceModel.Activities.ReceiveParametersContent> 和单个参数一起使用与直接将对象传递给 <xref:System.ServiceModel.Activities.ReceiveMessageContent> 之间的区别在于连网格式。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-163">The difference between using <xref:System.ServiceModel.Activities.ReceiveParametersContent> with a single parameter and the object passed directly to <xref:System.ServiceModel.Activities.ReceiveMessageContent> is the wire-format.</span></span> <span data-ttu-id="fbc2c-164">参数的内容包装在与操作名称相对应的 XML 元素中，而序列化对象则使用参数名称包装在 XML 元素中（例如 `<Echo><msg>Hello, World</msg></Echo>`）。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-164">The parameter’s content is wrapped in an XML element that corresponds to the operation name and the serialized object is wrapped in an XML element using the parameter name (for example, `<Echo><msg>Hello, World</msg></Echo>`).</span></span> <span data-ttu-id="fbc2c-165">消息内容不由操作名称包装。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-165">The message content is not wrapped by the operation name.</span></span> <span data-ttu-id="fbc2c-166">相反，序列化对象则使用 XML 限定类型名称放置在 XML 元素中（例如 `<string>Hello, World</string>`）。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-166">Instead, the serialized object is placed within an XML element using the XML-qualified type name (for example, `<string>Hello, World</string>`).</span></span>

<span data-ttu-id="fbc2c-167"><xref:System.ServiceModel.Activities.Send> 和 <xref:System.ServiceModel.Activities.SendReply> 活动还具有一个名为 `Content` 的属性。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-167">The <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.SendReply> activities also have a property named `Content`.</span></span> <span data-ttu-id="fbc2c-168">此属性的类型为 <xref:System.ServiceModel.Activities.SendContent>，它表示 <xref:System.ServiceModel.Activities.Send> 或 <xref:System.ServiceModel.Activities.SendReply> 活动发送的数据。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-168">This property is of type <xref:System.ServiceModel.Activities.SendContent> and represents data the <xref:System.ServiceModel.Activities.Send> or <xref:System.ServiceModel.Activities.SendReply> activity sends.</span></span> <span data-ttu-id="fbc2c-169">.NET Framework 定义两个名为 <xref:System.ServiceModel.Activities.SendMessageContent> 和 <xref:System.ServiceModel.Activities.SendParametersContent> 的相关类型，这两个类型都派生自 <xref:System.ServiceModel.Activities.SendContent>。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-169">The .NET Framework defines two related types called <xref:System.ServiceModel.Activities.SendMessageContent> and <xref:System.ServiceModel.Activities.SendParametersContent> both of which are derived from <xref:System.ServiceModel.Activities.SendContent>.</span></span> <span data-ttu-id="fbc2c-170">将 <xref:System.ServiceModel.Activities.Send> 或 <xref:System.ServiceModel.Activities.SendReply> 活动的 `Content` 属性设置为其中一个类型的实例，以便从工作流服务发送数据。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-170">Set the <xref:System.ServiceModel.Activities.Send> or <xref:System.ServiceModel.Activities.SendReply> activity’s `Content` property to an instance of one of these types to send data from a workflow service.</span></span> <span data-ttu-id="fbc2c-171">要使用的类型取决于活动发送的数据的类型。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-171">The type to use depends upon the type of data the activity sends.</span></span> <span data-ttu-id="fbc2c-172">如果活动发送 `Message` 对象或消息协定类型，则使用 <xref:System.ServiceModel.Activities.SendMessageContent>。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-172">If the activity sends a `Message` object or a message contract type, use <xref:System.ServiceModel.Activities.SendMessageContent>.</span></span> <span data-ttu-id="fbc2c-173">如果活动发送数据协定类型，则使用 <xref:System.ServiceModel.Activities.SendParametersContent>。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-173">If the activity sends a data contract type use <xref:System.ServiceModel.Activities.SendParametersContent>.</span></span> <span data-ttu-id="fbc2c-174">使用<xref:System.ServiceModel.Activities.SendParametersContent> 可以发送多个参数，而使用 <xref:System.ServiceModel.Activities.SendMessageContent> 只能发送一个对象，即消息（或消息协定类型）。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-174"><xref:System.ServiceModel.Activities.SendParametersContent> allows you to send multiple parameters, whereas <xref:System.ServiceModel.Activities.SendMessageContent> only allows you to send one object, the message (or the message contract type).</span></span>

<span data-ttu-id="fbc2c-175">以命令方式对消息传递活动进行编程时，使用泛型 <xref:System.Activities.InArgument%601> 和 <xref:System.Activities.OutArgument%601> 包装分配给消息的对象或者包装 <xref:System.ServiceModel.Activities.Send>、<xref:System.ServiceModel.Activities.SendReply>、<xref:System.ServiceModel.Activities.Receive> 和 <xref:System.ServiceModel.Activities.ReceiveReply> 活动的参数属性。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-175">When programming imperatively with the messaging activities, you use the generic <xref:System.Activities.InArgument%601> and <xref:System.Activities.OutArgument%601> to wrap the objects you assign to the message or parameters properties of the <xref:System.ServiceModel.Activities.Send>, <xref:System.ServiceModel.Activities.SendReply>, <xref:System.ServiceModel.Activities.Receive>, and <xref:System.ServiceModel.Activities.ReceiveReply> activities.</span></span> <span data-ttu-id="fbc2c-176">用于 <xref:System.Activities.InArgument%601> <xref:System.ServiceModel.Activities.Send> 和 <xref:System.ServiceModel.Activities.SendReply> 活动，以及 <xref:System.Activities.OutArgument%601> <xref:System.ServiceModel.Activities.Receive> 和 <xref:System.ServiceModel.Activities.ReceiveReply> 活动。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-176">Use <xref:System.Activities.InArgument%601> for the <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.SendReply> activities and <xref:System.Activities.OutArgument%601> for <xref:System.ServiceModel.Activities.Receive> and <xref:System.ServiceModel.Activities.ReceiveReply> activities.</span></span> <span data-ttu-id="fbc2c-177">`In` 自变量用于发送活动，因为数据将传入到活动。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-177">`In` arguments are used with the send activities because the data is being passed into the activities.</span></span> <span data-ttu-id="fbc2c-178">`Out` 参数用于接收活动，因为数据将传出到活动之外，如下面的示例所示。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-178">`Out` arguments are used with the receive activities because data is being passed out of the activities, as shown in the following example.</span></span>

```csharp
Receive reserveSeat = new Receive
{
    ...
    Content = new ReceiveParametersContent
    {
        Parameters =
        {
            { "ReservationInfo", new OutArgument<ReservationRequest>(reservationInfo) }
        }
    }
};
SendReply reserveSeat = new SendReply
{
    ...
    Request = reserveSeat,
    Content = new SendParametersContent
    {
        Parameters =
        {
            { "ReservationId", new InArgument<string>(reservationId) }
        }
    },
};
```

<span data-ttu-id="fbc2c-179">如果要实现的工作流服务定义了返回 void 的请求/响应操作，则必须实例化 <xref:System.ServiceModel.Activities.SendReply> 活动，并将 <xref:System.ServiceModel.Activities.SendReply.Content%2A> 属性设置为某个内容类型（<xref:System.ServiceModel.Activities.SendMessageContent> 或 <xref:System.ServiceModel.Activities.SendParametersContent>）的空实例，如下面的示例所示。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-179">When implementing a workflow service that defines a request/response operation that returns void, you must instantiate a <xref:System.ServiceModel.Activities.SendReply> activity and set the <xref:System.ServiceModel.Activities.SendReply.Content%2A> property to an empty instance of one of the content types (<xref:System.ServiceModel.Activities.SendMessageContent> or <xref:System.ServiceModel.Activities.SendParametersContent>) as shown in the following example.</span></span>

```csharp
Receive rcv = new Receive()
{
ServiceContractName = "IService",
OperationName = "NullReturningContract",
Content = new ReceiveParametersContent( new Dictionary<string, OutArgument>() { { "message", new OutArgument<string>() } } )
};
SendReply sr = new SendReply()
{
Request = rcv
   Content = new SendParametersContent();
};
```

## <a name="add-service-reference"></a><span data-ttu-id="fbc2c-180">添加服务引用</span><span class="sxs-lookup"><span data-stu-id="fbc2c-180">Add service reference</span></span>

<span data-ttu-id="fbc2c-181">从工作流应用程序调用工作流服务时，Visual Studio 2012 会生成自定义消息传递活动，这些活动封装 <xref:System.ServiceModel.Activities.Send> <xref:System.ServiceModel.Activities.ReceiveReply> 请求/答复 MEP 中常用的和活动。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-181">When calling a workflow service from a workflow application, Visual Studio 2012 generates custom messaging activities that encapsulate the usual <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.ReceiveReply> activities used in a request/reply MEP.</span></span> <span data-ttu-id="fbc2c-182">若要使用此功能，请右键单击 Visual Studio 中的客户端项目，然后选择 "**添加**  >  **服务引用**"。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-182">To use this feature, right-click the client project in Visual Studio and select **Add** > **Service Reference**.</span></span> <span data-ttu-id="fbc2c-183">在地址框中键入服务的基址，然后单击“转到”。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-183">Type the base address of the service in the address box and click Go.</span></span> <span data-ttu-id="fbc2c-184">可用服务显示在 " **服务：** " 框中。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-184">The available services are displayed in the **Services:** box.</span></span> <span data-ttu-id="fbc2c-185">展开服务节点以显示支持的协定。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-185">Expand the service node to display the contracts supported.</span></span> <span data-ttu-id="fbc2c-186">选择要调用的协定，" **操作** " 框中会显示可用操作的列表。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-186">Select the contract you want to call and the list of available operations is displayed in the **Operations** box.</span></span> <span data-ttu-id="fbc2c-187">然后，您可以指定生成的活动的命名空间，然后单击 **"确定"**。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-187">You can then specify the namespace for the generated activity and click **OK**.</span></span> <span data-ttu-id="fbc2c-188">随即显示一个对话框，指出操作已成功完成，并且在您重新生成项目后，所生成的自定义活动都位于工具箱中。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-188">You then see a dialog that says the operation completed successfully and that the generated custom activities are in the toolbox after you have rebuilt the project.</span></span> <span data-ttu-id="fbc2c-189">在服务协定上定义的每个操作都有一个对应的活动。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-189">There is one activity for each operation defined on the service contract.</span></span> <span data-ttu-id="fbc2c-190">重新生成项目后，可以将自定义活动拖放到工作流上，并在属性窗口中设置任何所需的属性。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-190">After rebuilding the project you can drag and drop the custom activities onto your workflow and set any required properties in the properties window.</span></span>

## <a name="messaging-activity-templates"></a><span data-ttu-id="fbc2c-191">消息传递活动模板</span><span class="sxs-lookup"><span data-stu-id="fbc2c-191">Messaging activity templates</span></span>

<span data-ttu-id="fbc2c-192">为了更轻松地在客户端和服务上设置请求/响应 MEP，Visual Studio 2012 提供了两个消息传递活动模板。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-192">To make setting up a request/response MEP on the client and service easier, Visual Studio 2012 provides two messaging activity templates.</span></span> <span data-ttu-id="fbc2c-193">`System.ServiceModel.Activities.Design.ReceiveAndSendReply` 在服务上使用，`System.ServiceModel.Activities.Design.SendAndReceiveReply` 在客户端上使用。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-193">`System.ServiceModel.Activities.Design.ReceiveAndSendReply` is used on the service and `System.ServiceModel.Activities.Design.SendAndReceiveReply` is used on the client.</span></span> <span data-ttu-id="fbc2c-194">在两种情况下，模板都会将适当的消息传递活动添加到工作流中。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-194">In both cases the templates add the appropriate messaging activities to your workflow.</span></span> <span data-ttu-id="fbc2c-195">在服务上，`System.ServiceModel.Activities.Design.ReceiveAndSendReply` 先添加 <xref:System.ServiceModel.Activities.Receive> 活动，再添加 <xref:System.ServiceModel.Activities.SendReply> 活动。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-195">On the service, the `System.ServiceModel.Activities.Design.ReceiveAndSendReply` adds a <xref:System.ServiceModel.Activities.Receive> activity followed by a <xref:System.ServiceModel.Activities.SendReply> activity.</span></span> <span data-ttu-id="fbc2c-196"><xref:System.ServiceModel.Activities.SendReply.Request> 属性自动设置为 <xref:System.ServiceModel.Activities.Receive> 活动。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-196">The <xref:System.ServiceModel.Activities.SendReply.Request> property is automatically set to the <xref:System.ServiceModel.Activities.Receive> activity.</span></span> <span data-ttu-id="fbc2c-197">在客户端上，`System.ServiceModel.Activities.Design.SendAndReceiveReply` 先添加 <xref:System.ServiceModel.Activities.Send> 活动，再添加 <xref:System.ServiceModel.Activities.ReceiveReply> 活动。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-197">On the client, the `System.ServiceModel.Activities.Design.SendAndReceiveReply` adds a <xref:System.ServiceModel.Activities.Send> activity followed by a <xref:System.ServiceModel.Activities.ReceiveReply>.</span></span> <span data-ttu-id="fbc2c-198"><xref:System.ServiceModel.Activities.ReceiveReply.Request%2A> 属性自动设置为 <xref:System.ServiceModel.Activities.Send> 活动。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-198">The <xref:System.ServiceModel.Activities.ReceiveReply.Request%2A> property is automatically set to the <xref:System.ServiceModel.Activities.Send> activity.</span></span> <span data-ttu-id="fbc2c-199">若要使用这些模板，只需将适当的模板拖放到工作流上即可。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-199">To use these templates, just drag and drop the appropriate template onto your workflow.</span></span>

## <a name="messaging-activities-and-transactions"></a><span data-ttu-id="fbc2c-200">消息传递活动和事务</span><span class="sxs-lookup"><span data-stu-id="fbc2c-200">Messaging activities and transactions</span></span>

<span data-ttu-id="fbc2c-201">调用工作流服务时，你可能希望将事务流动到服务操作中。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-201">When a call is made to a workflow service you may want to flow a transaction to the service operation.</span></span> <span data-ttu-id="fbc2c-202">为此，请将 <xref:System.ServiceModel.Activities.Receive> 活动放置到 <xref:System.ServiceModel.Activities.TransactedReceiveScope> 活动中。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-202">To do this place the <xref:System.ServiceModel.Activities.Receive> activity within a <xref:System.ServiceModel.Activities.TransactedReceiveScope> activity.</span></span> <span data-ttu-id="fbc2c-203"><xref:System.ServiceModel.Activities.TransactedReceiveScope> 活动包含 `Receive` 活动和主体。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-203">The <xref:System.ServiceModel.Activities.TransactedReceiveScope> activity contains a `Receive` activity and a body.</span></span> <span data-ttu-id="fbc2c-204">流向服务的事务在执行 <xref:System.ServiceModel.Activities.TransactedReceiveScope> 的主体的整个过程中保持为环境事务。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-204">The transaction flowed to the service remains ambient throughout the execution of the body of the <xref:System.ServiceModel.Activities.TransactedReceiveScope>.</span></span> <span data-ttu-id="fbc2c-205">事务在执行完主体后完成。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-205">The transaction is completed when the body finishes executing.</span></span> <span data-ttu-id="fbc2c-206">有关工作流和事务的详细信息，请参阅 [工作流事务](../../windows-workflow-foundation/workflow-transactions.md)。</span><span class="sxs-lookup"><span data-stu-id="fbc2c-206">For more information about workflows and transactions see [Workflow Transactions](../../windows-workflow-foundation/workflow-transactions.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="fbc2c-207">请参阅</span><span class="sxs-lookup"><span data-stu-id="fbc2c-207">See also</span></span>

- [<span data-ttu-id="fbc2c-208">如何在工作流服务中发送和接收错误</span><span class="sxs-lookup"><span data-stu-id="fbc2c-208">How to Send and Receive Faults in Workflow Services</span></span>](https://go.microsoft.com/fwlink/?LinkId=189151)
- [<span data-ttu-id="fbc2c-209">创建长时间运行的工作流服务</span><span class="sxs-lookup"><span data-stu-id="fbc2c-209">Creating a Long-running Workflow Service</span></span>](creating-a-long-running-workflow-service.md)

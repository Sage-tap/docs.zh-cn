---
title: 了解和更新依赖项
description: 若要将 .NET Framework 项目迁移到 .NET Core，则必须将其依赖项更新为使用 .NET Core。 本部分介绍可用于规划大型应用的迁移的工具和方法。
author: ardalis
ms.date: 11/13/2020
ms.openlocfilehash: 484691496d3691151fd3ca83ec776dbb31327c09
ms.sourcegitcommit: b5d2290673e1c91260c9205202dd8b95fbab1a0b
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/01/2021
ms.locfileid: "106122750"
---
# <a name="understand-and-update-dependencies"></a><span data-ttu-id="ddc81-104">了解和更新依赖项</span><span class="sxs-lookup"><span data-stu-id="ddc81-104">Understand and update dependencies</span></span>

<span data-ttu-id="ddc81-105">确定应用程序的各个项目必须迁移到的顺序后，下一步是了解每个项目的依赖项，并在必要时对其进行更新。</span><span class="sxs-lookup"><span data-stu-id="ddc81-105">After identifying the sequence in which the app's individual projects must be migrated, the next step is to understand each project's dependencies and update them if necessary.</span></span> <span data-ttu-id="ddc81-106">对于平台依赖项，最佳启动方法是在相关程序集上运行 [.net 可移植性分析器](../../standard/analyzers/portability-analyzer.md) ，然后查看生成的详细结果。</span><span class="sxs-lookup"><span data-stu-id="ddc81-106">For platform dependencies, the best way to start is to run the [.NET Portability Analyzer](../../standard/analyzers/portability-analyzer.md) on the assembly in question, and then look at the detailed results that are generated.</span></span> <span data-ttu-id="ddc81-107">配置工具以指定一个或多个目标平台，如 .NET Core 3.1 或 .NET Standard 2.0。</span><span class="sxs-lookup"><span data-stu-id="ddc81-107">You configure the tool to specify one or more target platforms, such as .NET Core 3.1 or .NET Standard 2.0.</span></span> <span data-ttu-id="ddc81-108">其中提供了针对每个目标平台的详细信息。</span><span class="sxs-lookup"><span data-stu-id="ddc81-108">Results are provided with details for each platform targeted.</span></span> <span data-ttu-id="ddc81-109">图3-4 显示了该工具的输出示例。</span><span class="sxs-lookup"><span data-stu-id="ddc81-109">Figure 3-4 shows an example of the tool's output.</span></span>

![.NET 可移植性分析器报表详细信息](./media/Figure3-4.png)

<span data-ttu-id="ddc81-111">**图3-4。**</span><span class="sxs-lookup"><span data-stu-id="ddc81-111">**Figure 3-4.**</span></span> <span data-ttu-id="ddc81-112">.NET 可移植性分析器报表详细信息。</span><span class="sxs-lookup"><span data-stu-id="ddc81-112">.NET Portability Analyzer report details.</span></span>

## <a name="update-class-library-dependencies"></a><span data-ttu-id="ddc81-113">更新类库依赖项</span><span class="sxs-lookup"><span data-stu-id="ddc81-113">Update class library dependencies</span></span>

<span data-ttu-id="ddc81-114">大型应用程序通常涉及多个项目，而 ASP.NET MVC web 项目之外的大多数项目都可能是类库。</span><span class="sxs-lookup"><span data-stu-id="ddc81-114">Large apps typically involve multiple projects, and most projects other than the ASP.NET MVC web project are likely to be class libraries.</span></span> <span data-ttu-id="ddc81-115">类库在 .NET 平台之间通常是最容易的端口，尤其是与 ASP.NET 项目相比，它们在最难 (，通常需要重新创建) 。</span><span class="sxs-lookup"><span data-stu-id="ddc81-115">Class libraries tend to be the easiest to port between .NET platforms, especially compared to ASP.NET projects, which are among the most difficult (and typically need to be re-created).</span></span>

<span data-ttu-id="ddc81-116">团队可以考虑用于将类库迁移到 .NET Core 的 " [try-转换工具](https://github.com/dotnet/try-convert) " 或 " [.net 升级助手" 工具](https://aka.ms/dotnet-upgrade-assistant) 。</span><span class="sxs-lookup"><span data-stu-id="ddc81-116">Teams can consider the [try-convert tool](https://github.com/dotnet/try-convert) or the [.NET Upgrade Assistant tool](https://aka.ms/dotnet-upgrade-assistant) for migrating class libraries to .NET Core.</span></span> <span data-ttu-id="ddc81-117">这些工具分析 .NET Framework 的项目文件，并尝试将其迁移到 .NET Core 项目文件格式，进行任何修改，使其能够在此过程中安全执行。</span><span class="sxs-lookup"><span data-stu-id="ddc81-117">These tools analyze a .NET Framework project file and attempt to migrate it to the .NET Core project file format, making any modifications it can safely perform in the process.</span></span> <span data-ttu-id="ddc81-118">这些工具可能需要一些手动帮助才能使用 ASP.NET 项目，但通常可以帮助加速类库的迁移过程。</span><span class="sxs-lookup"><span data-stu-id="ddc81-118">The tools may require some manual assistance to work with ASP.NET projects, but can usually help speed up the process of migrating class libraries.</span></span>

<span data-ttu-id="ddc81-119">"Try-转换" 和 "升级助手" 工具部署为 .NET Core 命令行工具。</span><span class="sxs-lookup"><span data-stu-id="ddc81-119">The try-convert and Upgrade Assistant tools are deployed as .NET Core command line tools.</span></span> <span data-ttu-id="ddc81-120">它们仅在 Windows 上运行，因为它们设计为适用于 .NET Framework 应用。</span><span class="sxs-lookup"><span data-stu-id="ddc81-120">They only run on Windows, since they're designed to work with .NET Framework apps.</span></span> <span data-ttu-id="ddc81-121">你可以通过从命令提示符运行以下命令来安装 try-convert：</span><span class="sxs-lookup"><span data-stu-id="ddc81-121">You can install try-convert by running the following command from a command prompt:</span></span>

```dotnetcli
dotnet tool install -g try-convert
```

<span data-ttu-id="ddc81-122">成功安装该工具后，可以 `try-convert` 在类库的项目文件所在的文件夹中运行。</span><span class="sxs-lookup"><span data-stu-id="ddc81-122">Once you've successfully installed the tool, you can run `try-convert` in the folder where the class library's project file is located.</span></span>

<span data-ttu-id="ddc81-123">安装 try-convert) 后，在安装了以下命令 (安装 .NET 升级助手：</span><span class="sxs-lookup"><span data-stu-id="ddc81-123">Install the .NET Upgrade Assistant with the following command (after installing try-convert):</span></span>

```dotnetcli
dotnet tool install -g upgrade-assistant
```

<span data-ttu-id="ddc81-124">`upgrade-assistant <project>`在项目文件所在的文件夹中，通过命令运行该工具。</span><span class="sxs-lookup"><span data-stu-id="ddc81-124">Run the tool with the command `upgrade-assistant <project>` in the folder where the project file is located.</span></span>

## <a name="update-nuget-package-dependencies"></a><span data-ttu-id="ddc81-125">更新 NuGet 包依赖关系</span><span class="sxs-lookup"><span data-stu-id="ddc81-125">Update NuGet package dependencies</span></span>

<span data-ttu-id="ddc81-126">分析第三方 NuGet 包的使用情况，并确定其中是否有任何 .NET Standard (，或者是否支持它，但仅支持新版本) 。</span><span class="sxs-lookup"><span data-stu-id="ddc81-126">Analyze your use of third-party NuGet packages and determine if any of them don't yet support .NET Standard (or do support it but only with a new version).</span></span> <span data-ttu-id="ddc81-127">[ `<PackageReference>` 使用 Visual Studio 的转换器工具更新 NuGet 包以使用语法](/nuget/consume-packages/migrate-packages-config-to-package-reference)可能会很有帮助，以便顶级依赖项可见。</span><span class="sxs-lookup"><span data-stu-id="ddc81-127">It can be helpful to [update NuGet packages to use `<PackageReference>` syntax using Visual Studio's converter tool](/nuget/consume-packages/migrate-packages-config-to-package-reference), so that top-level dependencies are visible.</span></span> <span data-ttu-id="ddc81-128">接下来，检查这些包的当前版本或更高版本是否支持 .NET Core 或 .NET Standard。</span><span class="sxs-lookup"><span data-stu-id="ddc81-128">Next, check whether the current or later versions of these packages support .NET Core or .NET Standard.</span></span> <span data-ttu-id="ddc81-129">此信息可在 [nuget.org] 上找到，也可在 Visual Studio 中针对每个包。</span><span class="sxs-lookup"><span data-stu-id="ddc81-129">This information can be found on [nuget.org] or within Visual Studio for each package.</span></span>

<span data-ttu-id="ddc81-130">如果支持使用应用当前使用的包版本，很好！</span><span class="sxs-lookup"><span data-stu-id="ddc81-130">If support exists using the version of the package the app currently uses, great!</span></span> <span data-ttu-id="ddc81-131">如果不是，请查看包的更新版本是否具有支持和研究升级所涉及的内容。</span><span class="sxs-lookup"><span data-stu-id="ddc81-131">If not, see if a more recent version of the package has the support and research what would be involved in upgrading.</span></span> <span data-ttu-id="ddc81-132">包中可能存在重大更改，尤其是在当前使用的版本和要升级到的版本之间，包的主版本发生更改。</span><span class="sxs-lookup"><span data-stu-id="ddc81-132">There may be breaking changes in the package, especially if the major version of the package changes between your currently used version and the one to which you're upgrading.</span></span>

<span data-ttu-id="ddc81-133">在某些情况下，给定包的任何版本均不适用于 .NET Core。</span><span class="sxs-lookup"><span data-stu-id="ddc81-133">In some cases, no version of a given package works with .NET Core.</span></span> <span data-ttu-id="ddc81-134">在这种情况下，团队有几个选项。</span><span class="sxs-lookup"><span data-stu-id="ddc81-134">In that case, teams have a couple options.</span></span> <span data-ttu-id="ddc81-135">它们可以继续，具体取决于 .NET Framework 版本，但这样做有限制。</span><span class="sxs-lookup"><span data-stu-id="ddc81-135">They can continue depending on the .NET Framework version, but this has limitations.</span></span> <span data-ttu-id="ddc81-136">应用只能在 Windows 上运行，并且团队可能需要在包的二进制文件上运行可移植性分析器，以查看是否有可能遇到任何问题。</span><span class="sxs-lookup"><span data-stu-id="ddc81-136">The app may only run on Windows, and the team may want to run Portability Analyzer on the package's binaries to see if there are any issues likely to be encountered.</span></span> <span data-ttu-id="ddc81-137">当然，团队需要进行全面测试，因为如果使用的 .NET Framework 包引用的 Api 在 .NET Core 中不可用，则会发生运行时异常。</span><span class="sxs-lookup"><span data-stu-id="ddc81-137">Certainly the team will want to test thoroughly, since if .NET Framework packages are used that reference APIs not available in .NET Core, a runtime exception will occur.</span></span> <span data-ttu-id="ddc81-138">另一种方法是查找其他包，或者，如果所需的包是开放源，请将其升级到 .NET Standard 或 .NET Core 本身。</span><span class="sxs-lookup"><span data-stu-id="ddc81-138">The other option is to find a different package or, if the required package is open source, upgrade it to .NET Standard or .NET Core themselves.</span></span>

## <a name="migrate-aspnet-mvc-projects"></a><span data-ttu-id="ddc81-139">迁移 ASP.NET MVC 项目</span><span class="sxs-lookup"><span data-stu-id="ddc81-139">Migrate ASP.NET MVC projects</span></span>

<span data-ttu-id="ddc81-140">`System.Web`.Net Core 中不存在命名空间和类型。</span><span class="sxs-lookup"><span data-stu-id="ddc81-140">The `System.Web` namespace and types don't exist in .NET Core.</span></span> <span data-ttu-id="ddc81-141">分析依赖项并使用类似的工具时 `try-convert` ，你会发现，它们不会为自动迁移 ASP.NET MVC 项目及其引用的任何代码提供很多建议 `System.Web` 。</span><span class="sxs-lookup"><span data-stu-id="ddc81-141">When you're analyzing dependencies and using tools like `try-convert`, you'll find they don't offer many suggestions for automatic migration of ASP.NET MVC projects and any code in them that references `System.Web`.</span></span> <span data-ttu-id="ddc81-142">对于这些项目，你将需要从新的 ASP.NET Core web 项目开始，并手动将文件迁移到此项目。</span><span class="sxs-lookup"><span data-stu-id="ddc81-142">For these projects, you'll need to start with a new ASP.NET Core web project and manually migrate files to this project.</span></span>

<span data-ttu-id="ddc81-143">通常情况下，最好最大程度地减少应用的业务逻辑在其用户界面层中的程度。</span><span class="sxs-lookup"><span data-stu-id="ddc81-143">In general, it's a good practice to minimize how much of an app's business logic lives in its user interface layer.</span></span> <span data-ttu-id="ddc81-144">还最好将控制器和视图保持为小。</span><span class="sxs-lookup"><span data-stu-id="ddc81-144">It's also best to keep controllers and views small.</span></span> <span data-ttu-id="ddc81-145">遵循本指南的应用比 ASP.NET web 项目中具有大量逻辑的应用程序更易于移植。</span><span class="sxs-lookup"><span data-stu-id="ddc81-145">Apps that have followed this guidance will be easier to port than those that have a significant amount of their logic in the ASP.NET web project.</span></span> <span data-ttu-id="ddc81-146">如果你的应用正在考虑迁移，但尚未开始处理，请在维护它时记住这一点。</span><span class="sxs-lookup"><span data-stu-id="ddc81-146">If you have an app you're considering porting, but haven't begun the process yet, keep this in mind as you maintain it.</span></span> <span data-ttu-id="ddc81-147">为了尽量减少 ASP.NET MVC 或 Web API 项目中的代码量，在将应用程序移植到应用程序时，可能会导致更少的工作量。</span><span class="sxs-lookup"><span data-stu-id="ddc81-147">Any effort you put toward minimizing how much code is in the ASP.NET MVC or Web API project will likely result in less work when the time comes to port the app.</span></span>

<span data-ttu-id="ddc81-148">下一章进一步了如何从 ASP.NET MVC 和 Web API 项目迁移到 ASP.NET Core 项目的详细信息。</span><span class="sxs-lookup"><span data-stu-id="ddc81-148">The next chapter digs into details of how to migrate from ASP.NET MVC and Web API projects to ASP.NET Core projects.</span></span> <span data-ttu-id="ddc81-149">上一章介绍了应用之间的最大差异。</span><span class="sxs-lookup"><span data-stu-id="ddc81-149">The previous chapter called out the biggest differences between the apps.</span></span> <span data-ttu-id="ddc81-150">完成基本项目结构后，迁移单个控制器和视图通常是非常简单的，尤其是在它们主要侧重于 web 职责时。</span><span class="sxs-lookup"><span data-stu-id="ddc81-150">Once the basic project structure is in place, migrating individual controllers and views is usually straightforward, especially if they're mainly focused on web responsibilities.</span></span>

## <a name="references"></a><span data-ttu-id="ddc81-151">参考</span><span class="sxs-lookup"><span data-stu-id="ddc81-151">References</span></span>

- [<span data-ttu-id="ddc81-152">.NET 升级助手工具</span><span class="sxs-lookup"><span data-stu-id="ddc81-152">.NET Upgrade Assistant tool</span></span>](https://aka.ms/dotnet-upgrade-assistant)
- [<span data-ttu-id="ddc81-153">尝试转换工具</span><span class="sxs-lookup"><span data-stu-id="ddc81-153">try-convert tool</span></span>](https://github.com/dotnet/try-convert)
- [<span data-ttu-id="ddc81-154">apiport 工具</span><span class="sxs-lookup"><span data-stu-id="ddc81-154">apiport tool</span></span>](https://github.com/microsoft/dotnet-apiport)

>[!div class="step-by-step"]
><span data-ttu-id="ddc81-155">[上一页](identify-migration-sequence.md)
>[下一页](strategies-migrating-in-production.md)</span><span class="sxs-lookup"><span data-stu-id="ddc81-155">[Previous](identify-migration-sequence.md)
[Next](strategies-migrating-in-production.md)</span></span>

---
title: SignTool.exe（签名工具）
description: 了解 SignTool.exe（签名工具）。 此命令行工具用于对文件进行数字签名，验证文件中的签名，以及将时间戳应用于文件。
ms.date: 03/30/2017
helpviewer_keywords:
- Sign tool
- SignTool.exe
ms.assetid: 0c25ff6c-bff3-422e-b017-146a3ee86cb9
ms.openlocfilehash: 3b4bfa70ed91f98ae49b6df3a5a29f68b30f1e0a
ms.sourcegitcommit: 1dbe25ff484a02025d5c34146e517c236f7161fb
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/19/2021
ms.locfileid: "104653850"
---
# <a name="signtoolexe-sign-tool"></a><span data-ttu-id="af79f-104">SignTool.exe（签名工具）</span><span class="sxs-lookup"><span data-stu-id="af79f-104">SignTool.exe (Sign Tool)</span></span>

<span data-ttu-id="af79f-105">签名工具是一个命令行工具，用于对文件进行数字签名，以及验证文件和时间戳文件中的签名。</span><span class="sxs-lookup"><span data-stu-id="af79f-105">Sign Tool is a command-line tool that digitally signs files, verifies signatures in files, and time-stamps files.</span></span>  
  
 <span data-ttu-id="af79f-106">此工具会自动随 Visual Studio 一起安装。</span><span class="sxs-lookup"><span data-stu-id="af79f-106">This tool is automatically installed with Visual Studio.</span></span> <span data-ttu-id="af79f-107">若要运行该工具，请使用 [Visual Studio 开发人员命令提示或 Visual Studio 开发人员 PowerShell](/visualstudio/ide/reference/command-prompt-powershell)。</span><span class="sxs-lookup"><span data-stu-id="af79f-107">To run the tool, use [Visual Studio Developer Command Prompt or Visual Studio Developer PowerShell](/visualstudio/ide/reference/command-prompt-powershell).</span></span>

> [!Note]  
> <span data-ttu-id="af79f-108">Windows 10 SDK、Windows 10 HLK、Windows 10 WDK 和 Windows 10 ADK 内部版本 20236 及更高版本需要指定摘要算法。</span><span class="sxs-lookup"><span data-stu-id="af79f-108">The Windows 10 SDK, Windows 10 HLK, Windows 10 WDK and Windows 10 ADK **builds 20236 and later** require specifying the digest algorithm.</span></span> <span data-ttu-id="af79f-109">SignTool `sign` 命令需要 `/fd` 文件摘要算法和 `/td` 时间戳摘要算法选项在签名和添加时间戳期间分别指定。</span><span class="sxs-lookup"><span data-stu-id="af79f-109">The SignTool `sign` command requires the `/fd` **file digest algorithm** and the `/td` **timestamp digest algorithm** option to be specified during signing and timestamping, respectively.</span></span> <span data-ttu-id="af79f-110">如果在签名期间未指定 `/fd` 并且在添加时间戳期间未指定 `/td`，将引发警告（最初称为错误代码 0）。</span><span class="sxs-lookup"><span data-stu-id="af79f-110">A warning (error code 0, initially) will be thrown if `/fd` is not specified during signing and if `/td` is not specified during timestamping.</span></span> <span data-ttu-id="af79f-111">在 SignTool 的更高版本中，警告将变成错误。</span><span class="sxs-lookup"><span data-stu-id="af79f-111">In later versions of SignTool, the warning will become an error.</span></span> <span data-ttu-id="af79f-112">建议使用 SHA256，它被认为比行业 SHA1 更安全。</span><span class="sxs-lookup"><span data-stu-id="af79f-112">SHA256 is recommended and considered to be more secure than SHA1 by the industry.</span></span>  
  
 <span data-ttu-id="af79f-113">在命令提示符处，键入以下内容：</span><span class="sxs-lookup"><span data-stu-id="af79f-113">At the command prompt, type the following:</span></span>  
  
## <a name="syntax"></a><span data-ttu-id="af79f-114">语法</span><span class="sxs-lookup"><span data-stu-id="af79f-114">Syntax</span></span>  
  
```console  
signtool [command] [options] [file_name | ...]  
```  
  
## <a name="parameters"></a><span data-ttu-id="af79f-115">参数</span><span class="sxs-lookup"><span data-stu-id="af79f-115">Parameters</span></span>  
  
|<span data-ttu-id="af79f-116">参数</span><span class="sxs-lookup"><span data-stu-id="af79f-116">Argument</span></span>|<span data-ttu-id="af79f-117">说明</span><span class="sxs-lookup"><span data-stu-id="af79f-117">Description</span></span>|  
|--------------|-----------------|  
|`command`|<span data-ttu-id="af79f-118">指定要对文件执行的操作的四个命令（`catdb`、`sign`、`Timestamp` 或 `Verify`）之一。</span><span class="sxs-lookup"><span data-stu-id="af79f-118">One of four commands (`catdb`, `sign`, `Timestamp`, or `Verify`) that specifies an operation to perform on a file.</span></span> <span data-ttu-id="af79f-119">有关每个命令的说明，请参见下一个表。</span><span class="sxs-lookup"><span data-stu-id="af79f-119">For a description of each command, see the next table.</span></span>|  
|`options`|<span data-ttu-id="af79f-120">用于修改命令的选项。</span><span class="sxs-lookup"><span data-stu-id="af79f-120">An option that modifies a command.</span></span> <span data-ttu-id="af79f-121">除全局 `/q` 和 `/v` 选项之外，每个命令均支持一组唯一选项。</span><span class="sxs-lookup"><span data-stu-id="af79f-121">In addition to the global `/q` and `/v` options, each command supports a unique set of options.</span></span>|  
|`file_name`|<span data-ttu-id="af79f-122">要进行签名的文件的路径。</span><span class="sxs-lookup"><span data-stu-id="af79f-122">The path to a file to sign.</span></span>|  
  
 <span data-ttu-id="af79f-123">签名工具支持下列命令。</span><span class="sxs-lookup"><span data-stu-id="af79f-123">The following commands are supported by Sign Tool.</span></span> <span data-ttu-id="af79f-124">每个命令均与不同的选项集结合使用，这些选项集已在其各自的节中列出。</span><span class="sxs-lookup"><span data-stu-id="af79f-124">Each command is used with distinct sets of options, which are listed in their respective sections.</span></span>  
  
|<span data-ttu-id="af79f-125">Command</span><span class="sxs-lookup"><span data-stu-id="af79f-125">Command</span></span>|<span data-ttu-id="af79f-126">说明</span><span class="sxs-lookup"><span data-stu-id="af79f-126">Description</span></span>|  
|-------------|-----------------|  
|`catdb`|<span data-ttu-id="af79f-127">在目录数据库中添加或移除目录文件。</span><span class="sxs-lookup"><span data-stu-id="af79f-127">Adds a catalog file to, or removes it from, a catalog database.</span></span> <span data-ttu-id="af79f-128">目录数据库用于自动查找目录文件，并由 GUID 标识。</span><span class="sxs-lookup"><span data-stu-id="af79f-128">Catalog databases are used for automatic lookup of catalog files and are identified by GUID.</span></span> <span data-ttu-id="af79f-129">有关 `catdb` 命令支持的选项列表，请参阅 [catdb 命令选项](signtool-exe.md#catdb)。</span><span class="sxs-lookup"><span data-stu-id="af79f-129">For a list of the options supported by the `catdb` command, see [catdb Command Options](signtool-exe.md#catdb).</span></span>|  
|`sign`|<span data-ttu-id="af79f-130">对文件进行数字签名。</span><span class="sxs-lookup"><span data-stu-id="af79f-130">Digitally signs files.</span></span> <span data-ttu-id="af79f-131">数字签名可以阻止文件被篡改，并且使用户能够基于签名证书验证签名者。</span><span class="sxs-lookup"><span data-stu-id="af79f-131">Digital signatures protect files from tampering, and enable users to verify the signer based on a signing certificate.</span></span> <span data-ttu-id="af79f-132">有关 `sign` 命令支持的选项列表，请参阅 [sign 命令选项](signtool-exe.md#sign)。</span><span class="sxs-lookup"><span data-stu-id="af79f-132">For a list of the options supported by the `sign` command, see [sign Command Options](signtool-exe.md#sign).</span></span>|  
|`Timestamp`|<span data-ttu-id="af79f-133">为文件添加时间戳。</span><span class="sxs-lookup"><span data-stu-id="af79f-133">Time-stamps files.</span></span> <span data-ttu-id="af79f-134">有关 `TimeStamp` 命令支持的选项列表，请参阅 [TimeStamp 命令选项](signtool-exe.md#TimeStamp)。</span><span class="sxs-lookup"><span data-stu-id="af79f-134">For a list of the options supported by the `TimeStamp` command, see [TimeStamp Command Options](signtool-exe.md#TimeStamp).</span></span>|  
|`Verify`|<span data-ttu-id="af79f-135">通过确定签名证书是否由受信任的颁发机构颁发、是否已撤消签名证书，以及签名证书对于特定策略是否有效（可选）来验证文件的数字签名。</span><span class="sxs-lookup"><span data-stu-id="af79f-135">Verifies the digital signature of files by determining whether the signing certificate was issued by a trusted authority, whether the signing certificate has been revoked, and, optionally, whether the signing certificate is valid for a specific policy.</span></span> <span data-ttu-id="af79f-136">有关 `Verify` 命令支持的选项列表，请参阅 [Verify 命令选项](signtool-exe.md#Verify)。</span><span class="sxs-lookup"><span data-stu-id="af79f-136">For a list of the options supported by the `Verify` command, see [Verify Command Options](signtool-exe.md#Verify).</span></span>|  
  
 <span data-ttu-id="af79f-137">下列选项适用于所有签名工具命令。</span><span class="sxs-lookup"><span data-stu-id="af79f-137">The following options apply to all Sign Tool commands.</span></span>  
  
|<span data-ttu-id="af79f-138">全局选项</span><span class="sxs-lookup"><span data-stu-id="af79f-138">Global option</span></span>|<span data-ttu-id="af79f-139">描述</span><span class="sxs-lookup"><span data-stu-id="af79f-139">Description</span></span>|  
|-------------------|-----------------|  
|<span data-ttu-id="af79f-140">**/q**</span><span class="sxs-lookup"><span data-stu-id="af79f-140">**/q**</span></span>|<span data-ttu-id="af79f-141">如果命令运行成功，则不显示输出；如果命令运行失败，则显示最小输出。</span><span class="sxs-lookup"><span data-stu-id="af79f-141">Displays no output if the command runs successfully, and displays minimal output if the command fails.</span></span>|  
|<span data-ttu-id="af79f-142">**/v**</span><span class="sxs-lookup"><span data-stu-id="af79f-142">**/v**</span></span>|<span data-ttu-id="af79f-143">无论命令是否运行成功，都显示详细输出，并显示警告消息。</span><span class="sxs-lookup"><span data-stu-id="af79f-143">Displays verbose output regardless of whether the command runs successfully or fails, and displays warning messages.</span></span>|  
|<span data-ttu-id="af79f-144">**/debug**</span><span class="sxs-lookup"><span data-stu-id="af79f-144">**/debug**</span></span>|<span data-ttu-id="af79f-145">显示调试信息。</span><span class="sxs-lookup"><span data-stu-id="af79f-145">Displays debugging information.</span></span>|  
  
<a name="catdb"></a>

## <a name="catdb-command-options"></a><span data-ttu-id="af79f-146">catdb 命令选项</span><span class="sxs-lookup"><span data-stu-id="af79f-146">catdb Command Options</span></span>  

 <span data-ttu-id="af79f-147">下表列出了可与 `catdb` 命令一起使用的选项。</span><span class="sxs-lookup"><span data-stu-id="af79f-147">The following table lists the options that can be used with the `catdb` command.</span></span>  
  
|<span data-ttu-id="af79f-148">Catdb 选项</span><span class="sxs-lookup"><span data-stu-id="af79f-148">Catdb option</span></span>|<span data-ttu-id="af79f-149">描述</span><span class="sxs-lookup"><span data-stu-id="af79f-149">Description</span></span>|  
|------------------|-----------------|  
|`/d`|<span data-ttu-id="af79f-150">指定更新默认目录数据库。</span><span class="sxs-lookup"><span data-stu-id="af79f-150">Specifies that the default catalog database is updated.</span></span> <span data-ttu-id="af79f-151">如果 `/d` 和 `/g` 选项都未使用，则签名工具会更新系统组件和驱动程序数据库。</span><span class="sxs-lookup"><span data-stu-id="af79f-151">If neither the `/d` nor the `/g` option is used, Sign Tool updates the system component and driver database.</span></span>|  
|<span data-ttu-id="af79f-152">`/g` GUID</span><span class="sxs-lookup"><span data-stu-id="af79f-152">`/g` *GUID*</span></span>|<span data-ttu-id="af79f-153">指定由全局唯一标识符 GUID 标识的目录数据库已更新。</span><span class="sxs-lookup"><span data-stu-id="af79f-153">Specifies that the catalog database identified by the globally unique identifier *GUID* is updated.</span></span>|  
|`/r`|<span data-ttu-id="af79f-154">从目录数据库中移除指定的目录。</span><span class="sxs-lookup"><span data-stu-id="af79f-154">Removes the specified catalogs from the catalog database.</span></span> <span data-ttu-id="af79f-155">如果未指定该选项，签名工具将向目录数据库添加指定目录。</span><span class="sxs-lookup"><span data-stu-id="af79f-155">If this option is not specified, Sign Tool adds the specified catalogs to the catalog database.</span></span>|  
|`/u`|<span data-ttu-id="af79f-156">指定自动为添加的目录文件生成唯一名称。</span><span class="sxs-lookup"><span data-stu-id="af79f-156">Specifies that a unique name is automatically generated for the added catalog files.</span></span> <span data-ttu-id="af79f-157">如有必要，重命名目录文件以阻止与现有目录文件发生名称冲突。</span><span class="sxs-lookup"><span data-stu-id="af79f-157">If necessary, the catalog files are renamed to prevent name conflicts with existing catalog files.</span></span> <span data-ttu-id="af79f-158">如果未指定该选项，签名工具将覆盖与所添加的目录同名的任何现有目录。</span><span class="sxs-lookup"><span data-stu-id="af79f-158">If this option is not specified, Sign Tool overwrites any existing catalog that has the same name as the catalog being added.</span></span>|  
  
<a name="sign"></a>

## <a name="sign-command-options"></a><span data-ttu-id="af79f-159">sign 命令选项</span><span class="sxs-lookup"><span data-stu-id="af79f-159">sign Command Options</span></span>  

 <span data-ttu-id="af79f-160">下表列出了可与 `sign` 命令一起使用的选项。</span><span class="sxs-lookup"><span data-stu-id="af79f-160">The following table lists the options that can be used with the `sign` command.</span></span>  
  
|<span data-ttu-id="af79f-161">Sign 命令选项</span><span class="sxs-lookup"><span data-stu-id="af79f-161">Sign command option</span></span>|<span data-ttu-id="af79f-162">描述</span><span class="sxs-lookup"><span data-stu-id="af79f-162">Description</span></span>|  
|-------------------------|-----------------|  
|`/a`|<span data-ttu-id="af79f-163">自动选择最佳签名证书。</span><span class="sxs-lookup"><span data-stu-id="af79f-163">Automatically selects the best signing certificate.</span></span> <span data-ttu-id="af79f-164">签名工具将查找满足所有指定条件的所有有效证书，并选择有效时间最长的证书。</span><span class="sxs-lookup"><span data-stu-id="af79f-164">Sign Tool will find all valid certificates that satisfy all specified conditions and select the one that is valid for the longest time.</span></span> <span data-ttu-id="af79f-165">如果未提供该选项，签名工具仅查找一个有效的签名证书。</span><span class="sxs-lookup"><span data-stu-id="af79f-165">If this option is not present, Sign Tool expects to find only one valid signing certificate.</span></span>|  
|<span data-ttu-id="af79f-166">`/ac`  file</span><span class="sxs-lookup"><span data-stu-id="af79f-166">`/ac`  *file*</span></span>|<span data-ttu-id="af79f-167">将 file 中的其他证书添加到签名块。</span><span class="sxs-lookup"><span data-stu-id="af79f-167">Adds an additional certificate from *file* to the signature block.</span></span>|  
|`/as`|<span data-ttu-id="af79f-168">追加此签名。</span><span class="sxs-lookup"><span data-stu-id="af79f-168">Appends this signature.</span></span> <span data-ttu-id="af79f-169">如果不存在主签名，则改为使此签名成为主签名。</span><span class="sxs-lookup"><span data-stu-id="af79f-169">If no primary signature is present, this signature is made the primary signature instead.</span></span>|  
|<span data-ttu-id="af79f-170">`/c`  CertTemplateName</span><span class="sxs-lookup"><span data-stu-id="af79f-170">`/c`  *CertTemplateName*</span></span>|<span data-ttu-id="af79f-171">指定用于对证书进行签名的证书模板名（一个 Microsoft 扩展）。</span><span class="sxs-lookup"><span data-stu-id="af79f-171">Specifies the Certificate Template Name (a Microsoft extension) for the signing certificate.</span></span>|  
|<span data-ttu-id="af79f-172">`/csp`  CSPName</span><span class="sxs-lookup"><span data-stu-id="af79f-172">`/csp`  *CSPName*</span></span>|<span data-ttu-id="af79f-173">指定包含私钥容器的加密服务提供程序 (CSP)。</span><span class="sxs-lookup"><span data-stu-id="af79f-173">Specifies the cryptographic service provider (CSP) that contains the private key container.</span></span>|  
|<span data-ttu-id="af79f-174">`/d`  Desc</span><span class="sxs-lookup"><span data-stu-id="af79f-174">`/d`  *Desc*</span></span>|<span data-ttu-id="af79f-175">指定已签名内容的说明。</span><span class="sxs-lookup"><span data-stu-id="af79f-175">Specifies a description of the signed content.</span></span>|  
|<span data-ttu-id="af79f-176">`/du`  URL</span><span class="sxs-lookup"><span data-stu-id="af79f-176">`/du`  *URL*</span></span>|<span data-ttu-id="af79f-177">为已签名内容的详细说明指定统一资源定位器 (URL)。</span><span class="sxs-lookup"><span data-stu-id="af79f-177">Specifies a Uniform Resource Locator (URL) for the expanded description of the signed content.</span></span>|  
|<span data-ttu-id="af79f-178">`/f`  SignCertFile</span><span class="sxs-lookup"><span data-stu-id="af79f-178">`/f`  *SignCertFile*</span></span>|<span data-ttu-id="af79f-179">指定文件中的签名证书。</span><span class="sxs-lookup"><span data-stu-id="af79f-179">Specifies the signing certificate in a file.</span></span> <span data-ttu-id="af79f-180">如果文件采用个人信息交换 (PFX) 格式且受密码保护，则使用 `/p` 选项指定密码。</span><span class="sxs-lookup"><span data-stu-id="af79f-180">If the file is in Personal Information Exchange (PFX) format and protected by a password, use the `/p` option to specify the password.</span></span> <span data-ttu-id="af79f-181">如果文件不包含私钥，则使用 `/csp` 和 `/kc` 选项指定 CSP 和私钥容器名。</span><span class="sxs-lookup"><span data-stu-id="af79f-181">If the file does not contain private keys, use the `/csp` and `/kc` options to specify the CSP and private key container name.</span></span>|  
|`/fd`|<span data-ttu-id="af79f-182">指定要用于创建文件签名的文件摘要算法。</span><span class="sxs-lookup"><span data-stu-id="af79f-182">Specifies the file digest algorithm to use for creating file signatures.</span></span> </br> <span data-ttu-id="af79f-183">**注意：** 如果在签名时未提供 `/fd` 开关，则会生成警告。</span><span class="sxs-lookup"><span data-stu-id="af79f-183">**Note:** A warning is generated if the`/fd` switch is not provided while signing.</span></span> <span data-ttu-id="af79f-184">默认算法为 SHA1，但建议使用 SHA256。</span><span class="sxs-lookup"><span data-stu-id="af79f-184">The default algorithm is SHA1 but SHA256 is recommended.</span></span>|
|<span data-ttu-id="af79f-185">`/fd` certHash</span><span class="sxs-lookup"><span data-stu-id="af79f-185">`/fd`  *certHash*</span></span>|<span data-ttu-id="af79f-186">指定字符串 certHash 将默认使用用于签名证书的算法。</span><span class="sxs-lookup"><span data-stu-id="af79f-186">Specifying the string *certHash* will default to the algorithm used on the signing certificate.</span></span> </br> <span data-ttu-id="af79f-187">**注意：** 仅适用于 Windows 10 工具包内部版本 20236 及更高版本。</span><span class="sxs-lookup"><span data-stu-id="af79f-187">**Note:** Only available in Windows 10 kit builds 20236 and later.</span></span>|  
|<span data-ttu-id="af79f-188">`/i`  IssuerName</span><span class="sxs-lookup"><span data-stu-id="af79f-188">`/i`  *IssuerName*</span></span>|<span data-ttu-id="af79f-189">指定签名证书的颁发者的名称。</span><span class="sxs-lookup"><span data-stu-id="af79f-189">Specifies the name of the issuer of the signing certificate.</span></span> <span data-ttu-id="af79f-190">该值可以是整个颁发者名称的子字符串。</span><span class="sxs-lookup"><span data-stu-id="af79f-190">This value can be a substring of the entire issuer name.</span></span>|  
|<span data-ttu-id="af79f-191">`/kc`  PrivKeyContainerName</span><span class="sxs-lookup"><span data-stu-id="af79f-191">`/kc`  *PrivKeyContainerName*</span></span>|<span data-ttu-id="af79f-192">指定私钥容器名。</span><span class="sxs-lookup"><span data-stu-id="af79f-192">Specifies the private key container name.</span></span>|  
|<span data-ttu-id="af79f-193">`/n`  SubjectName</span><span class="sxs-lookup"><span data-stu-id="af79f-193">`/n`  *SubjectName*</span></span>|<span data-ttu-id="af79f-194">指定签名证书的主题的名称。</span><span class="sxs-lookup"><span data-stu-id="af79f-194">Specifies the name of the subject of the signing certificate.</span></span> <span data-ttu-id="af79f-195">该值可以是整个主题名称的子字符串。</span><span class="sxs-lookup"><span data-stu-id="af79f-195">This value can be a substring of the entire subject name.</span></span>|  
|`/nph`|<span data-ttu-id="af79f-196">如果支持，则取消可执行文件的页面哈希。</span><span class="sxs-lookup"><span data-stu-id="af79f-196">If supported, suppresses page hashes for executable files.</span></span> <span data-ttu-id="af79f-197">默认值由 SIGNTOOL_PAGE_HASHES 环境变量和 wintrust.dll 版本决定。</span><span class="sxs-lookup"><span data-stu-id="af79f-197">The default is determined by the SIGNTOOL_PAGE_HASHES environment variable and by the wintrust.dll version.</span></span> <span data-ttu-id="af79f-198">对于非 PE 文件，忽略此选项。</span><span class="sxs-lookup"><span data-stu-id="af79f-198">This option is ignored for non-PE files.</span></span>|  
|<span data-ttu-id="af79f-199">`/p`  Password</span><span class="sxs-lookup"><span data-stu-id="af79f-199">`/p`  *Password*</span></span>|<span data-ttu-id="af79f-200">指定打开 PFX 文件时要使用的密码。</span><span class="sxs-lookup"><span data-stu-id="af79f-200">Specifies the password to use when opening a PFX file.</span></span> <span data-ttu-id="af79f-201">（使用 `/f` 选项指定 PFX 文件。）</span><span class="sxs-lookup"><span data-stu-id="af79f-201">(Use the `/f` option to specify a PFX file.)</span></span>|  
|<span data-ttu-id="af79f-202">`/p7` *路径*</span><span class="sxs-lookup"><span data-stu-id="af79f-202">`/p7` *Path*</span></span>|<span data-ttu-id="af79f-203">指定为每个指定的内容文件生成的公钥加密标准 (PKCS) #7 文件。</span><span class="sxs-lookup"><span data-stu-id="af79f-203">Specifies that a Public Key Cryptography Standards (PKCS) #7 file is produced for each specified content file.</span></span> <span data-ttu-id="af79f-204">PKCS #7 文件命名为 path\\filename.p7 。</span><span class="sxs-lookup"><span data-stu-id="af79f-204">PKCS #7 files are named *path*\\*filename*.p7.</span></span>|  
|<span data-ttu-id="af79f-205">`/p7ce` Value</span><span class="sxs-lookup"><span data-stu-id="af79f-205">`/p7ce` *Value*</span></span>|<span data-ttu-id="af79f-206">为已签名的 PKCS #7 内容指定选项。</span><span class="sxs-lookup"><span data-stu-id="af79f-206">Specifies options for the signed PKCS #7 content.</span></span> <span data-ttu-id="af79f-207">将 Value 设置为“嵌入的”，可将已签名内容嵌入到 PKCS #7 文件中；如果设置为“DetachedSignedData”，则可生成分离的 PKCS #7 文件的已签名数据部分。</span><span class="sxs-lookup"><span data-stu-id="af79f-207">Set *Value* to "Embedded" to embed the signed content in the PKCS #7 file, or to "DetachedSignedData" to produce the signed data portion of a detached PKCS #7 file.</span></span> <span data-ttu-id="af79f-208">如果未使用 `/p7ce` 选项，默认情况下将嵌入已签名的内容。</span><span class="sxs-lookup"><span data-stu-id="af79f-208">If the `/p7ce` option is not used, the signed content is embedded by default.</span></span>|  
|<span data-ttu-id="af79f-209">`/p7co` *\<OID>*</span><span class="sxs-lookup"><span data-stu-id="af79f-209">`/p7co` *\<OID>*</span></span>|<span data-ttu-id="af79f-210">指定标识已签名的 PKCS #7 内容的对象标识符 (OID)。</span><span class="sxs-lookup"><span data-stu-id="af79f-210">Specifies the object identifier (OID) that identifies the signed PKCS #7 content.</span></span>|  
|`/ph`|<span data-ttu-id="af79f-211">如果支持，则生成可执行文件的页面哈希。</span><span class="sxs-lookup"><span data-stu-id="af79f-211">If supported, generates page hashes for executable files.</span></span>|  
|<span data-ttu-id="af79f-212">`/r`  RootSubjectName</span><span class="sxs-lookup"><span data-stu-id="af79f-212">`/r`  *RootSubjectName*</span></span>|<span data-ttu-id="af79f-213">指定签名证书必须链接到的根证书的主题名称。</span><span class="sxs-lookup"><span data-stu-id="af79f-213">Specifies the name of the subject of the root certificate that the signing certificate must chain to.</span></span> <span data-ttu-id="af79f-214">该值可以是根证书的整个主题名称的子字符串。</span><span class="sxs-lookup"><span data-stu-id="af79f-214">This value may be a substring of the entire subject name of the root certificate.</span></span>|  
|<span data-ttu-id="af79f-215">`/s`  StoreName</span><span class="sxs-lookup"><span data-stu-id="af79f-215">`/s`  *StoreName*</span></span>|<span data-ttu-id="af79f-216">指定要在搜索证书时打开的存储。</span><span class="sxs-lookup"><span data-stu-id="af79f-216">Specifies the store to open when searching for the certificate.</span></span> <span data-ttu-id="af79f-217">如果未指定该选项，则打开 `My` 存储。</span><span class="sxs-lookup"><span data-stu-id="af79f-217">If this option is not specified, the `My` store is opened.</span></span>|  
|<span data-ttu-id="af79f-218">`/sha1`  Hash</span><span class="sxs-lookup"><span data-stu-id="af79f-218">`/sha1`  *Hash*</span></span>|<span data-ttu-id="af79f-219">指定签名证书的 SHA1 哈希。</span><span class="sxs-lookup"><span data-stu-id="af79f-219">Specifies the SHA1 hash of the signing certificate.</span></span> <span data-ttu-id="af79f-220">当多个证书满足剩余开关指定的条件时，通常会指定 SHA1 哈希。</span><span class="sxs-lookup"><span data-stu-id="af79f-220">The SHA1 hash is commonly specified when multiple certificates satisfy the criteria specified by the remaining switches.</span></span>|  
|`/sm`|<span data-ttu-id="af79f-221">指定使用计算机存储，而不是用户存储。</span><span class="sxs-lookup"><span data-stu-id="af79f-221">Specifies that a machine store, instead of a user store, is used.</span></span>|  
|<span data-ttu-id="af79f-222">`/t`  URL</span><span class="sxs-lookup"><span data-stu-id="af79f-222">`/t`  *URL*</span></span>|<span data-ttu-id="af79f-223">指定时间戳服务器的 URL。</span><span class="sxs-lookup"><span data-stu-id="af79f-223">Specifies the URL of the time stamp server.</span></span> <span data-ttu-id="af79f-224">如果该选项（或 `/tr`）不存在，将不会对签名文件执行时间戳操作。</span><span class="sxs-lookup"><span data-stu-id="af79f-224">If this option (or `/tr`) is not present, the signed file will not be time stamped.</span></span> <span data-ttu-id="af79f-225">如果时间戳操作失败，将生成一个警告。</span><span class="sxs-lookup"><span data-stu-id="af79f-225">A warning is generated if time stamping fails.</span></span> <span data-ttu-id="af79f-226">此选项不能与 `/tr` 选项一起使用。</span><span class="sxs-lookup"><span data-stu-id="af79f-226">This option cannot be used with the `/tr` option.</span></span>|  
|<span data-ttu-id="af79f-227">`/td`  alg</span><span class="sxs-lookup"><span data-stu-id="af79f-227">`/td`  *alg*</span></span>|<span data-ttu-id="af79f-228">将此选项与 `/tr` 选项一起使用可请求 RFC 3161 时间戳服务器使用的摘要算法。</span><span class="sxs-lookup"><span data-stu-id="af79f-228">Used with the `/tr` option to request a digest algorithm used by the RFC 3161 time stamp server.</span></span> </br> <span data-ttu-id="af79f-229">**注意：** 如果在添加时间戳时未提供 `/td` 开关，则会生成警告。</span><span class="sxs-lookup"><span data-stu-id="af79f-229">**Note:** A warning is generated if the `/td` switch is not provided while timestamping.</span></span> <span data-ttu-id="af79f-230">默认算法为 SHA1，但建议使用 SHA256。</span><span class="sxs-lookup"><span data-stu-id="af79f-230">The default algorithm is SHA1, but SHA256 is recommended.</span></span> <br/> <span data-ttu-id="af79f-231">`/td` 开关必须在 `/tr` 开关之后（而不是之前）声明。</span><span class="sxs-lookup"><span data-stu-id="af79f-231">The `/td` switch must be declared after the `/tr` switch, not before.</span></span> <span data-ttu-id="af79f-232">如果 `/td` 开关在 `/tr` 开关之前声明，则返回的时间戳来自 SHA1 算法，而不是来自预期的 SHA256 算法。</span><span class="sxs-lookup"><span data-stu-id="af79f-232">If the `/td` switch is declared before the `/tr` switch, the timestamp that is returned is from the SHA1 algorithm instead of the intended SHA256 algorithm.</span></span> |
|<span data-ttu-id="af79f-233">`/tr`  URL</span><span class="sxs-lookup"><span data-stu-id="af79f-233">`/tr`  *URL*</span></span>|<span data-ttu-id="af79f-234">指定 RFC 3161 时间戳服务器的 URL。</span><span class="sxs-lookup"><span data-stu-id="af79f-234">Specifies the URL of the RFC 3161 time stamp server.</span></span> <span data-ttu-id="af79f-235">如果该选项（或 `/t`）不存在，将不会对签名文件执行时间戳操作。</span><span class="sxs-lookup"><span data-stu-id="af79f-235">If this option (or `/t`) is not present, the signed file will not be time stamped.</span></span> <span data-ttu-id="af79f-236">如果时间戳操作失败，将生成一个警告。</span><span class="sxs-lookup"><span data-stu-id="af79f-236">A warning is generated if time stamping fails.</span></span> <span data-ttu-id="af79f-237">此选项不能与 `/t` 选项一起使用。</span><span class="sxs-lookup"><span data-stu-id="af79f-237">This option cannot be used with the `/t` option.</span></span>|
|<span data-ttu-id="af79f-238">`/u`  Usage</span><span class="sxs-lookup"><span data-stu-id="af79f-238">`/u`  *Usage*</span></span>|<span data-ttu-id="af79f-239">指定签名证书中必须存在的增强型密钥用法 (EKU)。</span><span class="sxs-lookup"><span data-stu-id="af79f-239">Specifies the enhanced key usage (EKU) that must be present in the signing certificate.</span></span> <span data-ttu-id="af79f-240">可以通过 OID 或字符串指定该用法的值。</span><span class="sxs-lookup"><span data-stu-id="af79f-240">The usage value can be specified by OID or string.</span></span> <span data-ttu-id="af79f-241">默认用法为“代码签名”(1.3.6.1.5.5.7.3.3)。</span><span class="sxs-lookup"><span data-stu-id="af79f-241">The default usage is "Code Signing" (1.3.6.1.5.5.7.3.3).</span></span>|  
|`/uw`|<span data-ttu-id="af79f-242">指定“Windows 系统组件验证”(1.3.6.1.4.1.311.10.3.6) 的用法。</span><span class="sxs-lookup"><span data-stu-id="af79f-242">Specifies usage of "Windows System Component Verification" (1.3.6.1.4.1.311.10.3.6).</span></span>|  
  
 <span data-ttu-id="af79f-243">有关用法示例，请参阅 [Using SignTool to Sign a File](/windows/desktop/SecCrypto/using-signtool-to-sign-a-file)（使用 SignTool 为文件签名）。</span><span class="sxs-lookup"><span data-stu-id="af79f-243">For usage examples, see [Using SignTool to Sign a File](/windows/desktop/SecCrypto/using-signtool-to-sign-a-file).</span></span>  
  
<a name="TimeStamp"></a>

## <a name="timestamp-command-options"></a><span data-ttu-id="af79f-244">TimeStamp 命令选项</span><span class="sxs-lookup"><span data-stu-id="af79f-244">TimeStamp Command Options</span></span>  

 <span data-ttu-id="af79f-245">下表列出了可与 `TimeStamp` 命令一起使用的选项。</span><span class="sxs-lookup"><span data-stu-id="af79f-245">The following table lists the options that can be used with the `TimeStamp` command.</span></span>  
  
|<span data-ttu-id="af79f-246">TimeStamp 选项</span><span class="sxs-lookup"><span data-stu-id="af79f-246">TimeStamp option</span></span>|<span data-ttu-id="af79f-247">描述</span><span class="sxs-lookup"><span data-stu-id="af79f-247">Description</span></span>|  
|----------------------|-----------------|  
|`/p7`|<span data-ttu-id="af79f-248">对 PKCS #7 文件执行时间戳操作。</span><span class="sxs-lookup"><span data-stu-id="af79f-248">Time stamps PKCS #7 files.</span></span>|  
|<span data-ttu-id="af79f-249">`/t`  URL</span><span class="sxs-lookup"><span data-stu-id="af79f-249">`/t`  *URL*</span></span>|<span data-ttu-id="af79f-250">指定时间戳服务器的 URL。</span><span class="sxs-lookup"><span data-stu-id="af79f-250">Specifies the URL of the time stamp server.</span></span> <span data-ttu-id="af79f-251">要执行时间戳操作的文件必须在以前已进行签名。</span><span class="sxs-lookup"><span data-stu-id="af79f-251">The file being time stamped must have previously been signed.</span></span> <span data-ttu-id="af79f-252">需要 `/t` 或 `/tr` 选项。</span><span class="sxs-lookup"><span data-stu-id="af79f-252">Either the `/t` or the `/tr` option is required.</span></span>|  
|<span data-ttu-id="af79f-253">`/td`  alg</span><span class="sxs-lookup"><span data-stu-id="af79f-253">`/td`  *alg*</span></span>|<span data-ttu-id="af79f-254">将此选项与 `/tr` 选项一起使用可请求 RFC 3161 时间戳服务器使用的摘要算法。</span><span class="sxs-lookup"><span data-stu-id="af79f-254">Used with the `/tr` option to request a digest algorithm used by the RFC 3161 time stamp server.</span></span> </br> <span data-ttu-id="af79f-255">**注意：** 如果在添加时间戳时未提供 `/td` 开关，则会生成警告。</span><span class="sxs-lookup"><span data-stu-id="af79f-255">**Note:** A warning is generated if the `/td` switch is not provided while timestamping.</span></span> <span data-ttu-id="af79f-256">默认算法为 SHA1，但建议使用 SHA256。</span><span class="sxs-lookup"><span data-stu-id="af79f-256">The default algorithm is SHA1, but SHA256 is recommended.</span></span> <br/> <span data-ttu-id="af79f-257">`/td` 开关必须在 `/tr` 开关之后（而不是之前）声明。</span><span class="sxs-lookup"><span data-stu-id="af79f-257">The `/td` switch must be declared after the `/tr` switch, not before.</span></span> <span data-ttu-id="af79f-258">如果 `/td` 开关在 `/tr` 开关之前声明，则返回的时间戳来自 SHA1 算法，而不是来自预期的 SHA256 算法。</span><span class="sxs-lookup"><span data-stu-id="af79f-258">If the `/td` switch is declared before the `/tr` switch, the timestamp that is returned is from the SHA1 algorithm instead of the intended SHA256 algorithm.</span></span> |
|<span data-ttu-id="af79f-259">`/tp` index</span><span class="sxs-lookup"><span data-stu-id="af79f-259">`/tp` *index*</span></span>|<span data-ttu-id="af79f-260">对 index 处的签名进行时间戳操作。</span><span class="sxs-lookup"><span data-stu-id="af79f-260">Time stamps the signature at *index*.</span></span>|  
|<span data-ttu-id="af79f-261">`/tr`  URL</span><span class="sxs-lookup"><span data-stu-id="af79f-261">`/tr`  *URL*</span></span>|<span data-ttu-id="af79f-262">指定 RFC 3161 时间戳服务器的 URL。</span><span class="sxs-lookup"><span data-stu-id="af79f-262">Specifies the URL of the RFC 3161 time stamp server.</span></span> <span data-ttu-id="af79f-263">要执行时间戳操作的文件必须在以前已进行签名。</span><span class="sxs-lookup"><span data-stu-id="af79f-263">The file being time stamped must have previously been signed.</span></span> <span data-ttu-id="af79f-264">需要 `/tr` 或 `/t` 选项。</span><span class="sxs-lookup"><span data-stu-id="af79f-264">Either the `/tr` or the `/t` option is required.</span></span>|  
  
 <span data-ttu-id="af79f-265">有关使用示例，请参阅 [Adding Time Stamps to Previously Signed Files](/windows/desktop/SecCrypto/adding-time-stamps-to-previously-signed-files)（向之前已签名的文件添加时间戳）。</span><span class="sxs-lookup"><span data-stu-id="af79f-265">For a usage example, see [Adding Time Stamps to Previously Signed Files](/windows/desktop/SecCrypto/adding-time-stamps-to-previously-signed-files).</span></span>  
  
<a name="Verify"></a>

## <a name="verify-command-options"></a><span data-ttu-id="af79f-266">Verify 命令选项</span><span class="sxs-lookup"><span data-stu-id="af79f-266">Verify Command Options</span></span>  
  
|<span data-ttu-id="af79f-267">Verify 选项</span><span class="sxs-lookup"><span data-stu-id="af79f-267">Verify option</span></span>|<span data-ttu-id="af79f-268">描述</span><span class="sxs-lookup"><span data-stu-id="af79f-268">Description</span></span>|  
|-------------------|-----------------|  
|`/a`|<span data-ttu-id="af79f-269">指定可以使用所有方法来验证文件。</span><span class="sxs-lookup"><span data-stu-id="af79f-269">Specifies that all methods can be used to verify the file.</span></span> <span data-ttu-id="af79f-270">首先，搜索目录数据库以确定是否在目录中对文件进行签名。</span><span class="sxs-lookup"><span data-stu-id="af79f-270">First, the catalog databases are searched to determine whether the file is signed in a catalog.</span></span> <span data-ttu-id="af79f-271">如果未在任何目录中对文件进行签名，签名工具将尝试验证文件的嵌入签名。</span><span class="sxs-lookup"><span data-stu-id="af79f-271">If the file is not signed in any catalog, Sign Tool attempts to verify the file's embedded signature.</span></span> <span data-ttu-id="af79f-272">验证可以或不能在目录中进行签名的文件时，建议使用该选项。</span><span class="sxs-lookup"><span data-stu-id="af79f-272">This option is recommended when verifying files that may or may not be signed in a catalog.</span></span> <span data-ttu-id="af79f-273">这些文件的示例包括 Windows 文件或驱动程序。</span><span class="sxs-lookup"><span data-stu-id="af79f-273">Examples of these files include Windows files or drivers.</span></span>|  
|`/ad`|<span data-ttu-id="af79f-274">使用默认的目录数据库查找目录。</span><span class="sxs-lookup"><span data-stu-id="af79f-274">Finds the catalog by using the default catalog database.</span></span>|  
|<span data-ttu-id="af79f-275">`/ag` CatDBGUID</span><span class="sxs-lookup"><span data-stu-id="af79f-275">`/ag` *CatDBGUID*</span></span>|<span data-ttu-id="af79f-276">在由 CatDBGUID 标识的目录数据库中查找目录。</span><span class="sxs-lookup"><span data-stu-id="af79f-276">Finds the catalog in the catalog database that is identified by the *CatDBGUID*.</span></span>|  
|`/all`|<span data-ttu-id="af79f-277">验证包含多个签名的文件中的所有签名。</span><span class="sxs-lookup"><span data-stu-id="af79f-277">Verifies all signatures in a file that includes multiple signatures.</span></span>|  
|`/as`|<span data-ttu-id="af79f-278">使用系统组件（驱动程序）目录数据库查找目录。</span><span class="sxs-lookup"><span data-stu-id="af79f-278">Finds the catalog by using the system component (driver) catalog database.</span></span>|  
|<span data-ttu-id="af79f-279">`/c` CatFile</span><span class="sxs-lookup"><span data-stu-id="af79f-279">`/c` *CatFile*</span></span>|<span data-ttu-id="af79f-280">通过名称指定目录文件。</span><span class="sxs-lookup"><span data-stu-id="af79f-280">Specifies the catalog file by name.</span></span>|  
|`/d`|<span data-ttu-id="af79f-281">指定签名工具应打印描述和描述 URL。</span><span class="sxs-lookup"><span data-stu-id="af79f-281">Specifies that Sign Tool should print the description and the description URL.</span></span>|  
|<span data-ttu-id="af79f-282">`/ds`  Index</span><span class="sxs-lookup"><span data-stu-id="af79f-282">`/ds`  *Index*</span></span>|<span data-ttu-id="af79f-283">验证指定位置的签名。</span><span class="sxs-lookup"><span data-stu-id="af79f-283">Verifies the signature at a specified position.</span></span>|  
|<span data-ttu-id="af79f-284">`/hash` (`SHA1`&#124;`SHA256`)</span><span class="sxs-lookup"><span data-stu-id="af79f-284">`/hash` (`SHA1`&#124;`SHA256`)</span></span>|<span data-ttu-id="af79f-285">指定在目录中搜索文件时要使用的可选哈希算法。</span><span class="sxs-lookup"><span data-stu-id="af79f-285">Specifies an optional hash algorithm to use when searching for a file in a catalog.</span></span>|  
|`/kp`|<span data-ttu-id="af79f-286">指定应使用内核模式驱动程序签名策略执行验证。</span><span class="sxs-lookup"><span data-stu-id="af79f-286">Specifies that verification should be performed with the kernel-mode driver signing policy.</span></span>|  
|`/ms`|<span data-ttu-id="af79f-287">使用多个验证语义。</span><span class="sxs-lookup"><span data-stu-id="af79f-287">Uses multiple verification semantics.</span></span> <span data-ttu-id="af79f-288">这是 Windows 8 和更高版本上的 [WinVerifyTrust](/windows/desktop/api/wintrust/nf-wintrust-winverifytrust) 调用的默认行为。</span><span class="sxs-lookup"><span data-stu-id="af79f-288">This is the default behavior of a [WinVerifyTrust](/windows/desktop/api/wintrust/nf-wintrust-winverifytrust) call on Windows 8 and above.</span></span>|  
|<span data-ttu-id="af79f-289">`/o` Version</span><span class="sxs-lookup"><span data-stu-id="af79f-289">`/o` *Version*</span></span>|<span data-ttu-id="af79f-290">按操作系统版本验证文件。</span><span class="sxs-lookup"><span data-stu-id="af79f-290">Verifies the file by operating system version.</span></span> <span data-ttu-id="af79f-291">版本具有以下格式：PlatformID：VerMajor.VerMinor.BuildNumber   。</span><span class="sxs-lookup"><span data-stu-id="af79f-291">*Version* has the following form: *PlatformID*:*VerMajor*.*VerMinor*.*BuildNumber*.</span></span> <span data-ttu-id="af79f-292">PlatformID 表示 <xref:System.PlatformID> 枚举成员的基础值。</span><span class="sxs-lookup"><span data-stu-id="af79f-292">*PlatformID* represents the underlying value of a <xref:System.PlatformID> enumeration member.</span></span> <span data-ttu-id="af79f-293">**重要提示：** 建议使用 `/o` 开关。</span><span class="sxs-lookup"><span data-stu-id="af79f-293">**Important:**  The use of the `/o` switch is recommended.</span></span> <span data-ttu-id="af79f-294">如果未指定 `/o`，SignTool.exe 可能会返回意外的结果。</span><span class="sxs-lookup"><span data-stu-id="af79f-294">If `/o` is not specified, SignTool.exe may return unexpected results.</span></span> <span data-ttu-id="af79f-295">例如，如果你未将 `/o` 开关包含在内，则能在旧版操作系统上正确验证的系统目录可能在新版操作系统上无法正确验证。</span><span class="sxs-lookup"><span data-stu-id="af79f-295">For example, if you do not include the `/o` switch, system catalogs that validate correctly on an older operating system may not validate correctly on a newer operating system.</span></span>|  
|`/p7`|<span data-ttu-id="af79f-296">验证 PKCS #7 文件。</span><span class="sxs-lookup"><span data-stu-id="af79f-296">Verifies PKCS #7 files.</span></span> <span data-ttu-id="af79f-297">无现有策略用于 PKCS #7 验证。</span><span class="sxs-lookup"><span data-stu-id="af79f-297">No existing policies are used for PKCS #7 validation.</span></span> <span data-ttu-id="af79f-298">该签名处于选中状态，并为签名证书生成了链。</span><span class="sxs-lookup"><span data-stu-id="af79f-298">The signature is checked and a chain is built for the signing certificate.</span></span>|  
|`/pa`|<span data-ttu-id="af79f-299">指定应使用默认认证码验证策略。</span><span class="sxs-lookup"><span data-stu-id="af79f-299">Specifies that the Default Authenticode Verification Policy should be used.</span></span> <span data-ttu-id="af79f-300">如果未指定 `/pa` 选项，签名工具将使用 Windows 驱动程序验证策略。</span><span class="sxs-lookup"><span data-stu-id="af79f-300">If the `/pa` option is not specified, Sign Tool uses the Windows Driver Verification Policy.</span></span> <span data-ttu-id="af79f-301">此选项不能与 `catdb` 选项一起使用。</span><span class="sxs-lookup"><span data-stu-id="af79f-301">This option cannot be used with the `catdb` options.</span></span>|  
|<span data-ttu-id="af79f-302">`/pg` PolicyGUID</span><span class="sxs-lookup"><span data-stu-id="af79f-302">`/pg` *PolicyGUID*</span></span>|<span data-ttu-id="af79f-303">通过 GUID 指定验证策略。</span><span class="sxs-lookup"><span data-stu-id="af79f-303">Specifies a verification policy by GUID.</span></span> <span data-ttu-id="af79f-304">PolicyGUID 相当于验证策略的 ActionID。</span><span class="sxs-lookup"><span data-stu-id="af79f-304">The *PolicyGUID* corresponds to the ActionID of the verification policy.</span></span> <span data-ttu-id="af79f-305">此选项不能与 `catdb` 选项一起使用。</span><span class="sxs-lookup"><span data-stu-id="af79f-305">This option cannot be used with the `catdb` options.</span></span>|  
|`/ph`|<span data-ttu-id="af79f-306">指定签名工具应打印并验证页面哈希值。</span><span class="sxs-lookup"><span data-stu-id="af79f-306">Specifies that Sign Tool should print and verify page hash values.</span></span>|  
|<span data-ttu-id="af79f-307">`/r` RootSubjectName</span><span class="sxs-lookup"><span data-stu-id="af79f-307">`/r` *RootSubjectName*</span></span>|<span data-ttu-id="af79f-308">指定签名证书必须链接到的根证书的主题名称。</span><span class="sxs-lookup"><span data-stu-id="af79f-308">Specifies the name of the subject of the root certificate that the signing certificate must chain to.</span></span> <span data-ttu-id="af79f-309">该值可以是根证书的整个主题名称的子字符串。</span><span class="sxs-lookup"><span data-stu-id="af79f-309">This value can be a substring of the entire subject name of the root certificate.</span></span>|  
|`/tw`|<span data-ttu-id="af79f-310">指定在未对签名进行时间戳操作时应生成警告。</span><span class="sxs-lookup"><span data-stu-id="af79f-310">Specifies that a warning should be generated if the signature is not time stamped.</span></span>|  
  
 <span data-ttu-id="af79f-311">有关用法示例，请参阅 [Using SignTool to Verify a File Signature](/windows/desktop/SecCrypto/using-signtool-to-verify-a-file-signature)（使用 SignTool 验证文件签名）。</span><span class="sxs-lookup"><span data-stu-id="af79f-311">For usage examples, see [Using SignTool to Verify a File Signature](/windows/desktop/SecCrypto/using-signtool-to-verify-a-file-signature).</span></span>  
  
## <a name="return-value"></a><span data-ttu-id="af79f-312">返回值</span><span class="sxs-lookup"><span data-stu-id="af79f-312">Return Value</span></span>  

 <span data-ttu-id="af79f-313">当其终止时，签名工具将返回下列退出代码之一。</span><span class="sxs-lookup"><span data-stu-id="af79f-313">Sign Tool returns one of the following exit codes when it terminates.</span></span>  
  
|<span data-ttu-id="af79f-314">退出代码</span><span class="sxs-lookup"><span data-stu-id="af79f-314">Exit code</span></span>|<span data-ttu-id="af79f-315">说明</span><span class="sxs-lookup"><span data-stu-id="af79f-315">Description</span></span>|  
|---------------|-----------------|  
|<span data-ttu-id="af79f-316">0</span><span class="sxs-lookup"><span data-stu-id="af79f-316">0</span></span>|<span data-ttu-id="af79f-317">执行成功。</span><span class="sxs-lookup"><span data-stu-id="af79f-317">Execution was successful.</span></span>|  
|<span data-ttu-id="af79f-318">1</span><span class="sxs-lookup"><span data-stu-id="af79f-318">1</span></span>|<span data-ttu-id="af79f-319">执行失败。</span><span class="sxs-lookup"><span data-stu-id="af79f-319">Execution has failed.</span></span>|  
|<span data-ttu-id="af79f-320">2</span><span class="sxs-lookup"><span data-stu-id="af79f-320">2</span></span>|<span data-ttu-id="af79f-321">执行完成，但出现警告。</span><span class="sxs-lookup"><span data-stu-id="af79f-321">Execution has completed with warnings.</span></span>|  

## <a name="examples"></a><span data-ttu-id="af79f-322">示例</span><span class="sxs-lookup"><span data-stu-id="af79f-322">Examples</span></span>  

 <span data-ttu-id="af79f-323">以下命令将目录文件 MyCatalogFileName.cat 添加到系统组件和驱动程序数据库中。</span><span class="sxs-lookup"><span data-stu-id="af79f-323">The following command adds the catalog file MyCatalogFileName.cat to the system component and driver database.</span></span> <span data-ttu-id="af79f-324">如有必要阻止替换名为 `/u` 的现有目录文件，`MyCatalogFileName.cat` 选项会生成唯一名称。</span><span class="sxs-lookup"><span data-stu-id="af79f-324">The `/u` option generates a unique name if necessary to prevent replacing an existing catalog file named `MyCatalogFileName.cat`.</span></span>  
  
```console  
signtool catdb /v /u MyCatalogFileName.cat  
```  
  
 <span data-ttu-id="af79f-325">以下命令通过使用最佳证书对文件进行自动签名。</span><span class="sxs-lookup"><span data-stu-id="af79f-325">The following command signs a file automatically by using the best certificate.</span></span>  
  
```console
signtool sign /a /fd SHA256 MyFile.exe
```

 <span data-ttu-id="af79f-326">以下命令使用存储在受密码保护的 PFX 文件中的证书对文件进行数字签名。</span><span class="sxs-lookup"><span data-stu-id="af79f-326">The following command digitally signs a file by using a certificate stored in a password-protected PFX file.</span></span>  
  
```console  
signtool sign /f MyCert.pfx /p MyPassword /fd SHA256 MyFile.exe
```  
  
 <span data-ttu-id="af79f-327">以下命令对文件进行数字签名并加盖时间戳。</span><span class="sxs-lookup"><span data-stu-id="af79f-327">The following command digitally signs and time-stamps a file.</span></span> <span data-ttu-id="af79f-328">用于对文件进行签名的证书存储在 PFX 文件中。</span><span class="sxs-lookup"><span data-stu-id="af79f-328">The certificate used to sign the file is stored in a PFX file.</span></span>  
  
```console  
signtool sign /f MyCert.pfx /t http://timestamp.digicert.com /fd SHA256 MyFile.exe
```  
  
 <span data-ttu-id="af79f-329">以下命令通过使用位于 `My` 存储中的证书对文件进行签名，该证书的主题名为 `My Company Certificate`。</span><span class="sxs-lookup"><span data-stu-id="af79f-329">The following command signs a file by using a certificate located in the `My` store that has a subject name of `My Company Certificate`.</span></span>  
  
```console  
signtool sign /n "My Company Certificate" /fd SHA256 MyFile.exe
```  
  
 <span data-ttu-id="af79f-330">以下命令对 ActiveX 控件进行签名，并提供在系统提示用户安装此控件时由 Internet Explorer 显示的信息。</span><span class="sxs-lookup"><span data-stu-id="af79f-330">The following command signs an ActiveX control and provides information that is displayed by Internet Explorer when the user is prompted to install the control.</span></span>  
  
```console  
Signtool sign /f MyCert.pfx /d: "MyControl" /du http://www.example.com/MyControl/info.html /fd SHA256 MyControl.exe
```  
  
 <span data-ttu-id="af79f-331">以下命令对已进行数字签名的文件加盖时间戳。</span><span class="sxs-lookup"><span data-stu-id="af79f-331">The following command time-stamps a file that has already been digitally signed.</span></span>  
  
```console  
signtool timestamp /t http://timestamp.digicert.com MyFile.exe
```  

<span data-ttu-id="af79f-332">以下命令使用 RFC 3161 时间戳服务器为文件添加时间戳。</span><span class="sxs-lookup"><span data-stu-id="af79f-332">The following command time-stamps a file using an RFC 3161 timestamp server.</span></span>  
  
```console  
signtool timestamp /tr http://timestamp.digicert.com /td SHA256 MyFile.exe
```  
  
 <span data-ttu-id="af79f-333">以下命令确认文件已签名。</span><span class="sxs-lookup"><span data-stu-id="af79f-333">The following command verifies that a file has been signed.</span></span>  
  
```console  
signtool verify MyFile.exe  
```  
  
 <span data-ttu-id="af79f-334">以下命令验证可能已在目录中签名的系统文件。</span><span class="sxs-lookup"><span data-stu-id="af79f-334">The following command verifies a system file that may be signed in a catalog.</span></span>  
  
```console  
signtool verify /a SystemFile.dll  
```  
  
 <span data-ttu-id="af79f-335">以下命令验证已在名为 `MyCatalog.cat` 目录中签名的系统文件。</span><span class="sxs-lookup"><span data-stu-id="af79f-335">The following command verifies a system file that is signed in a catalog named `MyCatalog.cat`.</span></span>  
  
```console  
signtool verify /c MyCatalog.cat SystemFile.dll  
```  
  
## <a name="see-also"></a><span data-ttu-id="af79f-336">请参阅</span><span class="sxs-lookup"><span data-stu-id="af79f-336">See also</span></span>

- [<span data-ttu-id="af79f-337">工具</span><span class="sxs-lookup"><span data-stu-id="af79f-337">Tools</span></span>](index.md)
- [<span data-ttu-id="af79f-338">开发人员命令行 shell</span><span class="sxs-lookup"><span data-stu-id="af79f-338">Developer command-line shells</span></span>](/visualstudio/ide/reference/command-prompt-powershell)
